<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleNFT 简单NFT合约 - Solidity学习</title>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Reenie+Beanie&family=Comic+Neue:ital,wght@0,400;0,700;1,400&family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --easy: #43AA8B;
            --medium: #F8961E;
            --hard: #E71D36;
            --expert: #7209B7;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
            color: var(--dark);
            line-height: 1.8;
            background-image: radial-gradient(#d0e3ff 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .nav-bar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-btn:hover {
            background: var(--secondary);
            transform: translateX(-3px);
        }
        
        .nav-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            color: var(--secondary);
        }
        
        .nav-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 8px;
            font-family: 'Comic Neue', cursive;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .hero-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-top: 5px solid var(--accent);
        }
        
        .hero-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .hero-title {
            flex: 1;
            min-width: 250px;
        }
        
        .day-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 20px;
            border-radius: 15px;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        h1 {
            font-family: 'Gochi Hand', cursive;
            font-size: 2.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .meta-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .difficulty-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
            font-size: 1rem;
        }
        
        .tag {
            background: var(--light);
            padding: 5px 15px;
            border-radius: 15px;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px dashed var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .key-point {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--accent);
        }
        
        .key-point-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .concept-card {
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
            border-left: 5px solid var(--hard);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .concept-card.important {
            background: linear-gradient(135deg, #fff9e6, #ffedd5);
            border-left-color: var(--medium);
        }
        
        .concept-card.tip {
            background: linear-gradient(135deg, #e6f7ff, #d6f0ff);
            border-left-color: var(--primary);
        }
        
        .concept-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.4rem;
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        pre {
            background: #282c34;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        
        code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
        }
        
        .inline-code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Fira Code', monospace;
            color: var(--hard);
            font-size: 0.9em;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .warning-box strong {
            color: #ff6b35;
        }
        
        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .steps-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }
        
        .steps-list li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding-left: 60px;
            position: relative;
        }
        
        .steps-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: var(--accent);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.2rem;
        }
        
        .navigation-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-footer-btn {
            flex: 1;
            min-width: 200px;
            background: white;
            border: 3px solid var(--primary);
            padding: 20px;
            border-radius: 15px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .nav-footer-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .nav-footer-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .nav-footer-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .hero-section {
                padding: 25px;
            }
            
            .section {
            padding: 20px;
            }
            
            .key-points {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <div class="nav-left">
        <a href="index.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> 返回首页
        </a>
            <span class="nav-title">第21天</span>
        </div>
        <div class="nav-right">
            <a href="#concepts" class="nav-btn">📚 核心概念</a>
            <a href="#code" class="nav-btn">💻 代码讲解</a>
            <a href="#practice" class="nav-btn">🎯 练习</a>
        </div>
    </div>

    <div class="container">
        <div class="hero-section">
            <div class="hero-header">
                <div class="hero-title">
                    <div class="day-badge">第 21 天</div>
                    <h1>🎨 SimpleNFT 简单NFT合约</h1>
                    <p class="subtitle">从零实现ERC-721标准 - 深入理解非同质化代币的核心机制</p>
                </div>
                <div class="meta-tags">
                    <div class="difficulty-badge" style="background: var(--expert);">
                        困难 ⭐⭐⭐⭐
                    </div>
                    <span class="tag">ERC-721</span>
                    <span class="tag">NFT</span>
                    <span class="tag">元数据</span>
                    <span class="tag">所有权追踪</span>
                </div>
            </div>
            
            <div class="key-points">
                <div class="key-point">
                    <div class="key-point-title">🎯 学习目标</div>
                    <div>从零实现完整的ERC-721标准，深入理解NFT核心机制</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">🛠️ 核心技能</div>
                    <div>ERC-721标准、映射设计、批准机制、安全转账</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">⏰ 预计时间</div>
                    <div>4-5小时 (理解+编码+测试)</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">📊 主观感受难度</div>
                    <div>⭐⭐⭐⭐⭐ 极难 - ERC-721标准的完整实现和复杂状态管理</div>
                </div>
            </div>
            
            <div class="key-points" style="margin-top: 20px;">
                <div class="key-point">
                    <div class="key-point-title">🎯 ERC-721标准</div>
                    <div>完整实现NFT标准的所有核心功能</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">🔑 唯一性保证</div>
                    <div>每个tokenId对应唯一的所有者和元数据</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">✅ 双层批准</div>
                    <div>支持单个NFT批准和全部NFT的操作员批准</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">🛡️ 安全转账</div>
                    <div>实现IERC721Receiver接口检查,防止NFT丢失</div>
                </div>
            </div>
        </div>

        <div class="section" id="concepts">
            <h2 class="section-title">
                <i class="fas fa-lightbulb"></i> 核心概念
            </h2>
            
            <div class="concept-card">
                <div class="concept-title">🆚 ERC-721 vs ERC-20 本质区别</div>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>特性维度</th>
                            <th>ERC-20 (同质化代币)</th>
                            <th>ERC-721 (非同质化代币)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>可替代性</strong></td>
                            <td>完全可替代,1 USDC = 1 USDC</td>
                            <td>独一无二,NFT #1 ≠ NFT #2</td>
                        </tr>
                        <tr>
                            <td><strong>数量表示</strong></td>
                            <td>uint256 余额(可分割)</td>
                            <td>tokenId(不可分割)</td>
                        </tr>
                        <tr>
                            <td><strong>所有权记录</strong></td>
                            <td>mapping(address => uint256)</td>
                            <td>mapping(uint256 => address)</td>
                        </tr>
                        <tr>
                            <td><strong>转账逻辑</strong></td>
                            <td>减少发送者余额,增加接收者余额</td>
                            <td>改变特定tokenId的所有者</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="concept-card important">
                <div class="concept-title">🔑 NFT的五大核心状态映射</div>
                <p>理解这些mapping是掌握NFT的关键:</p>
                <pre><code class="language-solidity">// 1. tokenId → 所有者地址 (核心!)
mapping(uint256 => address) private _owners;

// 2. 地址 → 拥有的NFT数量
mapping(address => uint256) private _balances;

// 3. tokenId → 被批准的地址(单个授权)
mapping(uint256 => address) private _tokenApprovals;

// 4. 所有者 → 操作员 → 是否批准全部(批量授权)
mapping(address => mapping(address => bool)) private _operatorApprovals;

// 5. tokenId → 元数据URI
mapping(uint256 => string) private _tokenURIs;</code></pre>
                
                <div class="warning-box">
                    <strong>💡 为什么需要两个balance?</strong><br>
                    _owners[tokenId]: 快速查询"这个NFT属于谁?"<br>
                    _balances[address]: 快速查询"这个人有多少个NFT?"<br>
                    虽然可以遍历所有tokenId来计算余额,但gas成本极高!两个mapping实现O(1)查询,用空间换时间。
                </div>
            </div>

            <div class="concept-card tip">
                <div class="concept-title">🎫 双层批准机制详解</div>
                <p>NFT的授权比ERC-20更复杂,支持两种模式:</p>
                
                <ol class="steps-list">
                    <li>
                        <strong>单个NFT批准 (approve)</strong><br>
                        授权特定地址转移特定的一个NFT<br>
                        例: 批准Bob转移我的NFT #42
                    </li>
                    <li>
                        <strong>全部NFT批准 (setApprovalForAll)</strong><br>
                        授权操作员管理我的所有NFT<br>
                        例: 批准OpenSea操作我的所有NFT
                    </li>
                </ol>

                <div class="warning-box">
                    <strong>⚠️ 安全风险:</strong> setApprovalForAll非常强大,意味着操作员可以转移你的所有NFT!只授权给你完全信任的合约。许多NFT盗窃案都源于恶意合约获取了全部批准。
                </div>
            </div>

            <div class="concept-card">
                <div class="concept-title">🛡️ 安全转账 vs 普通转账</div>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>对比项</th>
                            <th>transferFrom</th>
                            <th>safeTransferFrom</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>接收者检查</strong></td>
                            <td>不检查</td>
                            <td>检查是否能接收NFT</td>
                        </tr>
                        <tr>
                            <td><strong>转给EOA</strong></td>
                            <td>✅ 安全</td>
                            <td>✅ 安全</td>
                        </tr>
                        <tr>
                            <td><strong>转给合约</strong></td>
                            <td>⚠️ 可能丢失</td>
                            <td>✅ 安全(需实现接收器)</td>
                        </tr>
                        <tr>
                            <td><strong>推荐场景</strong></td>
                            <td>明确知道接收者</td>
                            <td>不确定接收者类型</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section" id="code">
            <h2 class="section-title">
                <i class="fas fa-code"></i> 代码详解
            </h2>
            
            <h3>📦 状态变量与构造函数</h3>
            <pre><code class="language-solidity">string public name;
string public symbol;

uint256 private _tokenIdCounter;  // 自增ID生成器

// 五大核心映射
mapping(uint256 => address) private _owners;
mapping(address => uint256) private _balances;
mapping(uint256 => address) private _tokenApprovals;
mapping(address => mapping(address => bool)) private _operatorApprovals;
mapping(uint256 => string) private _tokenURIs;

constructor(string memory _name, string memory _symbol) {
    name = _name;
    symbol = _symbol;
}</code></pre>

            <h3>🔍 查询函数</h3>
            <pre><code class="language-solidity">// 查询地址拥有的NFT数量
function balanceOf(address owner) public view returns (uint256) {
    require(owner != address(0), "Invalid address");
    return _balances[owner];
}

// 查询NFT的所有者
function ownerOf(uint256 tokenId) public view returns (address) {
    address owner = _owners[tokenId];
    require(owner != address(0), "Token doesn't exist");
    return owner;
}</code></pre>

            <h3>✅ 批准管理</h3>
            <pre><code class="language-solidity">// 批准单个NFT
function approve(address to, uint256 tokenId) public {
    address owner = ownerOf(tokenId);
    
    // 只有所有者可以批准
    require(msg.sender == owner, "Not the owner");
    
    // 不能批准给自己
    require(to != owner, "Approval to current owner");
    
    _tokenApprovals[tokenId] = to;
}

// 批准所有NFT
function setApprovalForAll(address operator, bool approved) public {
    require(operator != msg.sender, "Approve to caller");
    _operatorApprovals[msg.sender][operator] = approved;
}</code></pre>

            <h3>🔄 转账功能</h3>
            <pre><code class="language-solidity">// 普通转账
function transferFrom(address from, address to, uint256 tokenId) public {
    require(_isApprovedOrOwner(msg.sender, tokenId), "Not approved");
    _transfer(from, to, tokenId);
}

// 安全转账
function safeTransferFrom(address from, address to, uint256 tokenId) public {
    safeTransferFrom(from, to, tokenId, "");
}

function safeTransferFrom(
    address from, 
    address to, 
    uint256 tokenId, 
    bytes memory data
) public {
    require(_isApprovedOrOwner(msg.sender, tokenId), "Not approved");
    _safeTransfer(from, to, tokenId, data);
}</code></pre>

            <h3>🔨 铸造功能</h3>
            <pre><code class="language-solidity">function mint(address to, string memory uri) public returns (uint256) {
    // 生成新的tokenId
    uint256 tokenId = _tokenIdCounter;
    _tokenIdCounter++;
    
    // 设置所有者
    _owners[tokenId] = to;
    
    // 增加余额
    _balances[to]++;
    
    // 设置元数据URI
    _tokenURIs[tokenId] = uri;
    
    return tokenId;
}</code></pre>

            <div class="warning-box">
                <strong>⚠️ 注意:</strong> 这个mint函数是public的,意味着任何人都可以铸造!真实项目应该添加访问控制(onlyOwner)或支付机制。
            </div>

            <h3>🔧 内部辅助函数</h3>
            <pre><code class="language-solidity">// 核心转账逻辑
function _transfer(address from, address to, uint256 tokenId) internal {
    // 验证from是真正的所有者
    require(ownerOf(tokenId) == from, "Not the owner");
    require(to != address(0), "Invalid address");
    
    // 清除批准(转账后批准失效)
    _tokenApprovals[tokenId] = address(0);
    
    // 更新余额
    _balances[from]--;
    _balances[to]++;
    
    // 转移所有权
    _owners[tokenId] = to;
}

// 检查是否有权限转移
function _isApprovedOrOwner(address spender, uint256 tokenId) 
    internal view returns (bool) 
{
    address owner = ownerOf(tokenId);
    return (
        spender == owner ||                           // 是所有者
        getApproved(tokenId) == spender ||        // 被单独批准
        isApprovedForAll(owner, spender)          // 是操作员
    );
}</code></pre>
        </div>

        <div class="section" id="practice">
            <h2 class="section-title">
                <i class="fas fa-dumbbell"></i> 实践要点
            </h2>
            
            <div class="concept-card">
                <div class="concept-title">📝 完整的NFT生命周期</div>
                <p><strong>任务:</strong> 模拟一个NFT从铸造到转移的完整流程</p>
                <pre><code class="language-solidity">// 1. 部署合约
SimpleNFT nft = new SimpleNFT("MyNFT", "MNFT");

// 2. Alice铸造NFT
uint256 tokenId = nft.mint(alice, "ipfs://QmX...metadata");
// tokenId = 0 (第一个NFT)

// 3. 检查所有权
address owner = nft.ownerOf(0);  // 返回 alice
uint256 balance = nft.balanceOf(alice);  // 返回 1

// 4. Alice批准Bob转移
nft.approve(bob, 0);

// 5. Bob执行转账给Charlie
nft.transferFrom(alice, charlie, 0);

// 6. 验证结果
owner = nft.ownerOf(0);  // 现在是 charlie
balance = nft.balanceOf(alice);  // 变成 0
balance = nft.balanceOf(charlie);  // 变成 1
address approved = nft.getApproved(0);  // 变成 address(0)</code></pre>
            </div>

            <div class="concept-card important">
                <div class="concept-title">🔧 实现批量铸造</div>
                <p><strong>目标:</strong> 添加一个批量铸造函数</p>
                <pre><code class="language-solidity">function batchMint(
    address to, 
    string[] memory uris
) public returns (uint256[] memory) {
    // TODO: 实现批量铸造逻辑
    // 1. 创建返回数组
    // 2. 循环调用mint
    // 3. 返回所有tokenId
}</code></pre>
                <div class="success-box">
                    <strong>💡 思考题:</strong><br>
                    • 如何限制单次最多铸造多少个?(防止gas耗尽)<br>
                    • 是否应该添加访问控制?<br>
                    • 如何优化gas成本?
                </div>
            </div>

            <div class="concept-card tip">
                <div class="concept-title">🎯 实现NFT销毁功能</div>
                <p><strong>任务:</strong> 添加burn函数,允许所有者销毁NFT</p>
                <pre><code class="language-solidity">function burn(uint256 tokenId) public {
    // TODO: 实现销毁逻辑
    // 1. 检查调用者是所有者或被批准
    // 2. 清除批准
    // 3. 减少余额
    // 4. 删除所有者记录
    // 5. 删除tokenURI
}</code></pre>
                <div class="warning-box">
                    <strong>⚠️ 注意:</strong> 销毁后,ownerOf应该revert,balanceOf应该减少。
                </div>
            </div>

            <div class="concept-card">
                <div class="concept-title">⚡ 实现枚举功能</div>
                <p><strong>高级任务:</strong> 添加函数来枚举某地址的所有NFT</p>
                <pre><code class="language-solidity">// 需要添加新的状态变量
mapping(address => uint256[]) private _ownedTokens;
mapping(uint256 => uint256) private _ownedTokensIndex;

// 实现ERC-721 Enumerable扩展
function tokenOfOwnerByIndex(address owner, uint256 index) 
    public view returns (uint256) 
{
    // TODO: 返回owner的第index个NFT
}

function tokensOfOwner(address owner) 
    public view returns (uint256[] memory) 
{
    // TODO: 返回owner的所有NFT
}</code></pre>
                <div class="success-box">
                    <strong>💡 提示:</strong> 转账时需要同步更新_ownedTokens数组!这会增加gas成本,但提供了强大的查询能力。
                </div>
            </div>

            <div class="concept-card important">
                <div class="concept-title">🌟 挑战: 实现NFT质押合约</div>
                <p><strong>综合任务:</strong> 创建一个质押合约,用户质押NFT赚取代币奖励</p>
                <pre><code class="language-solidity">contract NFTStaking is IERC721Receiver {
    struct Stake {
        address owner;
        uint256 timestamp;
    }
    
    mapping(uint256 => Stake) public stakes;
    
    // TODO: 实现质押功能
    function stake(uint256 tokenId) external { }
    
    // TODO: 实现解除质押
    function unstake(uint256 tokenId) external { }
    
    // TODO: 计算奖励
    function calculateReward(uint256 tokenId) public view returns (uint256) { }
    
    // 必须实现以接收NFT
    function onERC721Received(
        address,
        address,
        uint256,
        bytes calldata
    ) external pure returns (bytes4) {
        return IERC721Receiver.onERC721Received.selector;
    }
}</code></pre>
            </div>
        </div>

        <div class="navigation-footer">
            <a href="contract-20.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">← 上一个</div>
                <div class="nav-footer-title">FortKnox - 金库堡垒</div>
            </a>
            <a href="contract-22.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">下一个 →</div>
                <div class="nav-footer-title">DecentralisedLottery - 去中心化彩票</div>
            </a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/solidity.min.js"></script>
    <script>
        hljs.highlightAll();
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>
</html>