<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LendingPool å€Ÿè´·æ± åˆçº¦ - Solidityå­¦ä¹ </title>
    <link
        href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Reenie+Beanie&family=Comic+Neue:ital,wght@0,400;0,700;1,400&family=Fira+Code&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --easy: #43AA8B;
            --medium: #F8961E;
            --hard: #E71D36;
            --expert: #7209B7;
            --warm-brown: #8B7355;
            --parchment: #F5F1E6;
            --vintage-blue: #6B8E9F;
            --warm-red: #C44536;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
            color: var(--dark);
            line-height: 1.8;
            background-image: radial-gradient(#d0e3ff 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .nav-bar {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .back-btn:hover {
            background: var(--secondary);
            transform: translateX(-3px);
        }

        .nav-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            color: var(--secondary);
        }

        .nav-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 8px;
            font-family: 'Comic Neue', cursive;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: var(--primary);
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .hero-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 5px 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border-top: 5px solid var(--accent);
        }

        .hero-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .hero-title {
            flex: 1;
            min-width: 250px;
        }

        .day-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 20px;
            border-radius: 15px;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: inline-block;
        }

        h1 {
            font-family: 'Gochi Hand', cursive;
            font-size: 2.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }

        .meta-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .difficulty-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
            font-size: 1rem;
        }

        .tag {
            background: var(--light);
            padding: 5px 15px;
            border-radius: 15px;
            color: var(--secondary);
            font-size: 0.9rem;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px dashed var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .key-point {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--accent);
        }

        .key-point-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .concept-card {
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
            border-left: 5px solid var(--hard);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .concept-card.important {
            background: linear-gradient(135deg, #fff9e6, #ffedd5);
            border-left-color: var(--medium);
        }

        .concept-card.tip {
            background: linear-gradient(135deg, #e6f7ff, #d6f0ff);
            border-left-color: var(--primary);
        }

        .concept-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.4rem;
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        pre {
            background: #282c34;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
        }

        .inline-code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Fira Code', monospace;
            color: var(--hard);
            font-size: 0.9em;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .warning-box strong {
            color: #ff6b35;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .comparison-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .steps-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }

        .steps-list li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding-left: 60px;
            position: relative;
        }

        .steps-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: var(--accent);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.2rem;
        }

        .navigation-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-footer-btn {
            flex: 1;
            min-width: 200px;
            background: white;
            border: 3px solid var(--primary);
            padding: 20px;
            border-radius: 15px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-footer-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-footer-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .nav-footer-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
        }

        .formula-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            margin: 15px 0;
            text-align: center;
            font-family: 'Fira Code', monospace;
            font-size: 1.1em;
            font-weight: bold;
        }

        /* å‚è€ƒç­”æ¡ˆæ¨¡å—æ ·å¼ - æ¸©æš–æ²»æ„ˆé£æ ¼ */
        .answer-reference {
            position: relative;
            margin: 60px 0 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .envelope-container {
            position: relative;
            width: 340px;
            height: 240px;
            cursor: pointer;
            perspective: 1200px;
            margin-bottom: 20px;
            filter: drop-shadow(0 10px 20px rgba(139, 115, 85, 0.2));
        }

        .envelope {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .envelope-front,
        .envelope-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .envelope-front {
            background: linear-gradient(135deg, #f9f3e9, #e8dfd1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #d4c9b8;
        }

        .envelope-flap {
            position: absolute;
            top: -70px;
            width: 0;
            height: 0;
            border-left: 170px solid transparent;
            border-right: 170px solid transparent;
            border-bottom: 70px solid #e8dfd1;
            z-index: 1;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.1));
        }

        .envelope-flap::after {
            content: "";
            position: absolute;
            top: 3px;
            left: -170px;
            width: 0;
            height: 0;
            border-left: 170px solid transparent;
            border-right: 170px solid transparent;
            border-bottom: 67px solid #f9f3e9;
        }

        .envelope-seal {
            position: absolute;
            bottom: 25px;
            right: 35px;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle at 30% 30%, #C44536, #8B2E24);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2;
            border: 2px solid #A52A2A;
        }

        .seal-icon {
            color: #F5F1E6;
            font-size: 1.8rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .envelope-text {
            font-family: 'Reenie Beanie', cursive;
            font-size: 2.4rem;
            color: var(--warm-brown);
            z-index: 2;
            position: relative;
            margin-top: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }

        .envelope-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 15% 25%, rgba(139, 115, 85, 0.05) 3px, transparent 3px),
                radial-gradient(circle at 85% 75%, rgba(139, 115, 85, 0.05) 3px, transparent 3px);
            background-size: 40px 40px;
            z-index: 0;
        }

        .envelope-back {
            background: linear-gradient(135deg, #f5f1e6, #e8dfd1);
            transform: rotateY(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d4c9b8;
        }

        .envelope-container:hover .envelope {
            transform: rotateY(10deg) translateY(-5px);
        }

        .envelope-container.open .envelope {
            transform: rotateY(180deg);
        }

        .envelope-hint {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            color: var(--warm-brown);
            margin-top: 15px;
            opacity: 0.9;
            background: rgba(245, 241, 230, 0.7);
            padding: 8px 20px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        /* å¼¹çª—æ ·å¼ */
        .answer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            background: rgba(107, 142, 159, 0.7);
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(3px);
        }

        .letter-container {
            width: 90%;
            max-width: 900px;
            height: 80vh;
            background: #F5F1E6;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(107, 142, 159, 0.4);
            overflow: hidden;
            transform: scale(0);
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #d4c9b8;
        }

        .answer-modal.open .letter-container {
            transform: scale(1);
        }

        .letter-header {
            background: linear-gradient(135deg, #8B7355, #6B5A45);
            padding: 25px 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-bottom: 2px dashed #A5947A;
        }

        .letter-title {
            font-family: 'Reenie Beanie', cursive;
            font-size: 3rem;
            color: #F5F1E6;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            letter-spacing: 2px;
        }

        .letter-subtitle {
            color: rgba(245, 241, 230, 0.9);
            font-size: 1.3rem;
            font-family: 'Gochi Hand', cursive;
        }

        .close-letter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(245, 241, 230, 0.2);
            color: #F5F1E6;
            border: 1px solid rgba(245, 241, 230, 0.3);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .close-letter:hover {
            background: rgba(245, 241, 230, 0.3);
            transform: rotate(90deg);
        }

        .letter-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #F5F1E6;
            position: relative;
        }

        .letter-body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background-image:
                linear-gradient(90deg, transparent 98%, rgba(139, 115, 85, 0.1) 98%),
                linear-gradient(rgba(139, 115, 85, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }

        /* MDå†…å®¹æ ·å¼ */
        .md-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .md-section {
            margin-bottom: 40px;
        }

        .md-section h1 {
            font-family: 'Reenie Beanie', cursive;
            font-size: 3rem;
            color: var(--warm-brown);
            margin-bottom: 20px;
            border-bottom: 2px dashed #A5947A;
            padding-bottom: 10px;
            text-align: center;
        }

        .md-section h2 {
            font-family: 'Reenie Beanie', cursive;
            font-size: 2.2rem;
            color: var(--warm-brown);
            margin: 30px 0 15px 0;
            position: relative;
            padding-left: 25px;
        }

        .md-section h2::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            top: 0;
            color: var(--warm-red);
            font-size: 2.5rem;
        }

        .md-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            justify-content: center;
        }

        .md-tag {
            background: rgba(139, 115, 85, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--warm-brown);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }

        .md-highlight {
            background: rgba(107, 142, 159, 0.1);
            border-left: 5px solid var(--vintage-blue);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(107, 142, 159, 0.2);
        }

        .md-content pre {
            background: #2d2a2e;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3), 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #3a363b;
        }

        .md-content code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
        }

        .md-content .inline-code {
            background: rgba(139, 115, 85, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            color: var(--warm-brown);
            font-size: 0.9em;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }

        .md-content ul,
        .md-content ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .md-content li {
            margin-bottom: 8px;
            line-height: 1.7;
        }

        .md-content blockquote {
            border-left: 4px solid var(--vintage-blue);
            padding-left: 20px;
            margin: 20px 0;
            font-style: italic;
            color: #666;
            background: rgba(107, 142, 159, 0.05);
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }

        .md-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }

        .md-content th,
        .md-content td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(139, 115, 85, 0.2);
        }

        .md-content th {
            background: linear-gradient(135deg, var(--warm-brown), #6B5A45);
            color: #F5F1E6;
            font-weight: bold;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.1rem;
        }

        .md-content tr:nth-child(even) {
            background: rgba(139, 115, 85, 0.05);
        }

        .signature {
            text-align: right;
            margin-top: 40px;
            font-family: 'Reenie Beanie', cursive;
            font-size: 2rem;
            color: var(--warm-brown);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .hero-section {
                padding: 25px;
            }

            .section {
                padding: 20px;
            }

            .key-points {
                grid-template-columns: 1fr;
            }

            .envelope-container {
                width: 300px;
                height: 210px;
            }

            .envelope-flap {
                border-left: 150px solid transparent;
                border-right: 150px solid transparent;
                border-bottom: 60px solid #e8dfd1;
            }

            .envelope-flap::after {
                border-left: 150px solid transparent;
                border-right: 150px solid transparent;
                border-bottom: 57px solid #f9f3e9;
                left: -150px;
            }

            .envelope-text {
                font-size: 2rem;
            }

            .answer-modal {
                padding: 10px;
            }

            .letter-container {
                width: 95%;
                height: 85vh;
            }

            .letter-title {
                font-size: 2.2rem;
            }

            .md-section h1 {
                font-size: 2.2rem;
            }

            .md-section h2 {
                font-size: 1.8rem;
            }
        }
    </style>

    <style>
        /* éšè— mermaid æ¸²æŸ“ç»„ä»¶ */
        .md-content section.js-render-needs-enrichment,
        .md-content .js-render-enrichment-target,
        .md-content .js-render-block-actions,
        .md-content .render-container,
        .md-content .js-render-enrichment-fallback,
        .md-content details[class*="details"],
        .md-content iframe[title="File display"] {
            display: none !important;
        }

        /* ä¿®å¤ GitHub ä»£ç å—æ ·å¼ */
        .md-content .highlight,
        .md-content .highlight-source-solidity,
        .md-content .highlight-source-js,
        .md-content .highlight-source-javascript {
            background: #2d2a2e !important;
            border-radius: 10px;
            padding: 20px !important;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3), 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #3a363b;
        }

        .md-content .highlight pre,
        .md-content .highlight-source-solidity pre,
        .md-content .highlight-source-js pre {
            background: transparent !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
        }

        /* åŸºç¡€ä»£ç æ–‡å­—é¢œè‰² - ç¡®ä¿æ‰€æœ‰æ–‡å­—éƒ½å¯è§ */
        .md-content .highlight pre {
            color: #f8f8f2 !important;
        }
        
        .md-content .highlight code,
        .md-content .highlight pre code,
        .md-content .highlight pre span,
        .md-content .highlight pre * {
            /* Added to ensure all text in pre is visible */
            color: #f8f8f2 !important;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* ç¡®ä¿ä»£ç å—å†…æ‰€æœ‰æ–‡å­—ï¼ˆåŒ…æ‹¬æ²¡æœ‰ span åŒ…è£¹çš„æ–‡å­—ï¼‰éƒ½å¯è§ */
        .md-content .highlight pre,
        .md-content .highlight pre code {
            color: #f8f8f2 !important;
        }
        
        /* ç‰¹åˆ«å¤„ç†ä»£ç å—ä¸­çš„çº¯æ–‡æœ¬èŠ‚ç‚¹ï¼ˆæ²¡æœ‰è¢« span åŒ…è£¹çš„æ–‡å­—ï¼Œå¦‚å˜é‡åï¼‰ */
        .md-content .highlight pre {
            color: #f8f8f2 !important;
        }
        
        /* ç¡®ä¿æ‰€æœ‰ç›´æ¥æ–‡æœ¬å†…å®¹éƒ½å¯è§ - è¦†ç›–ç»§æ‰¿çš„é¢œè‰² */
        .md-content .highlight pre * {
            color: #f8f8f2 !important;
        }
        
        /* ç‰¹åˆ«å¤„ç†å˜é‡å - ç¡®ä¿æ¸…æ™°å¯è§ */
        .md-content .highlight pre span.pl-v,
        .md-content .highlight pre span.pl-en,
        .md-content .highlight pre span.pl-e {
            color: #dcdcaa !important;
            font-weight: 500 !important;
        }

        /* GitHub è¯­æ³•é«˜äº®ç±»é¢œè‰²ä¿®å¤ */
        .md-content .highlight [class*="pl-"] {
            color: #f8f8f2 !important;
            /* Default to light color */
        }

        .md-content .highlight .pl-c {
            /* æ³¨é‡Š */
            color: #6a9955 !important;
        }

        .md-content .highlight .pl-s,
        .md-content .highlight .pl-s1 {
            /* å­—ç¬¦ä¸² */
            color: #ce9178 !important;
        }

        .md-content .highlight .pl-k,
        .md-content .highlight .pl-c1 {
            /* å…³é”®å­—/å¸¸é‡ */
            color: #569cd6 !important;
        }

        .md-content .highlight .pl-v,
        .md-content .highlight .pl-en,
        .md-content .highlight .pl-e,
        .md-content .highlight .pl-ent {
            /* å˜é‡/å‡½æ•°å/å®ä½“å - ç¡®ä¿æ¸…æ™°å¯è§ */
            color: #dcdcaa !important;
            font-weight: 500 !important;
        }
        
        /* ç¡®ä¿æ‰€æœ‰ span æ ‡ç­¾å†…çš„å˜é‡åéƒ½å¯è§ */
        .md-content .highlight pre span.pl-v,
        .md-content .highlight pre span.pl-en,
        .md-content .highlight pre span.pl-e {
            color: #dcdcaa !important;
            font-weight: 500 !important;
        }
        
        /* å¼ºåˆ¶æ‰€æœ‰ä»£ç å—å†…çš„æ–‡å­—å¯è§ï¼ŒåŒ…æ‹¬æ²¡æœ‰ç±»çš„å…ƒç´  */
        .md-content .highlight pre {
            color: #f8f8f2 !important;
        }
        
        /* ç¡®ä¿æ‰€æœ‰æ²¡æœ‰ç‰¹å®šé«˜äº®ç±»çš„æ–‡å­—éƒ½ä½¿ç”¨é»˜è®¤é¢œè‰² */
        .md-content .highlight pre *:not(.pl-c):not(.pl-s):not(.pl-s1):not(.pl-k):not(.pl-c1):not(.pl-v):not(.pl-en):not(.pl-e) {
            color: #f8f8f2 !important;
        }
        
        /* ç‰¹åˆ«å¤„ç†å˜é‡åï¼Œç¡®ä¿é•¿å˜é‡åæ¸…æ™°å¯è§ */
        .md-content .highlight pre span[class*="pl-v"],
        .md-content .highlight pre span[class*="pl-en"] {
            color: #dcdcaa !important;
            font-weight: 500 !important;
        }

        .md-content code {
            background-color: rgba(139, 115, 85, 0.15);
            color: var(--warm-brown);
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <div class="nav-bar">
        <div class="nav-left">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
            </a>
            <span class="nav-title">ç¬¬23å¤©</span>
        </div>
        <div class="nav-right">
            <a href="#concepts" class="nav-btn">ğŸ“š æ ¸å¿ƒæ¦‚å¿µ</a>
            <a href="#code" class="nav-btn">ğŸ’» ä»£ç è®²è§£</a>
            <a href="#practice" class="nav-btn">ğŸ¯ ç»ƒä¹ </a>
        </div>
    </div>

    <div class="container">
        <div class="hero-section">
            <div class="hero-header">
                <div class="hero-title">
                    <div class="day-badge">ç¬¬ 23 å¤©</div>
                    <h1>ğŸ’° LendingPool å€Ÿè´·æ± åˆçº¦</h1>
                    <p class="subtitle">æ„å»ºåŸºç¡€DeFiå€Ÿè´·å¹³å° - æ¢ç´¢å»ä¸­å¿ƒåŒ–é‡‘èçš„æ ¸å¿ƒæœºåˆ¶</p>
                </div>
                <div class="meta-tags">
                    <div class="difficulty-badge" style="background: var(--expert);">
                        å›°éš¾ â­â­â­â­
                    </div>
                    <span class="tag">DeFi</span>
                    <span class="tag">å€Ÿè´·åè®®</span>
                    <span class="tag">æŠµæŠ¼æœºåˆ¶</span>
                    <span class="tag">åˆ©æ¯è®¡ç®—</span>
                </div>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <div class="key-point-title">ğŸ¯ å­¦ä¹ ç›®æ ‡</div>
                    <div>æ„å»ºåŸºç¡€DeFiå€Ÿè´·åè®®ï¼Œç†è§£å»ä¸­å¿ƒåŒ–é‡‘èæ ¸å¿ƒæœºåˆ¶</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ› ï¸ æ ¸å¿ƒæŠ€èƒ½</div>
                    <div>åŸºç‚¹è®¡ç®—ã€åˆ©æ¯ç´¯ç§¯ã€æŠµæŠ¼ç‡ç®¡ç†ã€æµåŠ¨æ€§æ§åˆ¶</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">â° é¢„è®¡æ—¶é—´</div>
                    <div>4-5å°æ—¶ (ç†è§£+ç¼–ç +æµ‹è¯•)</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ“Š ä¸»è§‚æ„Ÿå—éš¾åº¦</div>
                    <div>â­â­â­â­â­ æéš¾ - å¤æ‚çš„DeFié‡‘èé€»è¾‘å’Œç²¾ç¡®æ•°å­¦è®¡ç®—</div>
                </div>
            </div>

            <div class="key-points" style="margin-top: 20px;">
                <div class="key-point">
                    <div class="key-point-title">ğŸ“Š åŒé‡è´¦æœ¬ç³»ç»Ÿ</div>
                    <div>åˆ†åˆ«è¿½è¸ªç”¨æˆ·çš„å­˜æ¬¾ä½™é¢ã€å€Ÿæ¬¾ä½™é¢å’ŒæŠµæŠ¼å“ä½™é¢</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">â° åˆ©ç‡æœºåˆ¶</div>
                    <div>è®¾ç½®5%çš„å¹´åŒ–åˆ©ç‡,åŸºäºæ—¶é—´è®¡ç®—åˆ©æ¯</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ” è¿‡åº¦æŠµæŠ¼</div>
                    <div>é‡‡ç”¨75%çš„æŠµæŠ¼ç‡,è¦æ±‚å€Ÿæ¬¾å¿…é¡»æœ‰å……è¶³æŠµæŠ¼</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ’§ æµåŠ¨æ€§ç®¡ç†</div>
                    <div>è·Ÿè¸ªåˆçº¦æ€»æµåŠ¨æ€§,ç¡®ä¿æœ‰è¶³å¤Ÿèµ„é‡‘ä¾›å€Ÿæ¬¾</div>
                </div>
            </div>
        </div>

        <div class="section" id="concepts">
            <h2 class="section-title">
                <i class="fas fa-lightbulb"></i> æ ¸å¿ƒæ¦‚å¿µ
            </h2>

            <div class="concept-card">
                <div class="concept-title">ğŸ¦ DeFiå€Ÿè´·æœºåˆ¶</div>
                <p>å»ä¸­å¿ƒåŒ–å€Ÿè´·ä¸ä¼ ç»Ÿé‡‘èçš„å¯¹æ¯”:</p>

                <ol class="steps-list">
                    <li>
                        <strong>å­˜æ¬¾äººå­˜å…¥ETH</strong><br>
                        æä¾›æµåŠ¨æ€§,æˆä¸ºèµ„é‡‘ä¾›ç»™æ–¹,æœªæ¥å¯èµšå–åˆ©æ¯
                    </li>
                    <li>
                        <strong>å€Ÿæ¬¾äººå­˜å…¥æŠµæŠ¼å“</strong><br>
                        é”å®šETHä½œä¸ºæŠµæŠ¼,å»ºç«‹ä¿¡ç”¨åŸºç¡€
                    </li>
                    <li>
                        <strong>å€Ÿæ¬¾äººå€Ÿå‡ºETH</strong><br>
                        åŸºäºæŠµæŠ¼å“ä»·å€¼è®¡ç®—å¯å€Ÿé¢åº¦,æ”¯ä»˜åˆ©æ¯
                    </li>
                    <li>
                        <strong>å€Ÿæ¬¾äººå¿è¿˜è´·æ¬¾</strong><br>
                        å½’è¿˜æœ¬é‡‘+åˆ©æ¯,é‡Šæ”¾æŠµæŠ¼å“
                    </li>
                    <li>
                        <strong>æå–æŠµæŠ¼å“/å­˜æ¬¾</strong><br>
                        å€Ÿæ¬¾è¿˜æ¸…åå–å›æŠµæŠ¼å“,æˆ–æå–å­˜æ¬¾
                    </li>
                </ol>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>å¯¹æ¯”ç»´åº¦</th>
                            <th>ä¼ ç»Ÿå€Ÿè´·</th>
                            <th>DeFiå€Ÿè´·</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ä¿¡ç”¨å®¡æ ¸</strong></td>
                            <td>éœ€è¦ä¿¡ç”¨è®°å½•ã€æ”¶å…¥è¯æ˜</td>
                            <td>æ— éœ€KYC,ä»…éœ€æŠµæŠ¼å“</td>
                        </tr>
                        <tr>
                            <td><strong>å®¡æ‰¹æ—¶é—´</strong></td>
                            <td>æ•°å¤©åˆ°æ•°å‘¨</td>
                            <td>å³æ—¶(ä¸€ç¬”äº¤æ˜“)</td>
                        </tr>
                        <tr>
                            <td><strong>æŠµæŠ¼ç‡</strong></td>
                            <td>é€šå¸¸80-100%</td>
                            <td>è¶…é¢æŠµæŠ¼(æœ¬ä¾‹133%)</td>
                        </tr>
                        <tr>
                            <td><strong>é€æ˜åº¦</strong></td>
                            <td>ä½,æ¡æ¬¾å¤æ‚</td>
                            <td>é«˜,ä»£ç å…¬å¼€</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="concept-card important">
                <div class="concept-title">ğŸ“Š åŸºç‚¹(Basis Points)ç³»ç»Ÿ</div>
                <p>é‡‘èé¢†åŸŸå¸¸ç”¨çš„ç²¾ç¡®ç™¾åˆ†æ¯”è¡¨ç¤ºæ–¹æ³•:</p>

                <div class="success-box">
                    <strong>åŸºç‚¹æ¢ç®—å…³ç³»</strong><br>
                    1 Basis Point = 0.01% = 0.0001<br>
                    100 Basis Points = 1%<br>
                    10000 Basis Points = 100%
                </div>

                <pre><code class="language-solidity">// åˆ©ç‡: 500 åŸºç‚¹ = 5%
uint256 public interestRateBasisPoints = 500;

// æŠµæŠ¼ç‡: 7500 åŸºç‚¹ = 75%
uint256 public collateralFactorBasisPoints = 7500;

// è®¡ç®—å®é™…é‡‘é¢
uint256 maxBorrow = (collateral * 7500) / 10000;
// å¦‚æœæŠµæŠ¼ 100 ETH: 100 * 7500 / 10000 = 75 ETH</code></pre>

                <div class="success-box">
                    <strong>ğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨åŸºç‚¹?</strong><br>
                    Solidityä¸æ”¯æŒå°æ•°è¿ç®—,åŸºç‚¹ç³»ç»Ÿæä¾›äº†ä¸€ç§æ•´æ•°è¡¨ç¤ºç™¾åˆ†æ¯”çš„æ–¹æ³•,åŒæ—¶ä¿æŒç²¾ç¡®åº¦ã€‚ä½¿ç”¨10000ä½œä¸ºåŸºæ•°å¯ä»¥ç²¾ç¡®åˆ°0.01%ã€‚
                </div>
            </div>

            <div class="concept-card tip">
                <div class="concept-title">ğŸ” æŠµæŠ¼ç‡ä¸æ¸…ç®—æœºåˆ¶</div>
                <p>ç†è§£è¿‡åº¦æŠµæŠ¼çš„å¿…è¦æ€§:</p>

                <div class="formula-box">
                    æŠµæŠ¼ç‡ = å€Ÿæ¬¾é¢ / æŠµæŠ¼å“ä»·å€¼ Ã— 100%
                </div>

                <div class="success-box">
                    <strong>æŠµæŠ¼ç‡75%çš„å«ä¹‰</strong><br>
                    å¦‚æœä½ æœ‰ <strong>100 ETH</strong> æŠµæŠ¼å“:<br>
                    æœ€å¤§å¯å€Ÿ: <strong>100 Ã— 75% = 75 ETH</strong><br>
                    å®é™…æŠµæŠ¼ç‡: <strong>100 / 75 = 133%</strong> (è¶…é¢æŠµæŠ¼)
                </div>

                <pre><code class="language-solidity">function getMaxBorrowAmount(address user) 
    public view returns (uint256) 
{
    uint256 collateral = collateralBalances[user];
    uint256 currentBorrow = borrowBalances[user];
    
    // è®¡ç®—æœ€å¤§å¯å€Ÿé‡‘é¢
    uint256 maxBorrow = (collateral * collateralFactorBasisPoints) / 10000;
    
    // å‡å»å·²å€Ÿé‡‘é¢,å¾—åˆ°å‰©ä½™å¯å€Ÿé¢åº¦
    if (maxBorrow <= currentBorrow) return 0;
    return maxBorrow - currentBorrow;
}</code></pre>

                <div class="warning-box">
                    <strong>âš ï¸ æœ¬åˆçº¦çš„ç®€åŒ–ä¹‹å¤„:</strong><br>
                    çœŸå®DeFiåè®®(å¦‚Aave)ä¼šåœ¨æŠµæŠ¼ç‡ä¸è¶³æ—¶è§¦å‘æ¸…ç®—,è‡ªåŠ¨å‡ºå”®æŠµæŠ¼å“å¿è¿˜å€ºåŠ¡ã€‚æœ¬åˆçº¦ä»…åœ¨æå–æŠµæŠ¼å“æ—¶æ£€æŸ¥,æ²¡æœ‰å®ç°ä¸»åŠ¨æ¸…ç®—åŠŸèƒ½ã€‚
                </div>
            </div>

            <div class="concept-card">
                <div class="concept-title">â° åˆ©æ¯è®¡ç®—æœºåˆ¶</div>
                <p>åŸºäºæ—¶é—´çš„å¤åˆ©è®¡ç®—:</p>

                <div class="formula-box">
                    åˆ©æ¯ = æœ¬é‡‘ Ã— å¹´åˆ©ç‡ Ã— æ—¶é—´(ç§’) / (365å¤©çš„ç§’æ•° Ã— 10000)
                </div>

                <pre><code class="language-solidity">function calculateInterestAccrued(address user) 
    public view returns (uint256) 
{
    if (lastInterestAccrualTimestamp == 0) return 0;
    
    // è®¡ç®—ç»è¿‡çš„æ—¶é—´(ç§’)
    uint256 timeElapsed = block.timestamp - lastInterestAccrualTimestamp;
    uint256 principal = borrowBalances[user];
    
    // ç®€åŒ–åˆ©æ¯å…¬å¼: principal * rate * time / (365 days * 10000)
    uint256 interest = (principal * interestRateBasisPoints * timeElapsed) 
                      / (365 days * 10000);
    return interest;
}</code></pre>

                <div class="success-box">
                    <strong>å®é™…è®¡ç®—ç¤ºä¾‹</strong><br>
                    <strong>å€Ÿæ¬¾:</strong> 10 ETH<br>
                    <strong>å¹´åˆ©ç‡:</strong> 5% (500åŸºç‚¹)<br>
                    <strong>æ—¶é—´:</strong> 30å¤©<br>
                    <strong>åˆ©æ¯ = 10 Ã— 500 Ã— (30Ã—24Ã—3600) / (365Ã—24Ã—3600 Ã— 10000)</strong><br>
                    = 10 Ã— 500 Ã— 2,592,000 / 315,360,000,000<br>
                    â‰ˆ 0.041 ETH
                </div>
            </div>
        </div>

        <div class="section" id="code">
            <h2 class="section-title">
                <i class="fas fa-code"></i> ä»£ç è¯¦è§£
            </h2>

            <h3>ğŸ“¦ çŠ¶æ€å˜é‡è®¾è®¡</h3>
            <pre><code class="language-solidity">// ç”¨æˆ·å­˜æ¬¾ä½™é¢ - æµåŠ¨æ€§æä¾›è€…çš„èµ„é‡‘
mapping(address => uint256) public depositBalances;

// ç”¨æˆ·å€Ÿæ¬¾ä½™é¢ - å€Ÿæ¬¾äººæ¬ æ¬¾
mapping(address => uint256) public borrowBalances;

// ç”¨æˆ·æŠµæŠ¼å“ä½™é¢ - å€Ÿæ¬¾çš„æ‹…ä¿
mapping(address => uint256) public collateralBalances;

// å¹´åŒ–åˆ©ç‡: 500åŸºç‚¹ = 5%
uint256 public interestRateBasisPoints = 500;

// æŠµæŠ¼å› å­: 7500åŸºç‚¹ = 75%
uint256 public collateralFactorBasisPoints = 7500;

// ä¸Šæ¬¡è®¡æ¯æ—¶é—´æˆ³
uint256 public lastInterestAccrualTimestamp;</code></pre>

            <div class="success-box">
                <strong>ğŸ’¡ è®¾è®¡æ€è·¯:</strong> ä¸‰ä¸ªç‹¬ç«‹çš„mappingåˆ†åˆ«è¿½è¸ªå­˜æ¬¾ã€å€Ÿæ¬¾å’ŒæŠµæŠ¼å“,è¿™æ ·åŒä¸€ä¸ªåœ°å€å¯ä»¥æ—¢æ˜¯å­˜æ¬¾äººåˆæ˜¯å€Ÿæ¬¾äºº,äº’ä¸å½±å“ã€‚
            </div>

            <h3>ğŸ’° å­˜æ¬¾ä¸ææ¬¾åŠŸèƒ½</h3>
            <pre><code class="language-solidity">function deposit() external payable {
    require(msg.value > 0, "Must deposit something");
    
    // å¢åŠ ç”¨æˆ·çš„å­˜æ¬¾ä½™é¢
    depositBalances[msg.sender] += msg.value;
}

function withdraw(uint256 amount) external {
    // æ£€æŸ¥å­˜æ¬¾ä½™é¢æ˜¯å¦å……è¶³
    require(depositBalances[msg.sender] >= amount, 
            "Insufficient balance");
    
    // å…ˆå‡å°‘ä½™é¢(CEIæ¨¡å¼)
    depositBalances[msg.sender] -= amount;
    
    // å†è½¬è´¦ETH
    payable(msg.sender).transfer(amount);
}</code></pre>

            <div class="success-box">
                <strong>âœ… æµåŠ¨æ€§æä¾›:</strong> ç”¨æˆ·å­˜å…¥ETH,ä¸ºå¹³å°æä¾›æµåŠ¨æ€§,è¿™äº›èµ„é‡‘å¯ä»¥è¢«å…¶ä»–äººå€Ÿèµ°ã€‚åœ¨çœŸå®åè®®ä¸­,å­˜æ¬¾äººä¼šè·å¾—åˆ©æ¯ä»£å¸(å¦‚Compoundçš„cToken)ã€‚
            </div>

            <h3>ğŸ”’ æŠµæŠ¼å“ç®¡ç†</h3>
            <pre><code class="language-solidity">// å­˜å…¥æŠµæŠ¼å“
function depositCollateral() external payable {
    require(msg.value > 0, "Must deposit collateral");
    collateralBalances[msg.sender] += msg.value;
}

// æå–æŠµæŠ¼å“
function withdrawCollateral(uint256 amount) external {
    require(collateralBalances[msg.sender] >= amount, 
            "Insufficient collateral");
    
    // è®¡ç®—ä¿ç•™æœ€ä½æŠµæŠ¼åçš„æœ€å¤§å¯æå–é‡‘é¢
    // å…¬å¼: å½“å‰æŠµæŠ¼ - (å€Ÿæ¬¾é¢ / æŠµæŠ¼ç‡)
    uint256 maxWithdraw = collateralBalances[msg.sender] - 
        (borrowBalances[msg.sender] * 10000) / collateralFactorBasisPoints;
    
    // ç¡®ä¿ä¸ä¼šå¯¼è‡´æŠµæŠ¼ä¸è¶³
    require(amount <= maxWithdraw, 
            "Would under-collateralize loan");
    
    collateralBalances[msg.sender] -= amount;
    payable(msg.sender).transfer(amount);
}</code></pre>

            <div class="success-box">
                <strong>æŠµæŠ¼å“æå–é€»è¾‘è¯¦è§£</strong><br>
                å‡è®¾: ç”¨æˆ·æŠµæŠ¼äº† 100 ETH, å€Ÿäº† 50 ETH, æŠµæŠ¼ç‡ 75%<br>
                æœ€ä½éœ€è¦çš„æŠµæŠ¼ = 50 Ã— 10000 / 7500 = 66.67 ETH<br>
                æœ€å¤§å¯æå– = 100 - 66.67 = 33.33 ETH
            </div>

            <h3>ğŸ“¤ å€Ÿæ¬¾ä¸è¿˜æ¬¾åŠŸèƒ½</h3>
            <pre><code class="language-solidity">function borrow(uint256 amount) external {
    // è®¡ç®—ç”¨æˆ·æœ€å¤§å¯å€Ÿé‡‘é¢
    uint256 maxBorrow = getMaxBorrowAmount(msg.sender);
    
    // æ£€æŸ¥æ˜¯å¦è¶…è¿‡å¯å€Ÿé¢åº¦
    require(amount <= maxBorrow, "Insufficient collateral");
    
    // å¢åŠ å€Ÿæ¬¾ä½™é¢
    borrowBalances[msg.sender] += amount;
    
    // è½¬è´¦ETHç»™å€Ÿæ¬¾äºº
    payable(msg.sender).transfer(amount);
}

function repay() external payable {
    require(msg.value > 0, "Must repay something");
    require(borrowBalances[msg.sender] > 0, "No loan to repay");
    
    uint256 repayAmount = msg.value;
    
    // å¦‚æœè¿˜æ¬¾é‡‘é¢è¶…è¿‡æ¬ æ¬¾,é€€å›å¤šä½™éƒ¨åˆ†
    if (repayAmount > borrowBalances[msg.sender]) {
        repayAmount = borrowBalances[msg.sender];
        // é€€å›å¤šä»˜çš„é‡‘é¢
        payable(msg.sender).transfer(msg.value - repayAmount);
    }
    
    // å‡å°‘å€Ÿæ¬¾ä½™é¢
    borrowBalances[msg.sender] -= repayAmount;
}</code></pre>

            <div class="warning-box">
                <strong>âš ï¸ æµåŠ¨æ€§é£é™©:</strong> æœ¬åˆçº¦æ²¡æœ‰æ£€æŸ¥æ± å­é‡Œæ˜¯å¦æœ‰è¶³å¤Ÿçš„ETHå¯å€Ÿã€‚çœŸå®åè®®ä¼šæ£€æŸ¥å¯ç”¨æµåŠ¨æ€§,å¦‚æœæµåŠ¨æ€§ä¸è¶³ä¼šæ‹’ç»å€Ÿæ¬¾ã€‚
            </div>

            <h3>ğŸ“Š æŸ¥è¯¢å‡½æ•°</h3>
            <pre><code class="language-solidity">// è·å–æ€»æµåŠ¨æ€§
function getTotalLiquidity() public view returns (uint256) {
    // åˆçº¦åœ°å€çš„ETHä½™é¢ = å­˜æ¬¾æ€»é¢ - å€Ÿå‡ºæ€»é¢ + æŠµæŠ¼å“æ€»é¢
    return address(this).balance;
}</code></pre>
        </div>

        <div class="section" id="practice">
            <h2 class="section-title">
                <i class="fas fa-dumbbell"></i> å®è·µè¦ç‚¹
            </h2>

            <div class="concept-card">
                <div class="concept-title">ğŸ“ å®Œæ•´çš„å€Ÿè´·æµç¨‹</div>
                <p><strong>ä»»åŠ¡:</strong> æ¨¡æ‹ŸAliceå’ŒBobçš„å€Ÿè´·åœºæ™¯</p>
                <ol class="steps-list">
                    <li>Aliceå­˜å…¥100 ETHä½œä¸ºæµåŠ¨æ€§</li>
                    <li>Bobå­˜å…¥50 ETHä½œä¸ºæŠµæŠ¼å“</li>
                    <li>Bobå€Ÿå‡º30 ETH(ä½äº75% Ã— 50 = 37.5çš„æœ€å¤§é¢åº¦)</li>
                    <li>30å¤©åBobè®¡ç®—åº”ä»˜åˆ©æ¯</li>
                    <li>Bobå½’è¿˜æœ¬é‡‘+åˆ©æ¯</li>
                    <li>Bobæå–æŠµæŠ¼å“</li>
                </ol>

                <pre><code class="language-solidity">// æ­¥éª¤1: Aliceå­˜æ¬¾
lendingPool.deposit{value: 100 ether}();

// æ­¥éª¤2: Bobå­˜å…¥æŠµæŠ¼å“
lendingPool.depositCollateral{value: 50 ether}();

// æ­¥éª¤3: Bobå€Ÿæ¬¾
uint256 maxBorrow = lendingPool.getMaxBorrowAmount(bob);
// maxBorrow = 50 * 7500 / 10000 = 37.5 ETH
lendingPool.borrow(30 ether);

// æ­¥éª¤4: 30å¤©åæŸ¥è¯¢åˆ©æ¯
uint256 interest = lendingPool.calculateInterestAccrued(bob);
// é¢„æœŸ: ~0.123 ETH

// æ­¥éª¤5: è¿˜æ¬¾(æ³¨æ„:æœ¬åˆçº¦åªè¿˜æœ¬é‡‘,çœŸå®åœºæ™¯åº”è¯¥è¿˜æœ¬é‡‘+åˆ©æ¯)
lendingPool.repay{value: 30 ether}();

// æ­¥éª¤6: æå–æŠµæŠ¼å“
lendingPool.withdrawCollateral(50 ether);</code></pre>
            </div>

            <div class="concept-card important">
                <div class="concept-title">ğŸ”§ è®¡ç®—å®é™…å¯å€Ÿé‡‘é¢</div>
                <p><strong>åœºæ™¯:</strong> ç»™å®šä¸åŒçš„æŠµæŠ¼å’Œå€Ÿæ¬¾çŠ¶æ€,è®¡ç®—å¯å€Ÿé¢åº¦</p>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>æŠµæŠ¼å“</th>
                            <th>å·²å€Ÿé‡‘é¢</th>
                            <th>è®¡ç®—è¿‡ç¨‹</th>
                            <th>å¯å€Ÿé¢åº¦</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>100 ETH</td>
                            <td>0 ETH</td>
                            <td>100 Ã— 75% - 0</td>
                            <td>75 ETH</td>
                        </tr>
                        <tr>
                            <td>100 ETH</td>
                            <td>50 ETH</td>
                            <td>100 Ã— 75% - 50</td>
                            <td>25 ETH</td>
                        </tr>
                        <tr>
                            <td>100 ETH</td>
                            <td>75 ETH</td>
                            <td>100 Ã— 75% - 75</td>
                            <td>0 ETH</td>
                        </tr>
                        <tr>
                            <td>50 ETH</td>
                            <td>40 ETH</td>
                            <td>50 Ã— 75% - 40</td>
                            <td>0 ETH (å®é™…-2.5)</td>
                        </tr>
                    </tbody>
                </table>
                <div class="warning-box">
                    <strong>âš ï¸ æ³¨æ„:</strong> æœ€åä¸€è¡Œçš„æƒ…å†µæ˜¯æŠµæŠ¼ä¸è¶³,ç†è®ºä¸Šåº”è¯¥è¢«æ¸…ç®—!
                </div>
            </div>

            <div class="concept-card tip">
                <div class="concept-title">ğŸ¯ æ”¹è¿›åˆçº¦ - æ·»åŠ æ¸…ç®—åŠŸèƒ½</div>
                <p><strong>ç›®æ ‡:</strong> å®ç°ä¸€ä¸ª <span class="inline-code">liquidate()</span> å‡½æ•°,å½“å€Ÿæ¬¾äººæŠµæŠ¼ä¸è¶³æ—¶å¯ä»¥è¢«æ¸…ç®—</p>
                <pre><code class="language-solidity">function liquidate(address borrower) external payable {
    // TODO: å®ç°æ¸…ç®—é€»è¾‘
    // 1. æ£€æŸ¥å€Ÿæ¬¾äººæ˜¯å¦æŠµæŠ¼ä¸è¶³
    // 2. æ¸…ç®—äººä»£ä¸ºå¿è¿˜éƒ¨åˆ†å€ºåŠ¡
    // 3. æ¸…ç®—äººè·å¾—æŠµæŠ¼å“(å«å¥–åŠ±)
    // 4. æ›´æ–°å€Ÿæ¬¾äººçš„ä½™é¢
    
    // æç¤º: å¥åº·å› å­ = æŠµæŠ¼å“ä»·å€¼ Ã— æŠµæŠ¼ç‡ / å€Ÿæ¬¾é‡‘é¢
    // å¦‚æœå¥åº·å› å­ < 1,å¯ä»¥è¢«æ¸…ç®—
}</code></pre>
                <div class="success-box">
                    <strong>ğŸ’¡ æ€è€ƒé¢˜:</strong><br>
                    â€¢ æ¸…ç®—äººåº”è¯¥è·å¾—å¤šå°‘å¥–åŠ±?(é€šå¸¸5-10%)<br>
                    â€¢ æ˜¯å¦å…è®¸éƒ¨åˆ†æ¸…ç®—?<br>
                    â€¢ å¦‚ä½•é˜²æ­¢æ¸…ç®—äººæŠ¢è·‘(front-running)?
                </div>
            </div>

            <div class="concept-card">
                <div class="concept-title">âš¡ æ·»åŠ åˆ©æ¯è‡ªåŠ¨ç´¯ç§¯</div>
                <p><strong>ä»»åŠ¡:</strong> æ”¹é€ åˆçº¦,ä½¿åˆ©æ¯è‡ªåŠ¨ç´¯åŠ åˆ°å€Ÿæ¬¾ä½™é¢</p>
                <pre><code class="language-solidity">// éœ€è¦æ·»åŠ çš„åŠŸèƒ½
function accrueInterest() public {
    // TODO: å®ç°åˆ©æ¯ç´¯ç§¯é€»è¾‘
}

// ä¿®æ”¹borrowBalancesä½¿å…¶åŒ…å«ç´¯ç§¯åˆ©æ¯
function getCurrentBorrowBalance(address user) 
    public view returns (uint256) 
{
    // TODO: è¿”å›æœ¬é‡‘ + åˆ©æ¯
}</code></pre>
            </div>

            <div class="concept-card important">
                <div class="concept-title">ğŸŒŸ æŒ‘æˆ˜: å¤šå¸ç§æ”¯æŒ</div>
                <p><strong>é«˜çº§ä»»åŠ¡:</strong> æ‰©å±•åˆçº¦æ”¯æŒå¤šç§ERC20ä»£å¸ä½œä¸ºæŠµæŠ¼å“å’Œå€Ÿè´·èµ„äº§</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li>ç”¨æˆ·å¯ä»¥å­˜å…¥USDCã€DAIç­‰ç¨³å®šå¸</li>
                    <li>å¯ä»¥ç”¨WETHã€WBTCä½œä¸ºæŠµæŠ¼å“</li>
                    <li>éœ€è¦é›†æˆé¢„è¨€æœºè·å–ä»·æ ¼</li>
                    <li>ä¸åŒèµ„äº§æœ‰ä¸åŒçš„æŠµæŠ¼ç‡</li>
                </ul>
                <div class="warning-box">
                    <strong>âš ï¸ é¢å¤–æŒ‘æˆ˜:</strong> å¦‚ä½•å¤„ç†ä»·æ ¼æ³¢åŠ¨?å¦‚ä½•é˜²æ­¢é¢„è¨€æœºæ“çºµ?
                </div>
            </div>
        </div>

        <div class="navigation-footer">
            <a href="contract-22.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">â† ä¸Šä¸€ä¸ª</div>
                <div class="nav-footer-title">DecentralisedLottery - å»ä¸­å¿ƒåŒ–å½©ç¥¨</div>
            </a>
            <a href="contract-24.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">ä¸‹ä¸€ä¸ª â†’</div>
                <div class="nav-footer-title">DecentraliseEscrow - å»ä¸­å¿ƒåŒ–æ‰˜ç®¡</div>
            </a>
        </div>

        <!-- Snehaçš„ä¸€å°æ¥ä¿¡æ¨¡å— -->
        <div class="answer-reference">
            <div class="envelope-container" id="envelope-container">
                <div class="envelope">
                    <div class="envelope-front">
                        <div class="envelope-flap"></div>
                        <div class="envelope-pattern"></div>
                        <div class="envelope-seal">
                            <i class="fas fa-feather-alt seal-icon"></i>
                        </div>
                        <div class="envelope-text">Snehaçš„ä¸€å°æ¥ä¿¡</div>
                    </div>
                    <div class="envelope-back">
                        <div class="envelope-text" style="color: var(--warm-brown);">ç‚¹å‡»å¼€å¯</div>
                    </div>
                </div>
            </div>
            <div class="envelope-hint">ç‚¹å‡»ä¿¡å°æŸ¥çœ‹Snehaçš„æ¥ä¿¡</div>
        </div>
    </div>

    <!-- å¼¹çª— - å†…å®¹å¾…åç»­ç²¾ç»†åŒ–å¤„ç† -->
    <div class="answer-modal" id="answer-modal">
        <div class="letter-container">
            <div class="letter-header">
                <div class="letter-title">Snehaçš„ä¸€å°æ¥ä¿¡</div>
                <div class="letter-subtitle">å…³äºç¬¬23å¤©çš„å­¦ä¹ æŒ‡å¯¼</div>
                <button id="close-letter" class="close-letter">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="letter-body">
                <div id="md-content" class="md-content">
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">DeFi å€Ÿè´·åˆçº¦</h1></div>
<p dir="auto">Day: Day 23
ID: 23
è¯‘è€…: sun sun
éš¾åº¦ç­‰çº§: é«˜çº§</p>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">å­¦ä¹ å†…å®¹</h1></div>
<p dir="auto">æ¬¢è¿å›åˆ° 30 å¤© Solidity â€”â€” æ¯å¤©è§£é”æ™ºèƒ½åˆçº¦çš„ä¸€é¡¹æ–°è¶…èƒ½åŠ›ã€‚</p>
<p dir="auto">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»æ„å»ºäº†å¯ä»¥å‘é€å’Œæ¥æ”¶ ETH çš„åˆçº¦ï¼Œç”¨è®¿é—®æ§åˆ¶ä¿æŠ¤å®ƒä»¬ï¼Œç”šè‡³æ¶‰è¶³äº† NFTã€‚ä½†ä»Šå¤©å‘¢ï¼Ÿ</p>
<p dir="auto"><strong>ä»Šå¤©ï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ªé“¶è¡Œã€‚</strong></p>
<p dir="auto">ä¸æ˜¯é‚£ç§éœ€è¦æ’é•¿é˜Ÿã€å¡«å†™ç¹çæ–‡ä»¶å’Œéšè—è´¹ç”¨çš„ç±»å‹ã€‚</p>
<p dir="auto">ä¹Ÿä¸æ˜¯é‚£ç§ä¸‹åˆäº”ç‚¹å°±å…³é—¨çš„é‚£ç§ã€‚</p>
<p dir="auto">æˆ‘ä»¬è°ˆè®ºçš„æ˜¯ DeFiâ€”â€”å³å»ä¸­å¿ƒåŒ–é‡‘èçš„ç¼©å†™ã€‚</p>
<p dir="auto">è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæµè¡Œè¯æ±‡ã€‚DeFi æ˜¯åŒºå—é“¾é¢†åŸŸæœ€å…·å˜é©æ€§çš„è¿åŠ¨ä¹‹ä¸€ã€‚å®ƒå…³ä¹é‡å»ºæ•´ä¸ªé‡‘èä½“ç³»â€”â€”å€Ÿè´·ã€å‚¨è“„ã€äº¤æ˜“â€”â€”ä½†è¿™ä¸€åˆ‡éƒ½ä¸éœ€è¦ä¸­å¿ƒåŒ–æœºæ„çš„å‚ä¸ã€‚</p>
<p dir="auto">æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<p dir="auto">æ²¡æœ‰é“¶è¡Œå†»ç»“ä½ çš„è´¦æˆ·ã€‚</p>
<p dir="auto">æ²¡æœ‰è´·æ¬¾å‘˜è¯„åˆ¤ä½ çš„ä¿¡ç”¨ã€‚</p>
<p dir="auto">ä»…ä»£ç â€”â€”å¼€æ”¾ã€é€æ˜ã€ä¸å¯é˜»æŒ¡çš„ä»£ç â€”â€”ä»»ä½•äººéƒ½å¯ä»¥ä¸ä¹‹äº¤äº’ã€‚</p>
<p dir="auto">è¿™å°±æ˜¯ DeFi å¦‚æ­¤å¼ºå¤§çš„åŸå› ã€‚ä½ å°†ä¼ ç»Ÿé‡‘èçš„è§„åˆ™è½¬åŒ–ä¸ºæ™ºèƒ½åˆçº¦é€»è¾‘ï¼Œç„¶åè®©åŒºå—é“¾æ¥å®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚</p>
<p dir="auto">è€Œè¿™é‡Œçš„ç¥å¥‡ä¹‹å¤„åœ¨äºï¼šä¸€æ—¦éƒ¨ç½²ï¼Œåˆçº¦å°±ä¸å…³å¿ƒä½ æ˜¯è°ã€‚</p>
<p dir="auto">å¦‚æœæ•°å­—å¯¹å¾—ä¸Šâ€”â€”ä½ å¯ä»¥å€Ÿè´·ï¼Œä½ å¯ä»¥èµšå–åˆ©æ¯ã€‚</p>
<p dir="auto">æˆ‘ä»¬ä»Šå¤©è¦æ„å»ºä»€ä¹ˆï¼Ÿ</p>
<p dir="auto">æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„å€Ÿè´·æ± ã€‚</p>
<p dir="auto">ç±»ä¼¼äº Aave æˆ– Compound ç­‰å¹³å°æä¾›çš„è¿·ä½ ç‰ˆæœ¬â€”â€”ä½†æ›´å®¹æ˜“ç†è§£ã€‚</p>
<p dir="auto">&nbsp;ä½ å°†å­¦åˆ°ï¼š</p>
<p dir="auto">æ¥å—ç”¨æˆ·å­˜æ¬¾ ETH ğŸ’°</p>
<p dir="auto">è®©ä»–ä»¬é”å®šæŠµæŠ¼å“ä»¥è§£é”å€Ÿæ¬¾ ğŸ›¡ï¸</p>
<p dir="auto">éšæ—¶é—´æ”¶å–åˆ©æ¯ ğŸ“ˆ</p>
<p dir="auto">å…è®¸ç”¨æˆ·å¿è¿˜è´·æ¬¾å¹¶æå–èµ„é‡‘ âœ…</p>
<p dir="auto">è¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡äº²èº«ä½“éªŒ DeFi æœºåˆ¶â€”â€”ç›¸ä¿¡æˆ‘ï¼Œå®ƒå°†æ°¸è¿œæ”¹å˜ä½ å¯¹æ™ºèƒ½åˆçº¦çš„çœ‹æ³•ã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ” å¿«é€Ÿäº†è§£æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„å†…å®¹</strong></h3></div>
<p dir="auto">SimpleLending åˆçº¦æ˜¯ä½ é“¾ä¸Šç¬¬ä¸€ä¸ª DeFi é“¶è¡Œã€‚</p>
<p dir="auto">å®ƒå…è®¸ç”¨æˆ·ï¼š</p>
<ul dir="auto">
<li>å°† ETH å­˜å…¥æ± ä¸­</li>
<li>é”å®šæŠµæŠ¼å“ä»¥è·å–è´·æ¬¾</li>
<li>åŸºäºè¯¥æŠµæŠ¼å“å€Ÿå…¥ ETH</li>
<li>ç”¨åˆ©æ¯å¿è¿˜è´·æ¬¾</li>
<li>å®Œæˆåå†æå–èµ„é‡‘</li>
</ul>
<p dir="auto">æˆ‘ä»¬ä¿æŒå…¶ç®€æ´â€”â€”æ²¡æœ‰ ERC20ï¼Œæ²¡æœ‰å¤–éƒ¨ä»·æ ¼ä¿¡æ¯â€”â€”åªæ˜¯çº¯ç²¹çš„åŸºäº ETH çš„å€Ÿè´·é€»è¾‘ï¼Œå¸®åŠ©ä½ ç†è§£ DeFi çš„æ ¸å¿ƒè¿ä½œæ–¹å¼ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å®Œæ•´ä»£ç  ğŸ‘‡</p>
<p dir="auto"><strong>ğŸ§¾ å®Œæ•´åˆçº¦ï¼šSimpleLending.sol</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c">// SPDX-License-Identifier: MIT</span>
<span class="pl-k">pragma solidity</span> <span class="pl-k">^</span><span class="pl-c1">0.8.0</span>;

<span class="pl-c">/**</span>
<span class="pl-c"> * @title SimpleLending</span>
<span class="pl-c"> * @dev A basic DeFi lending and borrowing platform</span>
<span class="pl-c"> */</span>
<span class="pl-k">contract</span> <span class="pl-en">SimpleLending</span> {
    <span class="pl-c">// Token balances for each user</span>
    <span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> depositBalances;

    <span class="pl-c">// Borrowed amounts for each user</span>
    <span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> borrowBalances;

    <span class="pl-c">// Collateral provided by each user</span>
    <span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> collateralBalances;

    <span class="pl-c">// Interest rate in basis points (1/100 of a percent)</span>
    <span class="pl-c">// 500 basis points = 5% interest</span>
    <span class="pl-c1">uint256</span> <span class="pl-k">public </span>interestRateBasisPoints <span class="pl-k">=</span> <span class="pl-c1">500</span>;

    <span class="pl-c">// Collateral factor in basis points (e.g., 7500 = 75%)</span>
    <span class="pl-c">// Determines how much you can borrow against your collateral</span>
    <span class="pl-c1">uint256</span> <span class="pl-k">public </span>collateralFactorBasisPoints <span class="pl-k">=</span> <span class="pl-c1">7500</span>;

    <span class="pl-c">// Timestamp of last interest accrual</span>
    <span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> lastInterestAccrualTimestamp;

    <span class="pl-c">// Events</span>
    <span class="pl-k">event <span class="pl-en">Deposit</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
    <span class="pl-k">event <span class="pl-en">Withdraw</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
    <span class="pl-k">event <span class="pl-en">Borrow</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
    <span class="pl-k">event <span class="pl-en">Repay</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
    <span class="pl-k">event <span class="pl-en">CollateralDeposited</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
    <span class="pl-k">event <span class="pl-en">CollateralWithdrawn</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);

    <span class="pl-k">function<span class="pl-en"> deposit</span></span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
        <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must deposit a positive amount</span>"</span>);
        depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">+=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;
        <span class="pl-k">emit</span> <span class="pl-en">Deposit</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>);
    }

    <span class="pl-k">function<span class="pl-en"> withdraw</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">amount</span>) <span class="pl-k">external</span> {
        <span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must withdraw a positive amount</span>"</span>);
        <span class="pl-k">require</span>(depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Insufficient balance</span>"</span>);
        depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-=</span> amount;
        <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);
        <span class="pl-k">emit</span> <span class="pl-en">Withdraw</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
    }

    <span class="pl-k">function<span class="pl-en"> depositCollateral</span></span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
        <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must deposit a positive amount as collateral</span>"</span>);
        collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">+=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;
        <span class="pl-k">emit</span> <span class="pl-en">CollateralDeposited</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>);
    }

    <span class="pl-k">function<span class="pl-en"> withdrawCollateral</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">amount</span>) <span class="pl-k">external</span> {
        <span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must withdraw a positive amount</span>"</span>);
        <span class="pl-k">require</span>(collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Insufficient collateral</span>"</span>);

        <span class="pl-c1">uint256</span> borrowedAmount <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);
        <span class="pl-c1">uint256</span> requiredCollateral <span class="pl-k">=</span> (borrowedAmount <span class="pl-k">*</span> <span class="pl-c1">10000</span>) <span class="pl-k">/</span> collateralFactorBasisPoints;

        <span class="pl-k">require</span>(
            collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-</span> amount <span class="pl-k">&gt;=</span> requiredCollateral,
            <span class="pl-s">"<span class="pl-s">Withdrawal would break collateral ratio</span>"</span>
        );

        collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-=</span> amount;
        <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);
        <span class="pl-k">emit</span> <span class="pl-en">CollateralWithdrawn</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
    }

    <span class="pl-k">function<span class="pl-en"> borrow</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">amount</span>) <span class="pl-k">external</span> {
        <span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must borrow a positive amount</span>"</span>);
        <span class="pl-k">require</span>(<span class="pl-c1">address</span>(<span class="pl-mi">this</span>).balance <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Not enough liquidity in the pool</span>"</span>);

        <span class="pl-c1">uint256</span> maxBorrowAmount <span class="pl-k">=</span> (collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">*</span> collateralFactorBasisPoints) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
        <span class="pl-c1">uint256</span> currentDebt <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);

        <span class="pl-k">require</span>(currentDebt <span class="pl-k">+</span> amount <span class="pl-k">&lt;=</span> maxBorrowAmount, <span class="pl-s">"<span class="pl-s">Exceeds allowed borrow amount</span>"</span>);

        borrowBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> currentDebt <span class="pl-k">+</span> amount;
        lastInterestAccrualTimestamp[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span>;

        <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);
        <span class="pl-k">emit</span> <span class="pl-en">Borrow</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
    }

    <span class="pl-k">function<span class="pl-en"> repay</span></span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
        <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must repay a positive amount</span>"</span>);

        <span class="pl-c1">uint256</span> currentDebt <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);
        <span class="pl-k">require</span>(currentDebt <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">No debt to repay</span>"</span>);

        <span class="pl-c1">uint256</span> amountToRepay <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;
        <span class="pl-k">if</span> (amountToRepay <span class="pl-k">&gt;</span> currentDebt) {
            amountToRepay <span class="pl-k">=</span> currentDebt;
            <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">-</span> currentDebt);
        }

        borrowBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> currentDebt <span class="pl-k">-</span> amountToRepay;
        lastInterestAccrualTimestamp[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span>;

        <span class="pl-k">emit</span> <span class="pl-en">Repay</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amountToRepay);
    }

    <span class="pl-k">function<span class="pl-en"> calculateInterestAccrued</span></span>(<span class="pl-c1">address</span> <span class="pl-v">user</span>) <span class="pl-k">public</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (<span class="pl-c1">uint256</span>) {
        <span class="pl-k">if</span> (borrowBalances[user] <span class="pl-k">==</span> <span class="pl-c1">0</span>) {
            <span class="pl-k">return</span> <span class="pl-c1">0</span>;
        }

        <span class="pl-c1">uint256</span> timeElapsed <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span> <span class="pl-k">-</span> lastInterestAccrualTimestamp[user];
        <span class="pl-c1">uint256</span> interest <span class="pl-k">=</span> (borrowBalances[user] <span class="pl-k">*</span> interestRateBasisPoints <span class="pl-k">*</span> timeElapsed) <span class="pl-k">/</span> (<span class="pl-c1">10000</span> <span class="pl-k">*</span> <span class="pl-c1">365</span> days);

        <span class="pl-k">return</span> borrowBalances[user] <span class="pl-k">+</span> interest;
    }

    <span class="pl-k">function<span class="pl-en"> getMaxBorrowAmount</span></span>(<span class="pl-c1">address</span> <span class="pl-v">user</span>) <span class="pl-k">external</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (<span class="pl-c1">uint256</span>) {
        <span class="pl-k">return</span> (collateralBalances[user] <span class="pl-k">*</span> collateralFactorBasisPoints) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
    }

    <span class="pl-k">function<span class="pl-en"> getTotalLiquidity</span></span>() <span class="pl-k">external</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (<span class="pl-c1">uint256</span>) {
        <span class="pl-k">return</span> <span class="pl-c1">address</span>(<span class="pl-mi">this</span>).balance;
    }
}
</pre></div>
<h3 dir="auto"></h3>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">1.äº§å“éœ€æ±‚ä¹¦</h1></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">a.ç”¨æˆ·æµç¨‹</h3></div>

<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">b.æ•°æ®åº“</h3></div>
<markdown-accessiblity-table data-catalyst=""><table>
<thead>
<tr>
<th>Contract</th>
<th>Type</th>
<th>Bases</th>
</tr>
</thead>
<tbody>
<tr>
<td>SimpleLending</td>
<td>Implementation</td>
<td></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<markdown-accessiblity-table data-catalyst=""><table>
<thead>
<tr>
<th>â”” Function Name</th>
<th>Visibility</th>
<th>Mutability</th>
</tr>
</thead>
<tbody>
<tr>
<td>deposit</td>
<td>external</td>
<td>payable</td>
</tr>
<tr>
<td>withdraw</td>
<td>external</td>
<td>ğŸ›‘</td>
</tr>
<tr>
<td>depositCollateral</td>
<td>external</td>
<td>payable</td>
</tr>
<tr>
<td>withdrawCollateral</td>
<td>external</td>
<td>ğŸ›‘</td>
</tr>
<tr>
<td>borrow</td>
<td>external</td>
<td>ğŸ›‘</td>
</tr>
<tr>
<td>repay</td>
<td>external</td>
<td>payable</td>
</tr>
<tr>
<td>calculateInterestAccrued</td>
<td>public</td>
<td>view</td>
</tr>
<tr>
<td>getMaxBorrowAmount</td>
<td>external</td>
<td>view</td>
</tr>
<tr>
<td>getTotalLiquidity</td>
<td>external</td>
<td>view</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">2.ç»†èŠ‚è§£è¯´</h1></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§¾ åˆåŒå£°æ˜</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">contract</span> <span class="pl-en">SimpleLending</span> {
</pre></div>
<p dir="auto">æˆ‘ä»¬å‘½åæˆ‘ä»¬çš„åˆçº¦ SimpleLendingï¼Œå› ä¸ºï¼Œå—¯â€¦â€¦å®ƒæ˜¯ä¸€ä¸ªç®€å•çš„å€Ÿè´·ç³»ç»Ÿã€‚è¿™æ˜¯æˆ‘ä»¬ DeFi é“¶è¡Œçš„åŸºç¡€ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§  åˆçº¦çš„å¤§è„‘â€”â€”æ˜ å°„</strong></h3></div>
<p dir="auto">åœ¨ä»»ä½•é“¶è¡Œç³»ç»Ÿâ€”â€”æ— è®ºæ˜¯ä½ æ‰€åœ¨åœ°çš„åˆ†è¡Œè¿˜æ˜¯ DeFi æ™ºèƒ½åˆçº¦â€”â€”éƒ½éœ€è¦ä¸€ç§æ–¹æ³•æ¥è®°ä½è°æ‹¥æœ‰ä»€ä¹ˆã€‚</p>
<p dir="auto">è¿™æ­£æ˜¯æˆ‘ä»¬åœ¨åšçš„å·¥ä½œã€‚</p>
<p dir="auto">è¿™ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬å€Ÿè´·æ± çš„å¤§è„‘ã€‚è¿™äº›æ˜ å°„æ˜¯æˆ‘ä»¬è¿½è¸ªå­˜æ¬¾ã€å€ºåŠ¡ã€æŠµæŠ¼å“å’Œåˆ©æ¯çš„æ–¹å¼â€”â€”å°±åƒä¸€ä¸ªæ•°å­—è´¦æœ¬ï¼Œåœ¨é“¾ä¸Šä¿æŒä¸€åˆ‡äº•ç„¶æœ‰åºã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåˆçº¦ä¸­çš„å››ä¸ªå…³é”®æ˜ å°„ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> depositBalances;
<span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> borrowBalances;
<span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> collateralBalances;
<span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">uint256</span>) <span class="pl-k">public</span> lastInterestAccrualTimestamp;
</pre></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>depositBalances â€“æ‚¨çš„æ•°å­—ä¿é™©åº“</strong></h3></div>
<p dir="auto">è¿™ä¸ªæ˜ å°„è®°å½•ç”¨æˆ·å­˜å…¥å€Ÿè´·æ± çš„ ETH æ•°é‡ã€‚</p>
<p dir="auto">æŠŠå®ƒçœ‹ä½œåˆçº¦å†…éƒ¨çš„ä¸€ä¸ªä¸ªäººä¿é™©åº“ã€‚å½“ç”¨æˆ·è°ƒç”¨ deposit()å‡½æ•°æ—¶ï¼Œä»–ä»¬çš„ ETH ä¼šè¢«å­˜å‚¨åœ¨åˆçº¦ä¸­ï¼Œè¿™ä¸ªæ˜ å°„ä¼šæ›´æ–°ä»¥åæ˜ ä»–ä»¬æ·»åŠ äº†å¤šå°‘ã€‚</p>
<blockquote>
<p dir="auto">ğŸ“¦ å®ƒå°±åƒä½ çš„æ´»æœŸè´¦æˆ·ä½™é¢ä¸€æ ·â€”â€”é™¤éä¸è´·æ¬¾æŒ‚é’©ï¼Œå¦åˆ™å§‹ç»ˆå¯ä»¥è®¿é—®ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>borrowBalances â€“ ä½ çš„è´·æ¬¾è´¦ç°¿</strong></h3></div>
<p dir="auto">è¿™ä¸ªæ˜ å°„æ˜¾ç¤ºäº†ç”¨æˆ·ä»æ± ä¸­å€Ÿäº†å¤šå°‘ ETHã€‚</p>
<p dir="auto">å½“ä½ ä½¿ç”¨ borrow()å‡½æ•°å€Ÿæ¬¾æ—¶ï¼ŒETH ä¼šç¦»å¼€åˆçº¦å¹¶è¿›å…¥ä½ çš„é’±åŒ…ã€‚åŒæ—¶ï¼Œè¿™ä¸ªæ˜ å°„ä¼šæ›´æ–°ä»¥ç²¾ç¡®è·Ÿè¸ªä½ æ¬ å¤šå°‘å€ºåŠ¡ã€‚</p>
<p dir="auto">æˆ‘ä»¬ä¹Ÿä½¿ç”¨è¿™ä¸ªå€¼ï¼ˆä»¥åŠåˆ©æ¯ï¼‰æ¥ç¡®å®šä½ æ˜¯å¦å¯ä»¥æå–ä½ çš„æŠµæŠ¼å“æˆ–å€Ÿæ›´å¤šã€‚</p>
<blockquote>
<p dir="auto">ğŸ§¾ è¿™æ˜¯ä½ çš„è´·æ¬¾è¿½è¸ªå™¨â€”â€”é‚£ä¸ªæ˜¾ç¤ºâ€œè¿™æ˜¯ä½ æ¬ æ¬¾â€çš„æ•°å­—ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>collateralBalances â€“ å®‰å…¨ç½‘</strong></h3></div>
<p dir="auto">åœ¨å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰ä¸­ï¼Œå€Ÿè´·ä¸æ˜¯åŸºäºä¿¡ä»»ï¼Œè€Œæ˜¯åŸºäºæ•°å­¦ã€‚</p>
<p dir="auto">è¦å€Ÿæ¬¾ï¼Œä½ éœ€è¦æŠµæŠ¼èµ„äº§ã€‚è¿™ä¸ªæ˜ å°„è®°å½•äº†æ¯ä¸ªç”¨æˆ·æä¾›çš„ä½œä¸ºæŠµæŠ¼çš„ ETH æ•°é‡ã€‚</p>
<p dir="auto">å½“ä½ è°ƒç”¨ depositCollateral()æ—¶ï¼ŒETH ä¼šç•™åœ¨åˆçº¦ä¸­ï¼Œä½†ä½ çš„ collateralBalances æ¡ç›®ä¼šå¢åŠ ã€‚</p>
<p dir="auto">å½“ä½ å°è¯•å€Ÿæ¬¾æˆ–æå–æŠµæŠ¼èµ„äº§æ—¶ï¼Œåˆçº¦ä¼šä½¿ç”¨è¿™ä¸ªæ˜ å°„æ¥æ£€æŸ¥ä½ çš„å¤´å¯¸æ˜¯å¦ä»ç„¶å®‰å…¨ã€‚</p>
<blockquote>
<p dir="auto">ğŸ” æƒ³è±¡ä¸€ä¸‹è¿™å°±åƒä½ çš„æŠ¼é‡‘â€”â€”å®ƒå­˜åœ¨æ˜¯ä¸ºäº†åœ¨ä½ ä¸å±¥è¡Œä¹‰åŠ¡æ—¶ä¿æŠ¤ç³»ç»Ÿã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>lastInterestAccrualTimestamp â€“ è®¡æ—¶å‘˜</strong></h3></div>
<p dir="auto">æˆ‘ä»¬çš„ç³»ç»Ÿä¸­çš„åˆ©æ¯ä¸ä¼šæ¯ç§’è‡ªåŠ¨ç´¯ç§¯â€”â€”é‚£ä¼šéå¸¸è€—è´¹ gasã€‚</p>
<p dir="auto">ç›¸åï¼Œæˆ‘ä»¬è®°å½•æ¯ä¸ªç”¨æˆ·ä¸Šæ¬¡è®¡ç®—åˆ©æ¯çš„æ—¶é—´ã€‚ç„¶åï¼Œæ¯å½“ç”¨æˆ·ä¸ç³»ç»Ÿäº¤äº’ï¼ˆå€Ÿæ¬¾ã€è¿˜æ¬¾ç­‰ï¼‰æ—¶ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥ç»è¿‡çš„æ—¶é—´ï¼Œå¹¶è®¡ç®—ä»é‚£æ—¶èµ·ç´¯ç§¯äº†å¤šå°‘åˆ©æ¯ã€‚</p>
<p dir="auto">è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸æ¯å—é“¾æ”¯ä»˜åˆ©æ¯çš„æƒ…å†µä¸‹æ¨¡æ‹Ÿè¿ç»­çš„åˆ©æ¯ã€‚</p>
<blockquote>
<p dir="auto">ğŸ§® è¿™å°±åƒä¸€ä¸ªæ—¶é—´æˆ³æ”¶æ®ï¼šâ€œä¸Šæ¬¡æˆ‘ä»¬æ£€æŸ¥æ—¶ï¼Œè¿™ä½ç”¨æˆ·æ¬ æ¬¾ Xã€‚ç°åœ¨è®©æˆ‘ä»¬æ ¹æ®ç»è¿‡çš„æ—¶é—´æ¥æ›´æ–°ã€‚â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ’° å€Ÿè´·é€»è¾‘â€”â€”è®¾å®šé‡‘èè§„åˆ™</strong></h3></div>
<p dir="auto">æ¯ä¸ªå€Ÿè´·å¹³å°â€”â€”æ— è®ºæ˜¯ DeFi åè®®è¿˜æ˜¯å½“åœ°é“¶è¡Œâ€”â€”éƒ½éµå¾ªå‡ æ¡å…³é”®çš„é‡‘èè§„åˆ™ã€‚</p>
<p dir="auto">åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­ï¼Œè¿™äº›è§„åˆ™è¢«åµŒå…¥åˆ°ä¸¤ä¸ªç®€å•çš„å˜é‡ä¸­ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> <span class="pl-k">public </span>interestRateBasisPoints <span class="pl-k">=</span> <span class="pl-c1">500</span>;         <span class="pl-c">// 5% annual interest rate</span>
<span class="pl-c1">uint256</span> <span class="pl-k">public </span>collateralFactorBasisPoints <span class="pl-k">=</span> <span class="pl-c1">7500</span>;    <span class="pl-c">// 75% loan-to-value (LTV)</span>
</pre></div>
<p dir="auto">è®©æˆ‘ä»¬é€ä¸€è§£æè¿™äº›å˜é‡çš„å«ä¹‰åŠå…¶é‡è¦æ€§ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§¾ interestRateBasisPoints â€“ åè®®å¦‚ä½•èµšå–æ”¶ç›Š</strong></h3></div>
<p dir="auto">è¿™æ˜¯å€Ÿæ¬¾äººæ¯å¹´éœ€æ”¯ä»˜çš„è´·æ¬¾åˆ©ç‡ã€‚</p>
<p dir="auto">ä½†æˆ‘ä»¬ç”¨ 500 è¡¨ç¤º 5%ï¼Œè€Œä¸æ˜¯å†™ 5ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åŸºç‚¹ã€‚</p>
<blockquote>
<p dir="auto">ğŸ”¢ åŸºç‚¹åœ¨é‡‘èä¸­ç”¨äºç²¾ç¡®è¡¨è¾¾ç™¾åˆ†æ¯”ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†åˆ†æ•°åˆ©ç‡æ—¶ã€‚1 ä¸ªåŸºç‚¹æ˜¯ 0.01%ï¼Œæ‰€ä»¥ 500 ä¸ªåŸºç‚¹æ˜¯ 5%</p>
</blockquote>
<p dir="auto">è¿™æ„å‘³ç€ï¼š</p>
<p dir="auto">å¦‚æœä¸€ä¸ªç”¨æˆ·å€Ÿå…¥ 1 ETHï¼Œä¸€å¹´åï¼ˆå‡è®¾ä»–ä»¬æ²¡æœ‰æå‰è¿˜æ¬¾ï¼‰å°†éœ€è¦å¿è¿˜ 1.05 ETHã€‚</p>
<p dir="auto">é€šè¿‡ä½¿ç”¨åŸºç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…æµ®ç‚¹æ•°è¿ç®—ï¼ˆSolidity ä¸æ”¯æŒæµ®ç‚¹æ•°è¿ç®—ï¼‰ï¼Œå¹¶ä¿æŒæé«˜çš„ç²¾ç¡®åº¦ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ›¡ï¸ collateralFactorBasisPoints â€“ åè®®å¦‚ä½•ä¿æŒå®‰å…¨</strong></h3></div>
<p dir="auto">è¯¥å˜é‡å†³å®šäº†æ ¹æ®æŠµæŠ¼å“ä»·å€¼å¯ä»¥å€Ÿå¤šå°‘ã€‚</p>
<p dir="auto">åœ¨æˆ‘ä»¬è¿™é‡Œï¼š</p>
<p dir="auto">7500 ä¸ªåŸºç‚¹ = 75%</p>
<p dir="auto">è¿™æ„å‘³ç€ç”¨æˆ·åªèƒ½å€Ÿå…¥ä»–ä»¬ä½œä¸ºæŠµæŠ¼é”å®š ETH çš„ 75%</p>
<p dir="auto">å‡è®¾ä½ å°† 2 ETH ä½œä¸ºæŠµæŠ¼ï¼š</p>
<p dir="auto">2 ETH çš„ 75% = 1.5 ETH</p>
<p dir="auto">è¿™å°±æ˜¯ä½ è¢«å…è®¸å€Ÿå…¥çš„æœ€å¤§é‡‘é¢</p>
<p dir="auto">ä¸ºä»€ä¹ˆä¸æ˜¯ 100%ï¼Ÿ</p>
<p dir="auto">å› ä¸ºå­˜åœ¨ä»·æ ¼æ³¢åŠ¨ã€‚ETH æ˜å¤©å¯èƒ½ä¼šè´¬å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬æ€»æ˜¯å¸Œæœ›å€Ÿæ¬¾äººç•™ä¸‹ä¸€å±‚å®‰å…¨å«â€”â€”è¿™å°±æ˜¯æŠµæŠ¼ç‡å¼ºåˆ¶æ‰§è¡Œçš„æœºåˆ¶ã€‚</p>
<blockquote>
<p dir="auto">ğŸ§  ç°å®ä¸­çš„æ¯”å–»ï¼šè¿™å°±åƒé“¶è¡Œè¯´â€œæˆ‘ä»¬å¯ä»¥ç”¨ä½ çš„è½¦ä½œä¸ºæŠµæŠ¼è´·æ¬¾â€”â€”ä½†åªèƒ½æŒ‰å…¶å½“å‰ä»·å€¼çš„ 75%æ¥è´·ã€‚â€</p>
</blockquote>
<p dir="auto">è¿™æœ‰åŠ©äºåè®®é¿å…äºæŸï¼Œå¹¶ç¡®ä¿å€Ÿæ¬¾äººå§‹ç»ˆæœ‰è¶³å¤Ÿçš„æŠµæŠ¼ç‰©æ¥æ”¯æŒä»–ä»¬çš„è´·æ¬¾ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ“£ äº‹ä»¶ â€“ æ´»åŠ¨å¹¿æ’­</strong></h3></div>
<p dir="auto">ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨ DeFi é“¶è¡Œä¸­ä½¿ç”¨çš„äº‹ä»¶ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">event <span class="pl-en">Deposit</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
<span class="pl-k">event <span class="pl-en">Withdraw</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
<span class="pl-k">event <span class="pl-en">Borrow</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
<span class="pl-k">event <span class="pl-en">Repay</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
<span class="pl-k">event <span class="pl-en">CollateralDeposited</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
<span class="pl-k">event <span class="pl-en">CollateralWithdrawn</span></span>(<span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">user</span>, <span class="pl-c1">uint256</span> <span class="pl-v">amount</span>);
</pre></div>
<p dir="auto">è®©æˆ‘ä»¬æ¥åˆ†è§£å®ƒä»¬ï¼š</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ’¸ Deposit</strong></h3></div>
<p dir="auto">å½“ç”¨æˆ·å‘å€Ÿè´·æ± æ·»åŠ  ETH æ—¶å‘å‡ºã€‚</p>
<blockquote>
<p dir="auto">è¿™å°±åƒåœ¨è¯´ï¼šâ€œç”¨æˆ· X åˆšåˆšå­˜å…¥äº† Y ETHâ€”â€”æ›´æ–°ä»–ä»¬çš„ä½™é¢å¹¶åœ¨ä»ªè¡¨æ¿ä¸Šæ˜¾ç¤ºï¼â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§ Withdraw</strong></h3></div>
<p dir="auto">å½“ç”¨æˆ·ä»ä»–ä»¬çš„å­˜æ¬¾ä½™é¢ä¸­å–å‡º ETH æ—¶è§¦å‘ã€‚</p>
<blockquote>
<p dir="auto">ç”¨äºåœ¨ UI ä¸­åæ˜ ææ¬¾æƒ…å†µï¼Œå¹¶è®°å½•åˆçº¦çš„ ETH ä½™é¢å·²å˜æ›´ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§¾ Borrow</strong></h3></div>
<p dir="auto">å½“ç”¨æˆ·æˆåŠŸå€Ÿæ¬¾æ—¶è§¦å‘ã€‚</p>
<blockquote>
<p dir="auto">æ‚¨çš„åº”ç”¨å¯ä»¥æ˜¾ç¤ºï¼šâ€œæ­å–œï¼æ‚¨åˆšåˆšä»æ± ä¸­å€Ÿäº† 0.75 ETHã€‚â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ’³ Repay</strong></h3></div>
<p dir="auto">å½“ç”¨æˆ·å‘é€ ETH ä»¥å¿è¿˜è´·æ¬¾æ—¶è§¦å‘ã€‚</p>
<blockquote>
<p dir="auto">å¯¹æ›´æ–°ç”¨æˆ·çš„è´·æ¬¾ä½™é¢å’Œè®¡ç®—å‰©ä½™å€ºåŠ¡éå¸¸é‡è¦ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ›¡ï¸ CollateralDeposited</strong></h3></div>
<p dir="auto">å½“ç”¨æˆ·å°† ETH é”å®šä½œä¸ºæŠµæŠ¼å“æ—¶å‘å‡ºã€‚</p>
<blockquote>
<p dir="auto">å‰ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ˜¾ç¤ºï¼šâ€œæ‚¨ç°åœ¨æœ‰èµ„æ ¼å€Ÿå…¥æœ€å¤š X ETHã€‚â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ”“ CollateralWithdrawn</strong></h3></div>
<p dir="auto">å½“ç”¨æˆ·å®‰å…¨æå–å…¶æŠµæŠ¼å“æ—¶å‘ç”Ÿï¼ˆåœ¨è¿˜æ¬¾åæˆ–ä¿æŒå¥åº·çš„è´·æ¬¾ä»·å€¼æ¯”ä¹‹åï¼‰ã€‚</p>
<blockquote>
<p dir="auto">è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„è§¦å‘å™¨ï¼Œç”¨äºå¯è§†åŒ–å‰©ä½™çš„æŠµæŠ¼å“æ•°é‡ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ”§ Functions â€”â€”é©±åŠ¨ DeFi å¼•æ“</strong></h3></div>
<p dir="auto">æˆ‘ä»¬è‡³ä»Šæ‰€æ„å»ºçš„ä¸€åˆ‡â€”â€”å˜é‡ã€æ˜ å°„ã€å‚æ•°ã€äº‹ä»¶â€”â€”å®ƒä»¬éƒ½åªæ˜¯åŸºç¡€ã€‚</p>
<p dir="auto">çœŸæ­£çš„é­”æ³•å‘ç”Ÿåœ¨ç”¨æˆ·ä¸åˆçº¦äº¤äº’æ—¶ã€‚</p>
<p dir="auto">è¿™äº›åŠŸèƒ½æ˜¯ç”¨æˆ·åœ¨æ‚¨çš„ DeFi é“¶è¡Œä¸­æ‰§è¡Œæ“ä½œçš„æ–¹å¼ï¼šå­˜æ¬¾ ETHã€å€Ÿæ¬¾ã€å¿è¿˜è´·æ¬¾å’Œç®¡ç†æŠµæŠ¼å“ã€‚è¿™å°±æ˜¯åˆçº¦å˜å¾—äº’åŠ¨çš„åœ°æ–¹ã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬ä»è¯¥æµç¨‹ä¸­çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½â€”â€”å­˜æ¬¾å¼€å§‹ã€‚</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ¦ deposit() â€“ å‘æ± ä¸­æ·»åŠ  ETH</strong></h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> deposit</span></span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
    <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must deposit a positive amount</span>"</span>);

    depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">+=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;

    <span class="pl-k">emit</span> <span class="pl-en">Deposit</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>);
}
</pre></div>
<p dir="auto">è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æˆ·å‘å€Ÿè´·æ± ä¸­æ·»åŠ  ETH çš„æ–¹å¼â€”â€”ç®€å•è‡³æã€‚</p>
<p dir="auto">è¿™æ˜¯é€æ­¥æ“ä½œæ–¹æ³•ï¼š</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>1. msg.valueâ€“ æ¥æ”¶ ETH</strong></h3></div>
<p dir="auto">æ¯å½“æœ‰äººå‘æ™ºèƒ½åˆçº¦å‘é€ ETH æ—¶ï¼Œé‡‘é¢ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªç§°ä¸º msg.value çš„ç‰¹æ®Šå˜é‡ä¸­ã€‚</p>
<p dir="auto">æ‰€ä»¥å¦‚æœæˆ‘è°ƒç”¨ deposit()å¹¶é™„åŠ  1 ETHï¼Œmsg.value å°†æ˜¯ 1 ä»¥å¤ªå¸ã€‚</p>
<p dir="auto">æˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must deposit a positive amount</span>"</span>);
</pre></div>
<p dir="auto">è¿™ä¸€è¡Œé˜²æ­¢äººä»¬åœ¨ä¸å‘é€ä»»ä½• ETH çš„æƒ…å†µä¸‹æ„å¤–è°ƒç”¨è¯¥å‡½æ•°ã€‚æ²¡æœ‰å…è´¹æ­ä¾¿è½¦ï¼</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>2. æ›´æ–°ä½™é¢</strong></h3></div>
<p dir="auto">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°è·Ÿè¸ªæ¯ä¸ªç”¨æˆ·å­˜æ¬¾çš„æ˜ å°„ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">+=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;
</pre></div>
<p dir="auto">è¿™é‡Œï¼Œmsg.sender æ˜¯è°ƒç”¨å‡½æ•°çš„äººâ€”â€”å³å­˜æ¬¾äººã€‚</p>
<p dir="auto">æˆ‘ä»¬çš„æ„æ€æ˜¯ï¼šâ€œå°†ä»–ä»¬ä¹‹å‰æ‹¥æœ‰çš„é‡‘é¢ï¼ŒåŠ ä¸Šæ–°çš„é‡‘é¢ã€‚â€</p>
<blockquote>
<p dir="auto">ğŸ§  ç®€å•æ¥è¯´ï¼šâ€œæ›´æ–°è¿™ä¸ªç”¨æˆ·çš„é“¶è¡Œä½™é¢ã€‚â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>3. å‘é€äº‹ä»¶</strong></h3></div>
<p dir="auto">æœ€åï¼Œæˆ‘ä»¬è®©ä¸–ç•ŒçŸ¥é“åˆšåˆšå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">Deposit</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>);
</pre></div>
<p dir="auto">è¿™ä¼šè§¦å‘å­˜æ¬¾äº‹ä»¶ï¼Œå‰ç«¯åº”ç”¨æˆ–ç´¢å¼•å™¨å¯ä»¥ç›‘å¬è¯¥äº‹ä»¶ã€‚è¿™å°±åƒåˆçº¦åœ¨å–Šï¼š</p>
<blockquote>
<p dir="auto">â€œå˜¿ï¼Alice åˆšåˆšå­˜å…¥äº† 1 ETHï¼â€</p>
</blockquote>
<p dir="auto">è¿™å°±æ˜¯å¦‚ä½•ç¡®ä¿ UI æ›´æ–°å¹¶åœ¨ Etherscan ç­‰å·¥å…·ä¸­è®°å½•äº¤æ˜“çš„æ–¹å¼ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ’¸ withdraw(uint256 amount) â€“ å–å›ä½ çš„èµ„é‡‘</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> withdraw</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">amount</span>) <span class="pl-k">external</span> {
    <span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must withdraw a positive amount</span>"</span>);
    <span class="pl-k">require</span>(depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Insufficient balance</span>"</span>);

    depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-=</span> amount;
    <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);

    <span class="pl-k">emit</span> <span class="pl-en">Withdraw</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
}
</pre></div>
<p dir="auto">æ—¢ç„¶ç”¨æˆ·å¯ä»¥å­˜å…¥ ETHï¼Œæˆ‘ä»¬éœ€è¦ç»™ä»–ä»¬ä¸€ä¸ªæ–¹å¼æ¥å–å›ä»–ä»¬çš„ ETHâ€”â€”æ— è®ºä½•æ—¶ä»–ä»¬éœ€è¦ã€‚</p>
<p dir="auto">è¿™æ­£æ˜¯ withdraw()å‡½æ•°çš„ä½œç”¨ã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬åƒä¸€ä½èµ°è¿›é“¶è¡Œå¹¶è¯´...</p>
<p dir="auto">â€œå˜¿ï¼Œæˆ‘æƒ³å–å‡ºä¸€äº›æˆ‘çš„èµ„é‡‘ã€‚â€</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>1. âœ… éªŒè¯ææ¬¾è¯·æ±‚</strong></h3></div>
<p dir="auto">é¦–å…ˆï¼Œåˆçº¦è¿›è¡Œä¸¤é¡¹å¿«é€Ÿåˆç†æ€§æ£€æŸ¥ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must withdraw a positive amount</span>"</span>);
</pre></div>
<p dir="auto">è¿™ç¡®ä¿ç”¨æˆ·ä¸ä¼šä¸å°å¿ƒå°è¯•æå– 0 ETHã€‚æ²¡æœ‰å¥‡æ€ªçš„è¾¹ç¼˜æƒ…å†µï¼Œæ²¡æœ‰å›°æƒ‘â€”â€”åªæ˜¯å¹²å‡€çš„è¾“å…¥ã€‚</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Insufficient balance</span>"</span>);
</pre></div>
<p dir="auto">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„ ETH åœ¨å…¶å­˜æ¬¾ä½™é¢ä¸­æ¥è¿›è¡Œæ­¤æ¬¡ææ¬¾ã€‚</p>
<p dir="auto">å¦‚æœä¸æ˜¯ï¼Œäº¤æ˜“å°†è¢«æ‹’ç»ã€‚</p>
<p dir="auto">DeFi ä¸å…è®¸é€æ”¯ ğŸ˜‰</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>2. ğŸ§® æ›´æ–°ä½™é¢</strong></h3></div>
<p dir="auto">å¦‚æœä¸¤ä¸ªæ£€æŸ¥éƒ½é€šè¿‡ï¼Œç”¨æˆ·çš„å­˜æ¬¾ä½™é¢å°†å¾—åˆ°æ›´æ–°ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>depositBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-=</span> amount;
</pre></div>
<p dir="auto">è¿™ä»ä»–ä»¬çš„è´¦æˆ·ä¸­æ‰£é™¤æå–çš„é‡‘é¢ã€‚</p>
<p dir="auto">å°±åƒé“¶è¡Œè´¦æœ¬åæ˜ å·²ç»å‘ç”Ÿäº†ææ¬¾ä¸€æ ·ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>3. ğŸª™ å‘é€ ETH</strong></h3></div>
<p dir="auto">æ›´æ–°ä½™é¢åï¼Œåˆçº¦å°† ETH å‘é€å›ç”¨æˆ·ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);
</pre></div>
<p dir="auto">è¿™ä¸€è¡Œå®é™…ä¸Šå°†çœŸå®çš„ ETH è½¬å›ç”¨æˆ·çš„é’±åŒ…ã€‚</p>
<blockquote>
<p dir="auto">ğŸ’¡ Solidity è¦æ±‚å¯¹å¯æ”¯ä»˜åœ°å€è°ƒç”¨ .transfer() â€”â€” è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å°† msg.sender å¼ºåˆ¶è½¬æ¢ä¸º payable(msg.sender)ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>4. ğŸ“£ å‘å¸ƒäº‹ä»¶</strong></h3></div>
<p dir="auto">æœ€åï¼Œæˆ‘ä»¬è®©å¤§å®¶çŸ¥é“åˆšæ‰å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">Withdraw</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
</pre></div>
<p dir="auto">è¿™ä¼šè§¦å‘ææ¬¾äº‹ä»¶â€”â€”ä¸€ä¸ªä½ çš„å‰ç«¯å¯ä»¥ç›‘å¬ä»¥æ˜¾ç¤ºç±»ä¼¼ç¡®è®¤æ¶ˆæ¯çš„ä¿¡å·ï¼š</p>
<blockquote>
<p dir="auto">â€œâœ… æˆåŠŸææ¬¾ 0.5 ETHï¼â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§® calculateInterestAccrued(address user) â€“ å€Ÿæ¬¾çš„æ ¸å¿ƒ</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> calculateInterestAccrued</span></span>(<span class="pl-c1">address</span> <span class="pl-v">user</span>) <span class="pl-k">public</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (<span class="pl-c1">uint256</span>) {
    <span class="pl-k">if</span> (borrowBalances[user] <span class="pl-k">==</span> <span class="pl-c1">0</span>) {
        <span class="pl-k">return</span> <span class="pl-c1">0</span>;
    }

    <span class="pl-c1">uint256</span> timeElapsed <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span> <span class="pl-k">-</span> lastInterestAccrualTimestamp[user];
    <span class="pl-c1">uint256</span> interest <span class="pl-k">=</span> (borrowBalances[user] <span class="pl-k">*</span> interestRateBasisPoints <span class="pl-k">*</span> timeElapsed) <span class="pl-k">/</span> (<span class="pl-c1">10000</span> <span class="pl-k">*</span> <span class="pl-c1">365</span> days);

    <span class="pl-k">return</span> borrowBalances[user] <span class="pl-k">+</span> interest;
}
</pre></div>
<p dir="auto">è¿™ä¸ªå‡½æ•°æ˜¯æˆ‘ä»¬å€Ÿè´·ç³»ç»Ÿçš„æ ¸å¿ƒå¼•æ“â€”â€”åœ¨å®‰é™åœ°é©±åŠ¨ç€å€Ÿæ¬¾æœ€é‡è¦çš„éƒ¨åˆ†ï¼šåˆ©æ¯è®¡ç®—ã€‚</p>
<p dir="auto">çŒœçŒœçœ‹ï¼Ÿ</p>
<p dir="auto">ä½ å°†åœ¨å‡ ä¹æ‰€æœ‰æ¶‰åŠè´·æ¬¾çš„ä¸»è¦åŠŸèƒ½ä¸­çœ‹åˆ°è¿™ä¸ªå‡½æ•°å‡ºç°ï¼š</p>
<ul dir="auto">
<li>âœ… å½“ä½ å€Ÿå…¥</li>
<li>ğŸ’³ å½“ä½ å¿è¿˜</li>
<li>ğŸ”“ å½“ä½ æå–æŠµæŠ¼å“</li>
<li>ğŸ“Š å³ä½¿åœ¨æŸ¥è¯¢ä½ æ¬ å¤šå°‘æ—¶</li>
</ul>
<p dir="auto">è®©æˆ‘ä»¬äº†è§£å®ƒå…·ä½“åœ¨åšä»€ä¹ˆâ€”â€”ä»¥åŠä¸ºä»€ä¹ˆè¿™å¦‚æ­¤é‡è¦ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ“Š æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªï¼Ÿ</strong></h3></div>
<p dir="auto">åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œè´·æ¬¾åˆ©æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œç´¯ç§¯ã€‚</p>
<p dir="auto">ä½†æ™ºèƒ½åˆçº¦æ— æ³•æ¯ç§’æ›´æ–°å˜é‡â€”â€”é‚£åœ¨ gas è´¹ç”¨ä¸Šä¼šéå¸¸æ˜‚è´µã€‚</p>
<p dir="auto">æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸æ˜¯æŒç»­æ›´æ–°æ¯ä¸ªç”¨æˆ·çš„è´·æ¬¾ä½™é¢...</p>
<p dir="auto">æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‰éœ€è®¡ç®—åˆ©æ¯â€”â€”åªåœ¨éœ€è¦æ—¶è®¡ç®—ã€‚</p>
<p dir="auto">å°†å…¶è§†ä¸ºä¸€ä¸ªå³æ—¶åˆ©æ¯è®¡ç®—å™¨ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>âœ… å·¥ä½œåŸç†</strong></h3></div>
<p dir="auto"><strong>1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å€Ÿè¿‡ä»»ä½•æ¬¾é¡¹</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">if</span> (borrowBalances[user] <span class="pl-k">==</span> <span class="pl-c1">0</span>) {
    <span class="pl-k">return</span> <span class="pl-c1">0</span>;
}
</pre></div>
<p dir="auto">æ²¡æœ‰è´·æ¬¾ï¼Ÿæ²¡æœ‰åˆ©æ¯ã€‚ç®€å•ã€‚</p>
<p dir="auto"><strong>2. è®¡ç®—å·²è¿‡å»å¤šå°‘æ—¶é—´</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> timeElapsed <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span> <span class="pl-k">-</span> lastInterestAccrualTimestamp[user];
</pre></div>
<p dir="auto">æˆ‘ä»¬è®¡ç®—å‡ºè‡ªä¸Šæ¬¡ä¸ºè¯¥ç”¨æˆ·è®¡ç®—åˆ©æ¯ä»¥æ¥å·²è¿‡å»å¤šå°‘æ—¶é—´ã€‚</p>
<blockquote>
<p dir="auto">block.timestamp ç»™æˆ‘ä»¬å½“å‰çš„æ—¶é—´ã€‚</p>
</blockquote>
<blockquote>
<p dir="auto">lastInterestAccrualTimestamp å‘Šè¯‰æˆ‘ä»¬ä¸Šæ¬¡æ›´æ–°ä»–ä»¬å€ºåŠ¡çš„æ—¶é—´ã€‚</p>
</blockquote>
<p dir="auto"><strong>3. åº”ç”¨åˆ©æ¯å…¬å¼</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> interest <span class="pl-k">=</span> (borrowBalances[user] <span class="pl-k">*</span> interestRateBasisPoints <span class="pl-k">*</span> timeElapsed) <span class="pl-k">/</span> (<span class="pl-c1">10000</span> <span class="pl-k">*</span> <span class="pl-c1">365</span> days);
</pre></div>
<p dir="auto">è®©æˆ‘ä»¬æ¥åˆ†è§£è¿™ä¸ªå…¬å¼ï¼š</p>
<p dir="auto"><strong>borrowBalances[user]</strong>&nbsp;â†’ ç”¨æˆ·çš„å½“å‰è´·æ¬¾æœ¬é‡‘</p>
<p dir="auto"><strong>interestRateBasisPoints</strong>&nbsp;â†’ æˆ‘ä»¬çš„å¹´åˆ©ç‡ï¼ˆä¾‹å¦‚ï¼Œ500 ç­‰äº 5%ï¼‰</p>
<p dir="auto"><strong>timeElapsed</strong>&nbsp;â†’ ä»–ä»¬æ¬ å€ºçš„æ—¶é—´é•¿åº¦</p>
<p dir="auto"><strong>10000 * 365 days</strong>&nbsp;â†’ ç”¨äºå°†åŸºå‡†ç‚¹è½¬æ¢ä¸ºå¹´åº¦åˆ†æ•°</p>
<p dir="auto">è¿™æ ¹æ®è´·æ¬¾çš„æ´»è·ƒæ—¶é—´ï¼Œç»™å‡ºäº†æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢äº§ç”Ÿçš„åˆ©æ¯ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>4. è¿”å›æ€»å€ºåŠ¡ï¼ˆæœ¬é‡‘+åˆ©æ¯ï¼‰</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">return</span> borrowBalances[user] <span class="pl-k">+</span> interest;
</pre></div>
<p dir="auto">å¥½äº†ã€‚å°±è¿™æ ·ï¼Œä½ å°±èƒ½è·å¾—æœ€æ–°çš„å€ºåŠ¡ä¿¡æ¯â€”â€”æ— éœ€æ‰‹åŠ¨è®¡ç®—ã€‚</p>
<blockquote>
<p dir="auto">è¿™ä¸ªæ€»é¢å°†ç”¨äºæˆ‘ä»¬æ‰€æœ‰å…¶ä»–åŠŸèƒ½ï¼šéªŒè¯å€Ÿæ¬¾èµ„æ ¼ã€æ£€æŸ¥è¿˜æ¬¾é‡‘é¢ä»¥åŠéªŒè¯æŠµæŠ¼å“æå–ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ›¡ï¸ depositCollateral() â€“ é”å®š ETH ä»¥ä¾¿æ—¥åå€Ÿæ¬¾</strong></h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> depositCollateral</span></span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
    <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must deposit a positive amount as collateral</span>"</span>);

    collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">+=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;

    <span class="pl-k">emit</span> <span class="pl-en">CollateralDeposited</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>);
}
</pre></div>
<p dir="auto">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»çœ‹åˆ°äº†å¦‚ä½•å°† ETH å­˜å…¥æ± ä¸­ä½œä¸ºå‡ºå€Ÿäººâ€”â€”å¦‚æœä½ æƒ³èµšå–è¢«åŠ¨æ”¶å…¥ï¼Œè¿™å¾ˆå¥½ã€‚</p>
<p dir="auto">ä½†å¦‚æœä½ æƒ³ä»æ± ä¸­å€Ÿæ¬¾å‘¢ï¼Ÿ</p>
<p dir="auto">å—¯ï¼Œå°±åƒç°å®ç”Ÿæ´»ä¸­ä¸€æ ·â€”â€”å¦‚æœä½ æƒ³è´·æ¬¾ï¼Œéœ€è¦æä¾›æŠµæŠ¼å“ã€‚</p>
<p dir="auto">è¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥å®Œæˆè¿™ä¸ªæ“ä½œçš„ã€‚</p>
<p dir="auto">æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹ ğŸ‘‡</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ”’ æŠµæŠ¼å“ä¸å­˜æ¬¾â€”â€”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h3></div>
<p dir="auto">åœ¨æ·±å…¥ä»£ç ä¹‹å‰ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«ï¼š</p>
<markdown-accessiblity-table data-catalyst=""><table>
<thead>
<tr>
<th>Deposits&nbsp;&nbsp;å­˜æ¬¾</th>
<th>æŠµæŠ¼å“</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½ å€Ÿç»™æ± å­çš„é’± ğŸ’¸</td>
<td>ä½ ç”¨æ¥å€Ÿé’±çš„é”é’± ğŸ’³</td>
</tr>
<tr>
<td>å¯ä»¥è‡ªç”±æå–ï¼ˆé™¤éç”¨äºå€Ÿè´·ï¼‰</td>
<td>ä»…å½“æ‚¨çš„è´·æ¬¾å®‰å…¨æ—¶æ‰å¯å½’è¿˜</td>
</tr>
<tr>
<td>æ‚¨å¯ä»ä¸­èµšå–åˆ©æ¯ï¼ˆå¦‚æœç³»ç»Ÿæ”¯æŒè¯¥åŠŸèƒ½ï¼‰</td>
<td>å®ƒæ”¯æŒæ‚¨çš„å€Ÿè´·å¹¶ä¿éšœåè®®å®‰å…¨</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">æ‰€ä»¥æ˜¯çš„â€”â€”å®ƒä»¬éƒ½æ˜¯ ETHï¼Œä½†å®ƒä»¬æ‰®æ¼”ç€å®Œå…¨ä¸åŒçš„è§’è‰²ã€‚</p>
<p dir="auto">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ç”¨äºæŠµæŠ¼å“å­˜æ¬¾ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>âœ… æ­¥éª¤è¯¦è§£</strong></h3></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>1. æ£€æŸ¥çœŸå®å­˜æ¬¾</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must deposit a positive amount as collateral</span>"</span>);
</pre></div>
<p dir="auto">æˆ‘ä»¬ç¡®ä¿ç”¨æˆ·æ­£åœ¨å‘é€ä¸€äº› ETHâ€”â€”ä¸å…è®¸ç©ºäº¤æ˜“ã€‚</p>
<p dir="auto"><strong>2. å¢åŠ ç”¨æˆ·çš„æŠµæŠ¼å“ä½™é¢</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">+=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;
</pre></div>
<p dir="auto">ä¸€æ—¦æ”¶åˆ° ETHï¼Œæˆ‘ä»¬æ›´æ–°ç”¨æˆ·çš„æŠµæŠ¼è®°å½•ã€‚è¿™å‘Šè¯‰åˆçº¦ï¼š</p>
<p dir="auto">â€œå¥½äº†ï¼Œè¿™ä½ç”¨æˆ·ç°åœ¨å·²ç»é”å®šäº† X ETHâ€”â€”æˆ‘ä»¬å¯ä»¥è®©ä»–ä»¬åœ¨æŸä¸ªé™é¢å†…å®‰å…¨åœ°å€Ÿæ¬¾ã€‚â€</p>
<p dir="auto">è¿™æ˜¯ç³»ç»Ÿä¸­è§£é”å€Ÿè´·èƒ½åŠ›çš„å…³é”®ã€‚</p>
<p dir="auto"><strong>3. å‘å‡ºäº‹ä»¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">CollateralDeposited</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>);
</pre></div>
<p dir="auto">ä¸€å¦‚æ—¢å¾€ï¼Œæˆ‘ä»¬å‘å‡ºäº‹ä»¶ï¼Œä»¥ä¾¿å‰ç«¯å’Œå·¥å…·èƒ½å¤Ÿå¯¹å­˜æ¬¾åšå‡ºååº”â€”â€”æ›´æ–°ä»ªè¡¨æ¿ã€å‘é€é€šçŸ¥ï¼Œå¹¶å°†æ“ä½œè®°å½•åœ¨å†å²ä¸­ã€‚</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ”“ withdrawCollateral(uint256 amount) â€“ æ‹¿å›ä½ é”å®šçš„ ETHï¼ˆå¦‚æœä½ æ˜¯å®‰å…¨çš„ï¼‰</strong></h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> withdrawCollateral</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">amount</span>) <span class="pl-k">external</span> {
    <span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must withdraw a positive amount</span>"</span>);
    <span class="pl-k">require</span>(collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Insufficient collateral</span>"</span>);

    <span class="pl-c1">uint256</span> borrowedAmount <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);
    <span class="pl-c1">uint256</span> requiredCollateral <span class="pl-k">=</span> (borrowedAmount <span class="pl-k">*</span> <span class="pl-c1">10000</span>) <span class="pl-k">/</span> collateralFactorBasisPoints;

    <span class="pl-k">require</span>(
        collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-</span> amount <span class="pl-k">&gt;=</span> requiredCollateral,
        <span class="pl-s">"<span class="pl-s">Withdrawal would break collateral ratio</span>"</span>
    );

    collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-=</span> amount;
    <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);

    <span class="pl-k">emit</span> <span class="pl-en">CollateralWithdrawn</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
}
</pre></div>
<p dir="auto">æ‰€ä»¥ä½ è´¨æŠ¼äº†ä¸€äº› ETH ä½œä¸ºæŠµæŠ¼ã€‚è¿™è®©ä½ è·å¾—äº†ä»æ± ä¸­å€Ÿå…¥èµ„é‡‘çš„æƒåˆ©ã€‚</p>
<p dir="auto">ç°åœ¨ä½ æƒ³æ‹¿å›ä¸€äº› ETHã€‚</p>
<p dir="auto">è¿™çœ‹èµ·æ¥å¾ˆå…¬å¹³ï¼Œå¯¹å§ï¼Ÿ</p>
<p dir="auto">å—¯â€¦â€¦åªæœ‰å½“ä½ ä»ç„¶å®‰å…¨æ—¶æ‰è¡Œã€‚</p>
<p dir="auto">è¿™ä¸ªåŠŸèƒ½å…è®¸ç”¨æˆ·æå–ä»–ä»¬çš„æŠµæŠ¼å“â€”â€”ä½†å‰ææ˜¯è¿™æ ·åšä¸ä¼šè®©ä»–ä»¬çš„è´·æ¬¾å¤„äºé£é™©ä¹‹ä¸­ã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥ï¼Œå°±åƒä½ æ­£åœ¨ä¸ä¸€ä¸ªéå¸¸è°¨æ…ä½†éå¸¸å…¬å¹³çš„æ™ºèƒ½åˆçº¦é“¶è¡Œå®¶è°ˆåˆ¤ä¸€æ ·ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>âœ… ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬æ£€æŸ¥</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must withdraw a positive amount</span>"</span>);
<span class="pl-k">require</span>(collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Insufficient collateral</span>"</span>);
</pre></div>
<p dir="auto">è¿™ä¸¤è¡Œä»£ç å¾ˆç›´æ¥ï¼š</p>
<p dir="auto">ç¡®ä¿ç”¨æˆ·æ­£åœ¨å°è¯•æå–ä¸€ä¸ªçœŸå®çš„é‡‘é¢ã€‚</p>
<p dir="auto">ç¡®ä¿ä»–ä»¬ç¡®å®æœ‰è¶³å¤Ÿçš„æŠµæŠ¼å“æ¥å°è¯•è¿™ä¸€ç‚¹ã€‚</p>
<p dir="auto">å¦‚æœä»»ä½•ä¸€é¡¹æ£€æŸ¥å¤±è´¥â€”â€”æˆ‘ä»¬ç«‹å³åœæ­¢ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§  ç¬¬ 2 æ­¥ï¼šé£é™©è¯„ä¼°</strong></h3></div>
<p dir="auto">ç°åœ¨è¿›å…¥é‡è¦ç¯èŠ‚â€”â€”ç¡®ä¿ç”¨æˆ·åœ¨ææ¬¾åä»ç„¶æœ‰æŠµæŠ¼å“ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥ä»–ä»¬æ¬ å¤šå°‘å€ºåŠ¡ï¼š</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> borrowedAmount <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);
</pre></div>
<p dir="auto">è¿™åŒ…æ‹¬ä»–ä»¬éšæ—¶é—´ç´¯ç§¯çš„ä»»ä½•åˆ©æ¯ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ç„¶åæˆ‘ä»¬è®¡ç®—ä»–ä»¬éœ€è¦å¤šå°‘æŠµæŠ¼å“æ‰èƒ½ä¿æŒå®‰å…¨ï¼š</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> requiredCollateral <span class="pl-k">=</span> (borrowedAmount <span class="pl-k">*</span> <span class="pl-c1">10000</span>) <span class="pl-k">/</span> collateralFactorBasisPoints;
</pre></div>
<p dir="auto">è¿™æ˜¯åŸºäºæˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„è´·æ¬¾ä»·å€¼æ¯”ï¼ˆLTVï¼‰â€”â€” é»˜è®¤ä¸º 75%ã€‚</p>
<p dir="auto">å‡è®¾ä½ æ¬  1 ETHï¼ŒLTV ä¸º 75%ï¼š</p>
<p dir="auto">ä½ éœ€è¦è‡³å°‘ 1 / 0.75 = 1.33 ETH ä½œä¸ºæŠµæŠ¼å“é”å®šã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>â— ç¬¬ 3 æ­¥ï¼šå®‰å…¨æ£€æŸ¥</strong></h3></div>
<p dir="auto">æˆ‘ä»¬ç°åœ¨æ¨¡æ‹Ÿæœªæ¥â€”â€”å¦‚æœä½ æŠµæŠ¼äº†è¿™ç¬”èµ„äº§ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(
    collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-</span> amount <span class="pl-k">&gt;=</span> requiredCollateral,
    <span class="pl-s">"<span class="pl-s">Withdrawal would break collateral ratio</span>"</span>
);
</pre></div>
<p dir="auto">å¦‚æœç§»é™¤è¯¥ ETH ä¼šå¯¼è‡´ä½ ä½äºå®‰å…¨é™åˆ¶ï¼Œæˆ‘ä»¬å°†å›æ»šäº¤æ˜“ã€‚</p>
<blockquote>
<p dir="auto"><g-emoji class="g-emoji" alias="warning">âš ï¸</g-emoji> è¿™å°±åƒåˆçº¦å‘å‡ºçš„è­¦å‘Šï¼šâ€œç­‰ä¸€ä¸‹ã€‚å¦‚æœä½ è¿™æ ·åšï¼Œä½ çš„è´·æ¬¾å°†ä¸å†å¾—åˆ°ä¿éšœã€‚æˆ‘ä¸èƒ½å…è®¸é‚£æ ·ã€‚â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸª™ ç¬¬ 4 æ­¥ï¼šæ”¾æ‰‹ï¼ˆå¦‚æœä½ å®‰å…¨ï¼‰</strong></h3></div>
<p dir="auto">å¦‚æœä½ é€šè¿‡æ‰€æœ‰æ£€æŸ¥ï¼Œä½ å°±å¯ä»¥ç»§ç»­ã€‚</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">-=</span> amount;
<span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);
<span class="pl-k">emit</span> <span class="pl-en">CollateralWithdrawn</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
</pre></div>
<p dir="auto">æˆ‘ä»¬æ›´æ–°ä½ çš„è®°å½•ï¼Œå°† ETH å‘å›ä½ çš„é’±åŒ…ï¼Œå¹¶å‘å‡ºä¸€ä¸ªäº‹ä»¶é€šçŸ¥å‰ç«¯ã€‚</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§¾ borrow(uint256 amount) â€“ è§£é” DeFi çš„è¶…çº§èƒ½åŠ›ï¼šå€Ÿå…¥ ETH</strong></h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> borrow</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">amount</span>) <span class="pl-k">external</span> {
    <span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must borrow a positive amount</span>"</span>);
    <span class="pl-k">require</span>(<span class="pl-c1">address</span>(<span class="pl-mi">this</span>).balance <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Not enough liquidity in the pool</span>"</span>);

    <span class="pl-c1">uint256</span> maxBorrowAmount <span class="pl-k">=</span> (collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">*</span> collateralFactorBasisPoints) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
    <span class="pl-c1">uint256</span> currentDebt <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);

    <span class="pl-k">require</span>(currentDebt <span class="pl-k">+</span> amount <span class="pl-k">&lt;=</span> maxBorrowAmount, <span class="pl-s">"<span class="pl-s">Exceeds allowed borrow amount</span>"</span>);

    borrowBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> currentDebt <span class="pl-k">+</span> amount;
    lastInterestAccrualTimestamp[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span>;

    <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);
    <span class="pl-k">emit</span> <span class="pl-en">Borrow</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
}
</pre></div>
<p dir="auto">å¥½å§â€”â€”ç°åœ¨æˆ‘ä»¬è¿›å…¥åˆåŒçœŸæ­£å¼€å§‹åƒé“¶è¡Œè¿ä½œçš„éƒ¨åˆ†ã€‚</p>
<p dir="auto">è¿™ä¸ªåŠŸèƒ½å…è®¸ç”¨æˆ·ä»å€Ÿè´·æ± ä¸­å€Ÿå…¥ ETHï¼ŒåŸºäºä»–ä»¬é”å®šçš„æŠµæŠ¼å“æ•°é‡ã€‚</p>
<p dir="auto">ä½†æ˜¯â€”â€”å°±åƒç°å®ç”Ÿæ´»ä¸­ä¸€æ ·â€”â€”ä½ ä¸èƒ½èµ°è¿›é“¶è¡Œè¯´â€œç»™æˆ‘å…è´¹çš„é’±ã€‚â€</p>
<p dir="auto">æœ‰è§„åˆ™ã€‚è®©æˆ‘ä»¬æ¥é€ä¸€äº†è§£å®ƒä»¬ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§  æ­¥éª¤è¯¦è§£</strong></h3></div>
<p dir="auto"><strong>1. ç”³è¯·çœŸå®è´·æ¬¾</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(amount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must borrow a positive amount</span>"</span>);
</pre></div>
<p dir="auto">æˆ‘ä»¬ç¡®ä¿ç”¨æˆ·ä¸æ˜¯è¯•å›¾å€Ÿå…¥é›¶ ETH æˆ–è´Ÿæ•°é‡‘é¢ã€‚æ¯æ¬¡å€Ÿæ¬¾æ“ä½œéƒ½å¿…é¡»æœ‰ä¸€ä¸ªå®é™…æ•°å­—ä½œä¸ºæ”¯æ’‘ã€‚</p>
<p dir="auto"><strong>2. ç¡®ä¿æ± ä¸­æœ‰æµåŠ¨æ€§</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(<span class="pl-c1">address</span>(<span class="pl-mi">this</span>).balance <span class="pl-k">&gt;=</span> amount, <span class="pl-s">"<span class="pl-s">Not enough liquidity in the pool</span>"</span>);
</pre></div>
<p dir="auto">è¯¥åˆçº¦æ£€æŸ¥è‡ªèº«ä½™é¢ï¼Œä»¥ç¡®è®¤æ˜¯å¦çœŸçš„èƒ½å¤Ÿå€Ÿå‡ºé‚£ä¹ˆå¤š ETHã€‚</p>
<blockquote>
<p dir="auto">ä¸èƒ½å€Ÿè´·è‡ªå·±æ²¡æœ‰çš„èµ„äº§ã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>3. æ£€æŸ¥å€Ÿæ¬¾äººèµ„æ ¼</strong></h3></div>
<p dir="auto">æˆ‘ä»¬æ ¹æ®ç”¨æˆ·æä¾›çš„æŠµæŠ¼å“æ•°é‡ï¼Œè®¡ç®—å…¶å¯å€Ÿæ¬¾é‡‘é¢ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> maxBorrowAmount <span class="pl-k">=</span> (collateralBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">*</span> collateralFactorBasisPoints) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
</pre></div>
<p dir="auto">æ‰€ä»¥å¦‚æœä½ æŠµæŠ¼äº† 2 ETH ä½œä¸ºä¿è¯é‡‘ï¼Œå¹¶ä¸”ä¿è¯é‡‘ç³»æ•°æ˜¯ 75%ï¼š</p>
<ul dir="auto">
<li>maxBorrowAmount = 2 * 0.75 = 1.5 ETH</li>
</ul>
<p dir="auto">ä½†è¿™è¿˜æ²¡å®Œâ€”â€”æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä»–ä»¬å·²ç»æ¬ ä¸‹çš„ä»»ä½•å€ºåŠ¡+åˆ©æ¯ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> currentDebt <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);
</pre></div>
<p dir="auto">ç„¶åæˆ‘ä»¬æ£€æŸ¥ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(currentDebt <span class="pl-k">+</span> amount <span class="pl-k">&lt;=</span> maxBorrowAmount, <span class="pl-s">"<span class="pl-s">Exceeds allowed borrow amount</span>"</span>);
</pre></div>
<p dir="auto">å¦‚æœè¿™æ¬¡æ£€æŸ¥å¤±è´¥ï¼Œå€Ÿè´·å°†è¢«é˜»æ­¢ã€‚ç”¨æˆ·çš„æŠµæŠ¼å“æ— æ³•å®‰å…¨åœ°æ”¯æŒè¯·æ±‚çš„é‡‘é¢ã€‚</p>
<blockquote>
<p dir="auto">âœ… åªå…è®¸å®‰å…¨ã€è¶…é¢æŠµæŠ¼çš„è´·æ¬¾ã€‚</p>
</blockquote>
<p dir="auto"><strong>4. æ›´æ–°å€ºåŠ¡å’Œæ—¶é—´</strong></p>
<p dir="auto">å¦‚æœç”¨æˆ·ç¬¦åˆèµ„æ ¼ï¼Œæˆ‘ä»¬å°†ç»§ç»­å¹¶è®°å½•æ–°çš„è´·æ¬¾</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>borrowBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> currentDebt <span class="pl-k">+</span> amount;
lastInterestAccrualTimestamp[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span>;
</pre></div>
<p dir="auto">æˆ‘ä»¬è¡¨ç¤ºï¼š</p>
<ul dir="auto">
<li>â€œè¯¥ç”¨æˆ·ç°åœ¨æ¬  X ETHï¼ˆåŒ…æ‹¬è¿‡å»çš„å€ºåŠ¡ï¼‰ã€‚â€</li>
<li>â€œè€Œè¿™å°†æ˜¯æˆ‘ä»¬æœªæ¥è®¡ç®—åˆ©æ¯çš„æ—¶é—´ã€‚â€</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>5. è½¬ç§» ETH</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(amount);
</pre></div>
<p dir="auto">åˆçº¦å°†çœŸå®çš„ ETH å‘é€åˆ°ç”¨æˆ·çš„é’±åŒ…ä¸­ã€‚</p>
<p dir="auto">ç°åœ¨ä»–ä»¬å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°ä½¿ç”¨è¿™äº› ETHâ€”â€”äº¤æ˜“å®ƒã€äº¤æ¢å®ƒã€è´¨æŠ¼å®ƒâ€”â€”å®ƒå®Œå…¨å±äºä»–ä»¬ã€‚</p>
<p dir="auto"><strong>6. å‘å¸ƒå€Ÿå‡ºäº‹ä»¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">Borrow</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amount);
</pre></div>
<p dir="auto">è¿™å‘å¤–ç•Œï¼ˆä½ çš„å‰ç«¯ã€åŒºå—æµè§ˆå™¨ã€åˆ†æä»ªè¡¨æ¿ï¼‰è¡¨æ˜è¿™ä½ç”¨æˆ·åˆšåˆšå€Ÿäº†æ¬¾ã€‚</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ’³ repay() â€“ è¿˜æ¬¾ï¼Œé‡è·è‡ªç”±</strong></h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> repay</span></span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
    <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must repay a positive amount</span>"</span>);

    <span class="pl-c1">uint256</span> currentDebt <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);
    <span class="pl-k">require</span>(currentDebt <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">No debt to repay</span>"</span>);

    <span class="pl-c1">uint256</span> amountToRepay <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;
    <span class="pl-k">if</span> (amountToRepay <span class="pl-k">&gt;</span> currentDebt) {
        amountToRepay <span class="pl-k">=</span> currentDebt;
        <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">-</span> currentDebt); <span class="pl-c">// Refund the extra</span>
    }

    borrowBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> currentDebt <span class="pl-k">-</span> amountToRepay;
    lastInterestAccrualTimestamp[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span>;

    <span class="pl-k">emit</span> <span class="pl-en">Repay</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amountToRepay);
}
</pre></div>
<p dir="auto">ä½ å€Ÿäº† ETHã€‚æ—¶é—´æµé€ã€‚åˆ©æ¯ç´¯ç§¯ã€‚</p>
<p dir="auto">ç°åœ¨è¯¥è¿˜æ¬¾äº†â€”â€”è¿™æ­£æ˜¯è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬æ¥è§£æå½“ç”¨æˆ·å‘ repay() å‘é€ ETH æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>âœ… æ­¥éª¤è¯¦è§£</strong></h3></div>
<p dir="auto"><strong>1. ç¡®è®¤ä½ ç¡®å®åœ¨å‘é€ ETH</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Must repay a positive amount</span>"</span>);
</pre></div>
<p dir="auto">å°±åƒ deposit() å‡½æ•°ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸æƒ³ç”¨æˆ·è¯¯è§¦è¿™ä¸ªæ“ä½œã€‚ä½ éœ€è¦å®é™…åœ¨å‡½æ•°è°ƒç”¨æ—¶å‘é€ä¸€äº› ETHã€‚</p>
<p dir="auto"><strong>2. ç¡®è®¤ä½ æ¬ å¤šå°‘</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> currentDebt <span class="pl-k">=</span> <span class="pl-en">calculateInterestAccrued</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>);
<span class="pl-k">require</span>(currentDebt <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">No debt to repay</span>"</span>);
</pre></div>
<p dir="auto">è¿™é‡Œæˆ‘ä»¬è¯¢é—®ï¼š</p>
<p dir="auto">â€œè¿™ä½ç”¨æˆ·æ¬ å¤šå°‘â€”â€”åŒ…æ‹¬ç´¯ç§¯çš„ä»»ä½•åˆ©æ¯ï¼Ÿâ€</p>
<p dir="auto">å¦‚æœä»–ä»¬ä¸æ¬ ä»»ä½•ä¸œè¥¿ï¼Œæˆ‘ä»¬å°±åˆ°æ­¤ä¸ºæ­¢ã€‚</p>
<p dir="auto"><strong>3. æ¥å—ä½ å‘é€çš„å†…å®¹</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> amountToRepay <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>;
</pre></div>
<p dir="auto">ç°åœ¨æˆ‘ä»¬è®°å½•ç”¨æˆ·å°è¯•è¿˜æ¬¾çš„é‡‘é¢ã€‚</p>
<p dir="auto"><strong>4. å¤„ç†è¶…é¢è¿˜æ¬¾ï¼ˆé€€æ¬¾å¤šä½™éƒ¨åˆ†ï¼‰</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">if</span> (amountToRepay <span class="pl-k">&gt;</span> currentDebt) {
    amountToRepay <span class="pl-k">=</span> currentDebt;
    <span class="pl-c1">payable</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>).<span class="pl-en">transfer</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">-</span> currentDebt);
}
</pre></div>
<p dir="auto">æœ‰æ—¶ç”¨æˆ·è¿˜æ¬¾é‡‘é¢è¶…è¿‡æ¬ æ¬¾ï¼ˆå°¤å…¶æ˜¯ä¸ç¡®å®šå·²äº§ç”Ÿçš„åˆ©æ¯é‡‘é¢æ—¶ï¼‰ã€‚æˆ‘ä»¬ä¼˜é›…åœ°å¤„ç†è¿™ç§æƒ…å†µï¼š</p>
<p dir="auto">å°†è¿˜æ¬¾é‡‘é¢é™åˆ¶åœ¨å€ºåŠ¡é‡‘é¢å†…</p>
<p dir="auto">è‡ªåŠ¨é€€è¿˜å¤šä½™çš„ ETH</p>
<p dir="auto">ğŸ§  æ— éœ€æ‰‹åŠ¨è®¡ç®—å€ºåŠ¡â€”â€”åªéœ€å‘é€è¶³å¤Ÿæˆ–æ›´å¤šçš„ ETHï¼Œåˆçº¦å°†å¤„ç†å…¶ä½™éƒ¨åˆ†ã€‚</p>
<p dir="auto"><strong>5. æ›´æ–°è´·æ¬¾è®°å½•</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>borrowBalances[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> currentDebt <span class="pl-k">-</span> amountToRepay;
lastInterestAccrualTimestamp[<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>] <span class="pl-k">=</span> <span class="pl-c1">block</span>.<span class="pl-c1">timestamp</span>;
</pre></div>
<p dir="auto">è¿™ä¼šå‡å°‘ç”¨æˆ·çš„è´·æ¬¾ä½™é¢å¹¶é‡ç½®åˆ©æ¯ç´¯ç§¯çš„è®¡æ—¶å™¨ã€‚</p>
<p dir="auto">å¦‚æœä»–ä»¬å…¨é¢è¿˜æ¬¾ï¼Œä»–ä»¬çš„å€Ÿæ¬¾ä½™é¢å˜ä¸ºé›¶â€”â€”æ— å€ºåŠ¡ï¼</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>6. è§¦å‘è¿˜æ¬¾äº‹ä»¶</strong></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">Repay</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, amountToRepay);
</pre></div>
<p dir="auto">å‰ç«¯ã€æµè§ˆå™¨æˆ–åˆ†æå·¥å…·ç°åœ¨å¯ä»¥æ˜¾ç¤ºï¼š</p>
<blockquote>
<p dir="auto">â€œâœ… 1 ETH çš„è´·æ¬¾å·²è¿˜æ¬¾å®Œæˆï¼â€</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ“Š å·¥å…·å‡½æ•°â€”â€”æ”¯æŒ UI ä¸é›†æˆçš„è¾…åŠ©å·¥å…·</strong></h2></div>
<p dir="auto">æ™ºèƒ½åˆçº¦ä¸­çš„å¹¶éæ¯ä¸ªå‡½æ•°éƒ½ä¼šæ”¹å˜çŠ¶æ€æˆ–å¤„ç†èµ„é‡‘ã€‚</p>
<p dir="auto">æœ‰æ—¶ï¼Œä½ åªéœ€è¦æ£€æŸ¥æŸäº›å†…å®¹ã€‚</p>
<p dir="auto">è¿™æ—¶å·¥å…·å‡½æ•°å°±æ´¾ä¸Šç”¨åœºäº†â€”â€”å®ƒä»¬æ˜¯ç®€å•çš„åªè¯»å·¥å…·ï¼Œå¸®åŠ©å‰ç«¯ã€å…¶ä»–æ™ºèƒ½åˆçº¦æˆ–åˆ†æä»ªè¡¨æ¿ä»åˆçº¦ä¸­è·å–æœ‰ç”¨æ•°æ®ã€‚</p>
<p dir="auto">åœ¨æˆ‘ä»¬çš„ DeFi é“¶è¡Œä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªè¿™æ ·çš„å®ç”¨å‡½æ•°ï¼Œå®ƒä»¬ç¡®å®èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<p dir="auto"><strong>ğŸ” getMaxBorrowAmount(address user)</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> getMaxBorrowAmount</span></span>(<span class="pl-c1">address</span> <span class="pl-v">user</span>) <span class="pl-k">external</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (<span class="pl-c1">uint256</span>) {
    <span class="pl-k">return</span> (collateralBalances[user] <span class="pl-k">*</span> collateralFactorBasisPoints) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
}
</pre></div>
<p dir="auto">è¿™ä¸ªå‡½æ•°è®¡ç®—ç‰¹å®šç”¨æˆ·æ ¹æ®å…¶å·²æŠµæŠ¼çš„ä¿è¯é‡‘å¯ä»¥å€Ÿå¤šå°‘ ETHã€‚</p>
<p dir="auto">å®ƒä¸åœ¨ä¹ä»–ä»¬å·²ç»å€Ÿäº†å¤šå°‘â€”â€”å®ƒåªæ˜¯å‘Šè¯‰ä½ ï¼Œåœ¨ä»–ä»¬çš„ä¿è¯é‡‘ä¸‹ï¼Œä»–ä»¬å¯ä»¥å€Ÿçš„ä¸Šé™æ˜¯å¤šå°‘ã€‚</p>
<blockquote>
<p dir="auto">ğŸ§  å…¬å¼ï¼šmaxBorrow = collateral Ã— collateralFactor</p>
</blockquote>
<p dir="auto">æ‰€ä»¥å¦‚æœæœ‰äººé”å®šäº† 4 ETHï¼Œè€Œæˆ‘ä»¬çš„æŠµæŠ¼ç‡æ˜¯ 75%ï¼Œè¿™ä¸ªå‡½æ•°å°†è¿”å›ï¼š</p>
<ul dir="auto">
<li>4 Ã— 0.75 = 3 ETH â†’ é‚£å°±æ˜¯ä»–ä»¬çš„æœ€å¤§å¯å€Ÿé¢åº¦</li>
</ul>
<p dir="auto">è¿™å¯¹å‰ç«¯å¼€å‘éå¸¸æœ‰ç”¨ï¼š</p>
<ul dir="auto">
<li>å®ƒå…è®¸ç•Œé¢æ˜¾ç¤ºï¼šâ€œä½ å¯ä»¥å€Ÿæœ€å¤š 3 ETHâ€</li>
<li>æˆ–è€…æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ï¼Œå±•ç¤ºä»–ä»¬å·²ä½¿ç”¨çš„å€Ÿæ¬¾é¢åº¦</li>
</ul>
<p dir="auto"><strong>ğŸ’§ getTotalLiquidity()</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> getTotalLiquidity</span></span>() <span class="pl-k">external</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (<span class="pl-c1">uint256</span>) {
    <span class="pl-k">return</span> <span class="pl-c1">address</span>(<span class="pl-mi">this</span>).balance;
}
</pre></div>
<p dir="auto">è¿™ä¸ªæ›´ç®€å•â€”â€”å®ƒåªæ˜¯å‘Šè¯‰ä½ å½“å‰å€Ÿè´·æ± æŒæœ‰å¤šå°‘ ETHã€‚</p>
<p dir="auto">ç”±äºæ¯ä¸€ç¬”å­˜æ¬¾å’Œè¿˜æ¬¾éƒ½ä¼šå‘åˆçº¦æ·»åŠ  ETHï¼Œè€Œæ¯ä¸€ç¬”ææ¬¾æˆ–å€Ÿæ¬¾éƒ½ä¼šç§»é™¤ ETHï¼Œè¿™ä¸ªå‡½æ•°æä¾›äº†å®æ—¶çš„èµ„é‡‘æƒ…å†µã€‚</p>
<blockquote>
<p dir="auto">è¿™å°±åƒæ£€æŸ¥é“¶è¡Œçš„ä¿é™©åº“ä½™é¢ã€‚</p>
</blockquote>
<p dir="auto">å‰ç«¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼š</p>
<ul dir="auto">
<li>æ˜¾ç¤ºæ€»æ± å¤§å°</li>
<li>æŒ‡ç¤ºæ˜¯å¦æœ‰è¶³å¤Ÿçš„æµåŠ¨æ€§æ¥æ»¡è¶³å€Ÿè´·è¯·æ±‚</li>
<li>è‹¥èµ„é‡‘æ± ä½™é¢ä¸è¶³ï¼Œè¯·æé†’ç”¨æˆ·</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ”š æ€»ç»“â€”â€”ä½ æ‰€æ„å»ºçš„</strong></h3></div>
<p dir="auto">ä½ åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„èµ„é‡‘æ± ï¼Œå®ƒå¯ä»¥ï¼š</p>
<ul dir="auto">
<li>æ¥å—å­˜æ¬¾ ğŸ’°</li>
<li>è®©ç”¨æˆ·é”å®šæŠµæŠ¼å“ ğŸ›¡ï¸</li>
<li>å€Ÿå…¥ ETH ğŸ“¤</li>
<li>éšæ—¶é—´ç´¯ç§¯åˆ©æ¯ ğŸ“ˆ</li>
<li>è®©ç”¨æˆ·è¿˜æ¬¾å¹¶å–å›æŠµæŠ¼å“ âœ…</li>
</ul>
<p dir="auto">æœ¬åˆåŒå‘æ‚¨ä»‹ç»å»ä¸­å¿ƒåŒ–å€Ÿè´·çš„æ ¸å¿ƒæœºåˆ¶â€”â€”è¿™æ˜¯åƒ Aaveã€Compound å’Œ MakerDAO è¿™æ ·çš„å¹³å°æ‰€ä½¿ç”¨çš„ç›¸åŒåŸåˆ™ã€‚</p>
<p dir="auto">å®ƒç®€å•è€Œå¼ºå¤§ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/solidity.min.js"></script>
            <script>
                hljs.highlightAll();

                // å¹³æ»‘æ»šåŠ¨
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function (e) {
                        e.preventDefault();
                        const target = document.querySelector(this.getAttribute('href'));
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    });
                });

                // Snehaçš„ä¸€å°æ¥ä¿¡æ¨¡å—åŠŸèƒ½
                document.addEventListener('DOMContentLoaded', function () {
                    const envelopeContainer = document.getElementById('envelope-container');
                    const answerModal = document.getElementById('answer-modal');
                    const closeLetter = document.getElementById('close-letter');

                    if (!envelopeContainer || !answerModal || !closeLetter) {
                        return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
                    }

                    // ç‚¹å‡»ä¿¡å°æ‰“å¼€å¼¹çª—
                    envelopeContainer.addEventListener('click', function () {
                        envelopeContainer.classList.add('open');

                        // å»¶è¿Ÿæ˜¾ç¤ºå¼¹çª—ï¼Œè®©ä¿¡å°ç¿»è½¬åŠ¨ç”»å®Œæˆ
                        setTimeout(function () {
                            answerModal.style.display = 'flex';
                            setTimeout(function () {
                                answerModal.classList.add('open');
                            }, 50);
                        }, 400);
                    });

                    // å…³é—­å¼¹çª—
                    closeLetter.addEventListener('click', function () {
                        answerModal.classList.remove('open');

                        setTimeout(function () {
                            answerModal.style.display = 'none';
                            envelopeContainer.classList.remove('open');
                        }, 600);
                    });

                    // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
                    answerModal.addEventListener('click', function (e) {
                        if (e.target === answerModal) {
                            closeLetter.click();
                        }
                    });
                });
            </script>
</body>

</html>