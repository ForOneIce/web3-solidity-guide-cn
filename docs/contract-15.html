<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas-Efficient Voting - Gas优化投票 - Solidity学习</title>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Reenie+Beanie&family=Comic+Neue:ital,wght@0,400;0,700;1,400&family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <!-- Markdown渲染库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --easy: #43AA8B;
            --medium: #F8961E;
            --hard: #E71D36;
            --expert: #7209B7;
            --warm-brown: #8B7355;
            --parchment: #F5F1E6;
            --vintage-blue: #6B8E9F;
            --warm-red: #C44536;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
            color: var(--dark);
            line-height: 1.8;
            background-image: radial-gradient(#d0e3ff 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .nav-bar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-btn:hover {
            background: var(--secondary);
            transform: translateX(-3px);
        }
        
        .nav-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            color: var(--secondary);
        }
        
        .nav-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 8px;
            font-family: 'Comic Neue', cursive;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .hero-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-top: 5px solid var(--hard);
        }
        
        .hero-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .hero-title {
            flex: 1;
            min-width: 250px;
        }
        
        .day-badge {
            background: linear-gradient(135deg, var(--hard), #c72828);
            color: white;
            padding: 8px 20px;
            border-radius: 15px;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        h1 {
            font-family: 'Gochi Hand', cursive;
            font-size: 2.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .meta-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .difficulty-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
            font-size: 1rem;
        }
        
        .tag {
            background: var(--light);
            padding: 5px 15px;
            border-radius: 15px;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px dashed var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .key-point {
            background: linear-gradient(135deg, #ffe6e6, #ffd6d6);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--hard);
        }
        
        .key-point-title {
            font-weight: bold;
            color: var(--hard);
            margin-bottom: 5px;
        }
        
        .concept-card {
            background: linear-gradient(135deg, #fff0f0, #ffe6e6);
            border-left: 5px solid var(--hard);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .concept-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.4rem;
            color: var(--hard);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        pre {
            background: #282c34;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        
        code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
        }
        
        .inline-code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Fira Code', monospace;
            color: var(--hard);
            font-size: 0.9em;
        }
        
        .navigation-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-footer-btn {
            flex: 1;
            min-width: 200px;
            background: white;
            border: 3px solid var(--primary);
            padding: 20px;
            border-radius: 15px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .nav-footer-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .nav-footer-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .nav-footer-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
        }        
        /* 参考答案模块样式 - 温暖治愈风格 */
        .answer-reference {
            position: relative;
            margin: 60px 0 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .envelope-container {
            position: relative;
            width: 340px;
            height: 240px;
            cursor: pointer;
            perspective: 1200px;
            margin-bottom: 20px;
            filter: drop-shadow(0 10px 20px rgba(139, 115, 85, 0.2));
        }
        
        .envelope {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .envelope-front, .envelope-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .envelope-front {
            background: linear-gradient(135deg, #f9f3e9, #e8dfd1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #d4c9b8;
        }
        
        .envelope-flap {
            position: absolute;
            top: -70px;
            width: 0;
            height: 0;
            border-left: 170px solid transparent;
            border-right: 170px solid transparent;
            border-bottom: 70px solid #e8dfd1;
            z-index: 1;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
        }
        
        .envelope-flap::after {
            content: "";
            position: absolute;
            top: 3px;
            left: -170px;
            width: 0;
            height: 0;
            border-left: 170px solid transparent;
            border-right: 170px solid transparent;
            border-bottom: 67px solid #f9f3e9;
        }
        
        .envelope-seal {
            position: absolute;
            bottom: 25px;
            right: 35px;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle at 30% 30%, #C44536, #8B2E24);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2;
            border: 2px solid #A52A2A;
        }
        
        .seal-icon {
            color: #F5F1E6;
            font-size: 1.8rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .envelope-text {
            font-family: 'Reenie Beanie', cursive;
            font-size: 2.4rem;
            color: var(--warm-brown);
            z-index: 2;
            position: relative;
            margin-top: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }
        
        .envelope-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(139, 115, 85, 0.05) 3px, transparent 3px),
                radial-gradient(circle at 85% 75%, rgba(139, 115, 85, 0.05) 3px, transparent 3px);
            background-size: 40px 40px;
            z-index: 0;
        }
        
        .envelope-back {
            background: linear-gradient(135deg, #f5f1e6, #e8dfd1);
            transform: rotateY(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d4c9b8;
        }
        
        .envelope-container:hover .envelope {
            transform: rotateY(10deg) translateY(-5px);
        }
        
        .envelope-container.open .envelope {
            transform: rotateY(180deg);
        }
        
        .envelope-hint {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            color: var(--warm-brown);
            margin-top: 15px;
            opacity: 0.9;
            background: rgba(245, 241, 230, 0.7);
            padding: 8px 20px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        /* 弹窗样式 */
        .answer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            background: rgba(107, 142, 159, 0.7);
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(3px);
        }
        
        .letter-container {
            width: 90%;
            max-width: 900px;
            height: 80vh;
            background: #F5F1E6;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(107, 142, 159, 0.4);
            overflow: hidden;
            transform: scale(0);
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #d4c9b8;
        }
        
        .answer-modal.open .letter-container {
            transform: scale(1);
        }
        
        .letter-header {
            background: linear-gradient(135deg, #8B7355, #6B5A45);
            padding: 25px 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-bottom: 2px dashed #A5947A;
        }
        
        .letter-title {
            font-family: 'Reenie Beanie', cursive;
            font-size: 3rem;
            color: #F5F1E6;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            letter-spacing: 2px;
        }
        
        .letter-subtitle {
            color: rgba(245, 241, 230, 0.9);
            font-size: 1.3rem;
            font-family: 'Gochi Hand', cursive;
        }
        
        .close-letter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(245, 241, 230, 0.2);
            color: #F5F1E6;
            border: 1px solid rgba(245, 241, 230, 0.3);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .close-letter:hover {
            background: rgba(245, 241, 230, 0.3);
            transform: rotate(90deg);
        }
        
        .letter-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #F5F1E6;
            position: relative;
        }
        
        .letter-body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background-image: 
                linear-gradient(90deg, transparent 98%, rgba(139, 115, 85, 0.1) 98%),
                linear-gradient(rgba(139, 115, 85, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }
        
        /* MD内容样式 */
        .md-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .md-section {
            margin-bottom: 40px;
        }
        
        .md-section h1 {
            font-family: 'Reenie Beanie', cursive;
            font-size: 3rem;
            color: var(--warm-brown);
            margin-bottom: 20px;
            border-bottom: 2px dashed #A5947A;
            padding-bottom: 10px;
            text-align: center;
        }
        
        .md-section h2 {
            font-family: 'Reenie Beanie', cursive;
            font-size: 2.2rem;
            color: var(--warm-brown);
            margin: 30px 0 15px 0;
            position: relative;
            padding-left: 25px;
        }
        
        .md-section h2::before {
            content: "•";
            position: absolute;
            left: 0;
            top: 0;
            color: var(--warm-red);
            font-size: 2.5rem;
        }
        
        .md-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .md-tag {
            background: rgba(139, 115, 85, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--warm-brown);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-highlight {
            background: rgba(107, 142, 159, 0.1);
            border-left: 5px solid var(--vintage-blue);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(107, 142, 159, 0.2);
        }
        
        .md-content pre {
            background: #2d2a2e;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3), 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #3a363b;
        }
        
        .md-content code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
        }
        
        .md-content .inline-code {
            background: rgba(139, 115, 85, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            color: var(--warm-brown);
            font-size: 0.9em;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-content ul, .md-content ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }
        
        .md-content li {
            margin-bottom: 8px;
            line-height: 1.7;
        }
        
        .md-content blockquote {
            border-left: 4px solid var(--vintage-blue);
            padding-left: 20px;
            margin: 20px 0;
            font-style: italic;
            color: #666;
            background: rgba(107, 142, 159, 0.05);
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .md-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-content th, .md-content td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-content th {
            background: linear-gradient(135deg, var(--warm-brown), #6B5A45);
            color: #F5F1E6;
            font-weight: bold;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.1rem;
        }
        
        .md-content tr:nth-child(even) {
            background: rgba(139, 115, 85, 0.05);
        }
        
        /* Markdown渲染内容的额外样式 */
        #markdown-container {
            line-height: 1.8;
        }
        
        #markdown-container h3 {
            font-family: 'Reenie Beanie', cursive;
            font-size: 1.8rem;
            color: var(--warm-brown);
            margin: 25px 0 15px 0;
            position: relative;
            padding-left: 20px;
        }
        
        #markdown-container h3::before {
            content: "▸";
            position: absolute;
            left: 0;
            color: var(--vintage-blue);
            font-size: 1.5rem;
        }
        
        #markdown-container h4 {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.4rem;
            color: var(--warm-brown);
            margin: 20px 0 12px 0;
        }
        
        #markdown-container p {
            margin-bottom: 15px;
            line-height: 1.8;
        }
        
        #markdown-container strong {
            color: var(--warm-brown);
            font-weight: bold;
        }
        
        #markdown-container a {
            color: var(--vintage-blue);
            text-decoration: underline;
            transition: color 0.3s;
        }
        
        #markdown-container a:hover {
            color: var(--warm-brown);
        }
        
        #markdown-container hr {
            border: none;
            border-top: 2px dashed #A5947A;
            margin: 30px 0;
        }
        
        #markdown-container img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Markdown代码块样式 */
        #markdown-container pre {
            background: #2d2d2d;
            border: 1px solid #3a363b;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        #markdown-container pre code {
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
            background: transparent;
            padding: 0;
            border: none;
            display: block;
            white-space: pre;
        }
        
        /* 内联代码样式 */
        #markdown-container code:not(pre code) {
            background: rgba(139, 115, 85, 0.15);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            color: var(--warm-brown);
            font-size: 0.9em;
            border: 1px solid rgba(139, 115, 85, 0.3);
            font-weight: 500;
        }
        
        /* 表格中的代码 */
        #markdown-container table code {
            background: rgba(139, 115, 85, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            color: var(--warm-brown);
            font-size: 0.85em;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .signature {
            text-align: right;
            margin-top: 40px;
            font-family: 'Reenie Beanie', cursive;
            font-size: 2rem;
            color: var(--warm-brown);
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .hero-section {
                padding: 25px;
            }
            
            .section {
                padding: 20px;
            }
            
            .key-points {
                grid-template-columns: 1fr;
            }
            
            .envelope-container {
                width: 300px;
                height: 210px;
            }
            
            .envelope-flap {
                border-left: 150px solid transparent;
                border-right: 150px solid transparent;
                border-bottom: 60px solid #e8dfd1;
            }
            
            .envelope-flap::after {
                border-left: 150px solid transparent;
                border-right: 150px solid transparent;
                border-bottom: 57px solid #f9f3e9;
                left: -150px;
            }
            
            .envelope-text {
                font-size: 2rem;
            }
            
            .answer-modal {
                padding: 10px;
            }
            
            .letter-container {
                width: 95%;
                height: 85vh;
            }
            
            .letter-title {
                font-size: 2.2rem;
            }
            
            .md-section h1 {
                font-size: 2.2rem;
            }
            
            .md-section h2 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="nav-bar">
        <div class="nav-left">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> 返回首页
            </a>
            <span class="nav-title">第15天 - Gas优化技术</span>
        </div>
        <div class="nav-right">
            <a href="#concepts" class="nav-btn">📚 核心概念</a>
            <a href="#code" class="nav-btn">💻 代码讲解</a>
            <a href="#practice" class="nav-btn">🎯 实践</a>
        </div>
    </div>

    <div class="container">
        <div class="hero-section">
            <div class="hero-header">
                <div class="hero-title">
                    <div class="day-badge">第 15 天 ⚡</div>
                    <h1>Gas-Efficient Voting</h1>
                    <p class="subtitle">Gas优化投票 - 位运算与存储优化</p>
                </div>
                <div class="meta-tags">
                    <div class="difficulty-badge" style="background: var(--hard);">
                        🌳 高级
                    </div>
                    <span class="tag">Gas优化</span>
                    <span class="tag">位运算</span>
                    <span class="tag">bytes32</span>
                    <span class="tag">存储打包</span>
                </div>
            </div>
            
            <div class="key-points">
                <div class="key-point">
                    <div class="key-point-title">📌 学习目标</div>
                    <div>掌握Gas优化技术和位运算</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">🎯 核心技能</div>
                    <div>uint8/uint32、位掩码、打包</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">⏱️ 预计时间</div>
                    <div>90分钟</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">📊 主观感受难度</div>
                    <div>⭐⭐⭐⭐⭐ 极难 - Gas优化技巧和位运算操作</div>
                </div>
            </div>
        </div>

        <div class="section" id="concepts">
            <h2 class="section-title">
                <i class="fas fa-lightbulb"></i> 核心概念详解
            </h2>
            
            <div class="concept-card">
                <div class="concept-title">⚡ 为什么需要Gas优化?</div>
                <p>Gas成本直接影响用户体验和应用可行性:</p>
                
                <table style="width: 100%; margin: 15px 0; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden;">
                    <tr style="background: var(--primary); color: white;">
                        <th style="padding: 12px; text-align: left;">操作</th>
                        <th style="padding: 12px; text-align: left;">Gas成本</th>
                        <th style="padding: 12px; text-align: left;">说明</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">SSTORE (新值)</td>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">20,000</td>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">存储新数据</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">SLOAD</td>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">800</td>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">读取存储</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">Memory操作</td>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">3-10</td>
                        <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">临时存储</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                        <td style="padding: 10px;">基础运算</td>
                        <td style="padding: 10px;">3-5</td>
                        <td style="padding: 10px;">加减乘除</td>
                    </tr>
                </table>
                
                <div style="background: #fff9e6; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong style="color: #856404;">💡 优化目标:</strong>
                    <span style="color: #856404;"> 减少存储操作、使用更小的数据类型、批量处理数据</span>
                </div>
            </div>

            <div class="concept-card">
                <div class="concept-title">🔢 使用更小的数据类型</div>
                <pre><code class="language-solidity">// ❌ Gas浪费
uint256 public proposalCount;  // 使用32字节存储一个小数字

// ✅ Gas优化
uint8 public proposalCount;    // 只用1字节,节省31字节!

// 其他优化示例
uint32 public timestamp;       // 足够存储时间戳到2106年
uint32 public voteCount;       // 最大值42亿,通常够用
bytes32 public proposalName;   // 固定大小,比string便宜</code></pre>
                
                <p style="margin-top: 15px;"><strong>数据类型大小:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                    <li><code class="inline-code">uint8</code>: 1 byte (0 ~ 255)</li>
                    <li><code class="inline-code">uint16</code>: 2 bytes (0 ~ 65,535)</li>
                    <li><code class="inline-code">uint32</code>: 4 bytes (0 ~ 4,294,967,295)</li>
                    <li><code class="inline-code">uint256</code>: 32 bytes (默认)</li>
                </ul>
            </div>

            <div class="concept-card">
                <div class="concept-title">📦 存储打包 (Storage Packing)</div>
                <p>Solidity按32字节槽位存储数据,多个小变量可以打包到一个槽位:</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4 style="color: var(--hard); margin-bottom: 10px;">❌ 未优化 (3个槽位)</h4>
                        <pre><code class="language-solidity">struct Proposal {
    uint256 voteCount;  // 槽位0
    uint256 startTime;  // 槽位1
    bool executed;      // 槽位2
}</code></pre>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #28a745; margin-bottom: 10px;">✅ 优化后 (1个槽位!)</h4>
                        <pre><code class="language-solidity">struct Proposal {
    uint32 voteCount;   // |
    uint32 startTime;   // | 全在槽位0
    uint32 endTime;     // |
    bool executed;      // |
}</code></pre>
                    </div>
                </div>
                
                <p><strong>Gas节省:</strong> 读写一个槽位 vs 三个槽位 = 节省约40,000 gas!</p>
            </div>

            <div class="concept-card">
                <div class="concept-title">🎭 位运算 - 用一个uint256存储256个布尔值</div>
                <p>传统方式需要256个存储槽位,位运算只需要1个!</p>
                
                <pre><code class="language-solidity">// 存储投票状态: 每个提案一个bit
mapping(address => uint256) private voterRegistry;

// 检查是否投过票 (提案ID = 5)
uint256 mask = 1 << 5;              // 创建掩码: 0000...0100000
bool hasVoted = (voterData & mask) != 0;

// 记录投票
voterRegistry[msg.sender] = voterData | mask;</code></pre>
                
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">位运算示例:</h4>
                    <pre><code>uint256 data = 0;  // 0000 0000

// 设置第3位为1
data = data | (1 << 3);  // 0000 1000

// 检查第3位
bool isSet = (data & (1 << 3)) != 0;  // true

// 设置第5位
data = data | (1 << 5);  // 0010 1000

// 清除第3位
data = data & ~(1 << 3);  // 0010 0000</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <div class="concept-title">📝 bytes32 vs string</div>
                <pre><code class="language-solidity">// ❌ string (动态大小,昂贵)
string public proposalName = "Build new park";
// 每次读写都需要额外gas

// ✅ bytes32 (固定大小,便宜)
bytes32 public proposalName = "Build new park";
// 固定32字节,单次读写

// 转换: string -> bytes32
bytes32 nameBytes = bytes32(bytes("Build new park"));</code></pre>
                
                <p style="margin-top: 15px;"><strong>限制:</strong> bytes32最多存储32个ASCII字符(或11个汉字UTF-8)</p>
            </div>
        </div>

        <div class="section" id="code">
            <h2 class="section-title">
                <i class="fas fa-code"></i> 完整代码详解
            </h2>
            
            <h3 style="color: var(--secondary); margin: 20px 0;">📄 Gas优化投票合约</h3>
            <pre><code class="language-solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract GasEfficientVoting {
    // ✅ 使用uint8而不是uint256
    uint8 public proposalCount;
    
    // ✅ 结构体打包
    struct Proposal {
        bytes32 name;       // 32 bytes
        uint32 voteCount;   // 4 bytes  |
        uint32 startTime;   // 4 bytes  | 打包在同一槽位
        uint32 endTime;     // 4 bytes  |
        bool executed;      // 1 byte   |
    }
    
    // ✅ 映射代替数组(O(1)查找)
    mapping(uint8 => Proposal) public proposals;
    
    // ✅ 位运算存储投票状态
    mapping(address => uint256) private voterRegistry;
    mapping(uint8 => uint32) public proposalVoterCount;
    
    // 事件
    event ProposalCreated(uint8 indexed proposalId, bytes32 name);
    event Voted(address indexed voter, uint8 indexed proposalId);
    event ProposalExecuted(uint8 indexed proposalId);
    
    // 创建提案
    function createProposal(bytes32 name, uint32 duration) external {
        uint8 proposalId = proposalCount;
        proposalCount++;
        
        Proposal memory newProposal = Proposal({
            name: name,
            voteCount: 0,
            startTime: uint32(block.timestamp),
            endTime: uint32(block.timestamp + duration),
            executed: false
        });
        
        proposals[proposalId] = newProposal;
        emit ProposalCreated(proposalId, name);
    }
    
    // 投票 (使用位运算)
    function vote(uint8 proposalId) external {
        require(proposalId < proposalCount, "Invalid proposal");
        require(block.timestamp >= proposals[proposalId].startTime, "Not started");
        require(block.timestamp <= proposals[proposalId].endTime, "Ended");
        require(!proposals[proposalId].executed, "Already executed");
        
        uint256 voterData = voterRegistry[msg.sender];
        uint256 mask = 1 << proposalId;
        
        // 检查是否已投票
        require((voterData & mask) == 0, "Already voted");
        
        // 记录投票
        voterRegistry[msg.sender] = voterData | mask;
        proposals[proposalId].voteCount++;
        proposalVoterCount[proposalId]++;
        
        emit Voted(msg.sender, proposalId);
    }
    
    // 执行提案
    function executeProposal(uint8 proposalId) external {
        require(proposalId < proposalCount, "Invalid proposal");
        require(block.timestamp > proposals[proposalId].endTime, "Not ended");
        require(!proposals[proposalId].executed, "Already executed");
        
        proposals[proposalId].executed = true;
        emit ProposalExecuted(proposalId);
    }
    
    // 检查投票状态
    function hasVoted(address voter, uint8 proposalId) external view returns (bool) {
        return (voterRegistry[voter] & (1 << proposalId)) != 0;
    }
    
    // 获取提案详情
    function getProposal(uint8 proposalId) external view returns (
        bytes32 name,
        uint32 voteCount,
        uint32 startTime,
        uint32 endTime,
        bool executed
    ) {
        Proposal memory p = proposals[proposalId];
        return (p.name, p.voteCount, p.startTime, p.endTime, p.executed);
    }
}</code></pre>

            <div style="background: linear-gradient(135deg, #d4edda, #c3e6cb); border-left: 5px solid #28a745; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <strong style="color: #155724;">✅ Gas优化总结</strong>
                <ul style="margin-top: 10px; color: #155724; line-height: 2;">
                    <li>✅ 使用uint8/uint32替代uint256 - 节省存储空间</li>
                    <li>✅ 结构体成员打包到同一槽位 - 减少SLOAD/SSTORE</li>
                    <li>✅ bytes32替代string - 固定大小更便宜</li>
                    <li>✅ 位运算存储布尔值 - 1个uint256存256个状态</li>
                    <li>✅ 映射替代数组 - O(1)查找,不需要遍历</li>
                </ul>
            </div>

            <h3 style="color: var(--secondary); margin: 30px 0 20px 0;">🔍 位运算详解</h3>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                <h4 style="color: var(--primary); margin-bottom: 15px;">位运算操作示例</h4>
                <pre><code class="language-solidity">// 假设voterData初始为0
uint256 voterData = 0;
// 二进制: 0000 0000 0000 0000

// 场景1: 投票给提案3
uint256 mask = 1 << 3;      // 0000 0000 0000 1000
voterData = voterData | mask;
// 结果: 0000 0000 0000 1000

// 场景2: 投票给提案7
mask = 1 << 7;              // 0000 0000 1000 0000
voterData = voterData | mask;
// 结果: 0000 0000 1000 1000

// 场景3: 检查是否投给提案3
mask = 1 << 3;              // 0000 0000 0000 1000
bool voted = (voterData & mask) != 0;
// (0000 0000 1000 1000) & (0000 0000 0000 1000) = 0000 0000 0000 1000
// 不等于0,所以voted = true

// 场景4: 检查是否投给提案5
mask = 1 << 5;              // 0000 0000 0010 0000
voted = (voterData & mask) != 0;
// (0000 0000 1000 1000) & (0000 0000 0010 0000) = 0000 0000 0000 0000
// 等于0,所以voted = false</code></pre>
            </div>

            <h3 style="color: var(--secondary); margin: 30px 0 20px 0;">📊 Gas对比</h3>
            
            <table style="width: 100%; margin: 20px 0; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden;">
                <tr style="background: var(--primary); color: white;">
                    <th style="padding: 12px; text-align: left;">操作</th>
                    <th style="padding: 12px; text-align: left;">未优化</th>
                    <th style="padding: 12px; text-align: left;">优化后</th>
                    <th style="padding: 12px; text-align: left;">节省</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">创建提案</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">~65,000 gas</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">~45,000 gas</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #28a745;">-30%</td>
                </tr>
                <tr style="background: #f8f9fa;">
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">投票</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">~50,000 gas</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef;">~35,000 gas</td>
                    <td style="padding: 10px; border-bottom: 1px solid #e9ecef; color: #28a745;">-30%</td>
                </tr>
                <tr>
                    <td style="padding: 10px;">存储布尔数组(100个)</td>
                    <td style="padding: 10px;">~2,000,000 gas</td>
                    <td style="padding: 10px;">~20,000 gas</td>
                    <td style="padding: 10px; color: #28a745;">-99%!</td>
                </tr>
            </table>
        </div>

        <div class="section" id="practice">
            <h2 class="section-title">
                <i class="fas fa-dumbbell"></i> 实践与练习
            </h2>
            
            <h3 style="color: var(--secondary); margin-bottom: 20px;">📝 Remix实战步骤</h3>
            
            <div style="margin: 30px 0;">
                <h4 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem;">步骤1: 部署合约并创建提案</h4>
                <ol style="margin: 10px 0 10px 25px; line-height: 2;">
                    <li>部署GasEfficientVoting合约</li>
                    <li>转换字符串为bytes32:<code class="inline-code">web3.utils.asciiToHex("Proposal 1")</code></li>
                    <li>调用<code class="inline-code">createProposal(bytes32值, 86400)</code> (1天)</li>
                    <li>查看Gas消耗</li>
                </ol>
            </div>

            <div style="margin: 30px 0;">
                <h4 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem;">步骤2: 测试投票和位运算</h4>
                <ol style="margin: 10px 0 10px 25px; line-height: 2;">
                    <li>切换到不同账户</li>
                    <li>调用<code class="inline-code">vote(0)</code>投票给提案0</li>
                    <li>尝试再次投票 - 应该失败"Already voted"</li>
                    <li>调用<code class="inline-code">hasVoted(你的地址, 0)</code> - 应返回true</li>
                </ol>
            </div>

            <div style="margin: 30px 0;">
                <h4 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem;">步骤3: 多提案投票测试</h4>
                <ol style="margin: 10px 0 10px 25px; line-height: 2;">
                    <li>创建多个提案(0-5)</li>
                    <li>对提案0、2、4投票</li>
                    <li>检查<code class="inline-code">hasVoted</code>:
                        <ul style="margin-left: 20px;">
                            <li>提案0: true ✅</li>
                            <li>提案1: false ❌</li>
                            <li>提案2: true ✅</li>
                            <li>提案3: false ❌</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <h3 style="color: var(--secondary); margin: 40px 0 20px 0;">🎯 挑战练习</h3>
            <div style="background: linear-gradient(135deg, #fff9e6, #ffedd5); border-left: 5px solid var(--medium); padding: 25px; border-radius: 10px;">
                <p style="font-weight: bold; margin-bottom: 15px; font-size: 1.1rem;">尝试以下改进:</p>
                <ol style="margin-left: 25px; line-height: 2.2;">
                    <li>添加提案描述(使用IPFS哈希存储详情)</li>
                    <li>实现委托投票(A可以将投票权委托给B)</li>
                    <li>添加投票权重(根据代币持有量)</li>
                    <li>实现二次投票(Quadratic Voting)</li>
                    <li>添加提案类别和标签</li>
                    <li>实现批量投票(一次对多个提案投票)</li>
                    <li>对比优化前后的Gas消耗</li>
                </ol>
            </div>

            <h3 style="color: var(--secondary); margin: 40px 0 20px 0;">📚 深入理解</h3>
            
            <div style="background: white; border: 2px solid var(--accent); padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: var(--primary); margin-bottom: 10px;">位运算操作符</h4>
                <table style="width: 100%; margin-top: 10px; border-collapse: collapse;">
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 10px; text-align: left;">操作符</th>
                        <th style="padding: 10px; text-align: left;">说明</th>
                        <th style="padding: 10px; text-align: left;">示例</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border-top: 1px solid #e9ecef;"><code class="inline-code">&</code></td>
                        <td style="padding: 10px; border-top: 1px solid #e9ecef;">按位与</td>
                        <td style="padding: 10px; border-top: 1px solid #e9ecef;">1010 & 1100 = 1000</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;"><code class="inline-code">|</code></td>
                        <td style="padding: 10px;">按位或</td>
                        <td style="padding: 10px;">1010 | 1100 = 1110</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;"><code class="inline-code">^</code></td>
                        <td style="padding: 10px;">按位异或</td>
                        <td style="padding: 10px;">1010 ^ 1100 = 0110</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;"><code class="inline-code">~</code></td>
                        <td style="padding: 10px;">按位非</td>
                        <td style="padding: 10px;">~1010 = 0101</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;"><code class="inline-code"><<</code></td>
                        <td style="padding: 10px;">左移</td>
                        <td style="padding: 10px;">1010 << 2 = 101000</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;"><code class="inline-code">>></code></td>
                        <td style="padding: 10px;">右移</td>
                        <td style="padding: 10px;">1010 >> 2 = 10</td>
                    </tr>
                </table>
            </div>

            <div style="background: white; border: 2px solid var(--accent); padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: var(--primary); margin-bottom: 10px;">更多Gas优化技巧</h4>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li><strong>缓存storage到memory</strong>: 多次读取同一变量时先缓存</li>
                    <li><strong>使用calldata</strong>: 外部函数参数用calldata而不是memory</li>
                    <li><strong>短路求值</strong>: 将便宜的条件放在require前面</li>
                    <li><strong>循环优化</strong>: 缓存array.length,避免重复计算</li>
                    <li><strong>删除不需要的变量</strong>: delete可以退还gas</li>
                    <li><strong>使用事件而非存储</strong>: 历史数据用事件记录</li>
                </ul>
            </div>

            <div style="background: white; border: 2px solid var(--accent); padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: var(--primary); margin-bottom: 10px;">存储槽位布局示例</h4>
                <pre><code class="language-solidity">contract StorageLayout {
    // 槽位0 (完全填满!)
    uint128 a;  // 16 bytes
    uint64 b;   // 8 bytes
    uint32 c;   // 4 bytes
    uint16 d;   // 2 bytes
    uint8 e;    // 1 byte
    uint8 f;    // 1 byte
    
    // 槽位1 (新槽位,因为g太大放不下)
    uint256 g;  // 32 bytes
    
    // 最佳实践: 将相关的小类型组合在一起
}</code></pre>
            </div>
        </div>

        <div class="navigation-footer">
            <a href="contract-14.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">← 上一个</div>
                <div class="nav-footer-title">SafeDeposit 安全保管箱</div>
            </a>
            <a href="contract-16.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">下一个 →</div>
                <div class="nav-footer-title">PluginStore - 插件商店</div>
            </a>
        </div>
    
        <!-- Sneha的一封来信模块 -->
        <div class="answer-reference">
            <div class="envelope-container" id="envelope-container">
                <div class="envelope">
                    <div class="envelope-front">
                        <div class="envelope-flap"></div>
                        <div class="envelope-pattern"></div>
                        <div class="envelope-seal">
                            <i class="fas fa-feather-alt seal-icon"></i>
                        </div>
                        <div class="envelope-text">Sneha的一封来信</div>
                    </div>
                    <div class="envelope-back">
                        <div class="envelope-text" style="color: var(--warm-brown);">点击开启</div>
                    </div>
                </div>
            </div>
            <div class="envelope-hint">点击信封查看Sneha的来信</div>
        </div>
    </div>

    <!-- 弹窗 - 内容待后续精细化处理 -->
    <div class="answer-modal" id="answer-modal">
        <div class="letter-container">
            <div class="letter-header">
                <div class="letter-title">Sneha的一封来信</div>
                <div class="letter-subtitle">关于第15天的学习指导</div>
                <button id="close-letter" class="close-letter">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="letter-body">
                <div id="md-content" class="md-content">
                    <div id="markdown-container" class="md-section">
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>正在加载Sneha的来信内容...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/solidity.min.js"></script>
    <script>
        // 确保marked.js已加载
        if (typeof marked === 'undefined') {
            console.warn('marked.js未加载，请检查网络连接');
        }
        
        hljs.highlightAll();
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
            
        // Sneha的一封来信模块功能
        document.addEventListener('DOMContentLoaded', function() {
            const envelopeContainer = document.getElementById('envelope-container');
            const answerModal = document.getElementById('answer-modal');
            const closeLetter = document.getElementById('close-letter');
            const markdownContainer = document.getElementById('markdown-container');
            
            if (!envelopeContainer || !answerModal || !closeLetter || !markdownContainer) {
                return; // 如果元素不存在，直接返回
            }
            
            // 配置marked.js渲染选项
            if (typeof marked !== 'undefined') {
                marked.setOptions({
                    highlight: function(code, lang) {
                        if (lang && hljs.getLanguage(lang)) {
                            try {
                                return hljs.highlight(code, { language: lang }).value;
                            } catch (err) {}
                        }
                        return hljs.highlightAuto(code).value;
                    },
                    breaks: true,
                    gfm: true
                });
            }
            
            // 嵌入的Markdown内容（使用JSON.parse解析，确保特殊字符正确转义）
            const embeddedMarkdownJsonString = "# Gas节省方式\\n\\nDay: Day 15\\nID: 15\\n译者: Shuyi\\n难度等级: 中级\\n\\n我们已经走了很长一段路了。从学习如何构建代币合约到安全的保险库系统，您现在对智能合约架构和继承有了扎实的掌握。\\n\\n但有一件事我们还没有深入探讨：**Gas 优化**。\\n\\n在编写智能合约时，尤其是那些许多用户会交互的合约（比如投票系统），**节省 Gas** 至关重要——否则，即使是简单的操作也可能变得昂贵，让用户望而却步。\\n\\n因此，在本课中，我们将探索如何编写**一个精简、高效且经济的投票合约**。\\n\\n但在我们深入了解优化版本之前，让我们看看一个典型的、未经优化的版本可能是什么样子——以及为什么它可以改进。\\n\\n## 产品需求书\\n\\n### 合约流程图\\n\\n```mermaid\\ngraph TD\\n  A[VoteManager 合约] --> H1[函数: handleVote]\\n  H1 --> H2{onlyRegistered 校验?}\\n  H2 -- 否 --> H3[revert: 未注册用户]\\n  H2 -- 是 --> H4[读取 proposalId]\\n  H4 --> H5[\\\"读取 voterRegistry[msg.sender]\\\"]\\n  H5 --> H6{\\\"是否已投票？(位掩码检测)\\\"}\\n  H6 -- 是 --> H7[revert: 重复投票]\\n  H6 -- 否 --> H8[记录投票到 proposalVotes]\\n  H8 --> H9[更新 voterRegistry 状态]\\n  H9 --> H10((事件: VoteCast))\\n  H10 --> H11{检查是否达成多数?}\\n  H11 -- 是 --> H12((事件: ProposalApproved))\\n  H11 -- 否 --> H13[继续等待其他投票]\\n\\n```\\n\\n### 合约与函数清单\\n\\n| Contract | Type | Bases |\\n| --- | --- | --- |\\n| GasEfficientVoting | Implementation | - |\\n| └ Function Name | Visibility | Mutability |\\n| └ createProposal | External ❗️ | 🛑 |\\n| └ vote | External ❗️ | 🛑 |\\n| └ executeProposal | External ❗️ | 🛑 |\\n| └ hasVoted | External ❗️ | view |\\n| └ getProposal | External ❗️ | view |\\n\\n## 🧱 第一部分：通用投票合约（未经优化）\\n\\n在深入了解 **GasEfficientVoting** 合约之前，让我们想象一下，在一个更\\\"标准\\\"的 Solidity 合约中，这个投票系统会是什么样子——一个初学者可能在不怎么担心 Gas 的情况下编写的版本。\\n\\n以下是一个简化后的版本：\\n\\n```solidity\\n\\npragma solidity ^0.8.0;\\n\\ncontract BasicVoting {\\n    struct Proposal {\\n        string name;\\n        uint256 voteCount;\\n        uint256 startTime;\\n        uint256 endTime;\\n        bool executed;\\n    }\\n\\n    Proposal[] public proposals;\\n    mapping(address => mapping(uint => bool)) public hasVoted;\\n\\n    function createProposal(string memory name, uint duration) public {\\n        proposals.push(Proposal({\\n            name: name,\\n            voteCount: 0,\\n            startTime: block.timestamp,\\n            endTime: block.timestamp + duration,\\n            executed: false\\n        }));\\n    }\\n\\n    function vote(uint proposalId) public {\\n        Proposal storage proposal = proposals[proposalId];\\n        require(block.timestamp >= proposal.startTime, \\\"Too early\\\");\\n        require(block.timestamp <= proposal.endTime, \\\"Too late\\\");\\n        require(!hasVoted[msg.sender][proposalId], \\\"Already voted\\\");\\n\\n        hasVoted[msg.sender][proposalId] = true;\\n        proposal.voteCount++;\\n    }\\n\\n    function executeProposal(uint proposalId) public {\\n        Proposal storage proposal = proposals[proposalId];\\n        require(block.timestamp > proposal.endTime, \\\"Too early\\\");\\n        require(!proposal.executed, \\\"Already executed\\\");\\n\\n        proposal.executed = true;\\n        // Some execution logic here\\n    }\\n}\\n```\\n\\n### 🚨 此版本中的问题：\\n\\n- 对名称使用了 `string` 而非 `bytes32`（更昂贵）\\n- 对提案使用了动态数组（增长和访问需要更多 Gas）\\n- 使用**嵌套映射**（`mapping(address => mapping(uint => bool))`）来追踪个人投票——占用更多存储空间\\n- 每一次存储写入（如追踪投票）都会消耗 Gas\\n\\n---\\n\\n现在，让我们来看看 **GasEfficientVoting** 版本，看看每个部分是如何优化的：\\n\\n# 🚀 我们关注的内容\\n\\n我们之前已经编写了一个标准的投票合约。它使用字符串作为提案名称，到处使用 `uint256`，使用数组来存储数据，并使用多个映射来跟踪投票。\\n\\n现在，我们正在重写同样的逻辑——**但这次是以 Gas 优化为核心**。\\n\\n因此，该合约仍然：\\n\\n- 允许用户创建提案\\n- 允许用户投票\\n- 追踪谁投了票\\n- 允许我们执行提案\\n- 触发事件\\n\\n但它使用**更少的 Gas 完成所有这些操作**。\\n\\n让我们一块一块地分解它：\\n\\n```solidity\\n// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.0;\\n\\ncontract GasEfficientVoting {\\n    \\n    // Use uint8 for small numbers instead of uint256\\n    uint8 public proposalCount;\\n    \\n    // Compact struct using minimal space types\\n    struct Proposal {\\n        bytes32 name;          // Use bytes32 instead of string to save gas\\n        uint32 voteCount;      // Supports up to ~4.3 billion votes\\n        uint32 startTime;      // Unix timestamp (supports dates until year 2106)\\n        uint32 endTime;        // Unix timestamp\\n        bool executed;         // Execution status\\n    }\\n    \\n    // Using a mapping instead of an array for proposals is more gas efficient for access\\n    mapping(uint8 => Proposal) public proposals;\\n    \\n    // Single-slot packed user data\\n    // Each address occupies one storage slot in this mapping\\n    // We pack multiple voting flags into a single uint256 for gas efficiency\\n    // Each bit in the uint256 represents a vote for a specific proposal\\n    mapping(address => uint256) private voterRegistry;\\n    \\n    // Count total voters for each proposal (optional)\\n    mapping(uint8 => uint32) public proposalVoterCount;\\n    \\n    // Events\\n    event ProposalCreated(uint8 indexed proposalId, bytes32 name);\\n    event Voted(address indexed voter, uint8 indexed proposalId);\\n    event ProposalExecuted(uint8 indexed proposalId);\\n    \\n\\n    \\n    // === Core Functions ===\\n    \\n    /**\\n     * @dev Create a new proposal\\n     * @param name The proposal name (pass as bytes32 for gas efficiency)\\n     * @param duration Voting duration in seconds\\n     */\\n    function createProposal(bytes32 name, uint32 duration) external {\\n        require(duration > 0, \\\"Duration must be > 0\\\");\\n        \\n        // Increment counter - cheaper than .push() on an array\\n        uint8 proposalId = proposalCount;\\n        proposalCount++;\\n        \\n        // Use a memory struct and then assign to storage\\n        Proposal memory newProposal = Proposal({\\n            name: name,\\n            voteCount: 0,\\n            startTime: uint32(block.timestamp),\\n            endTime: uint32(block.timestamp) + duration,\\n            executed: false\\n        });\\n        \\n        proposals[proposalId] = newProposal;\\n        \\n        emit ProposalCreated(proposalId, name);\\n    }\\n    \\n    /**\\n     * @dev Vote on a proposal\\n     * @param proposalId The proposal ID\\n     */\\n    function vote(uint8 proposalId) external {\\n        // Require valid proposal\\n        require(proposalId < proposalCount, \\\"Invalid proposal\\\");\\n        \\n        // Check proposal voting period\\n        uint32 currentTime = uint32(block.timestamp);\\n        require(currentTime >= proposals[proposalId].startTime, \\\"Voting not started\\\");\\n        require(currentTime <= proposals[proposalId].endTime, \\\"Voting ended\\\");\\n        \\n        // Check if already voted using bit manipulation (gas efficient)\\n        uint256 voterData = voterRegistry[msg.sender];\\n        uint256 mask = 1 << proposalId;\\n        require((voterData & mask) == 0, \\\"Already voted\\\");\\n        \\n        // Record vote using bitwise OR\\n        voterRegistry[msg.sender] = voterData | mask;\\n        \\n        // Update proposal vote count\\n        proposals[proposalId].voteCount++;\\n        proposalVoterCount[proposalId]++;\\n        \\n        emit Voted(msg.sender, proposalId);\\n    }\\n    \\n    /**\\n     * @dev Execute a proposal after voting ends\\n     * @param proposalId The proposal ID\\n     */\\n    function executeProposal(uint8 proposalId) external {\\n        require(proposalId < proposalCount, \\\"Invalid proposal\\\");\\n        require(block.timestamp > proposals[proposalId].endTime, \\\"Voting not ended\\\");\\n        require(!proposals[proposalId].executed, \\\"Already executed\\\");\\n        \\n        proposals[proposalId].executed = true;\\n        \\n        emit ProposalExecuted(proposalId);\\n        \\n        // In a real contract, execution logic would happen here\\n    }\\n    \\n    // === View Functions ===\\n    \\n    /**\\n     * @dev Check if an address has voted for a proposal\\n     * @param voter The voter address\\n     * @param proposalId The proposal ID\\n     * @return True if the address has voted\\n     */\\n    function hasVoted(address voter, uint8 proposalId) external view returns (bool) {\\n        return (voterRegistry[voter] & (1 << proposalId)) != 0;\\n    }\\n    \\n    /**\\n     * @dev Get detailed proposal information\\n     * Uses calldata for parameters and memory for return values\\n     */\\n    function getProposal(uint8 proposalId) external view returns (\\n        bytes32 name,\\n        uint32 voteCount,\\n        uint32 startTime,\\n        uint32 endTime,\\n        bool executed,\\n        bool active\\n    ) {\\n        require(proposalId < proposalCount, \\\"Invalid proposal\\\");\\n        \\n        Proposal storage proposal = proposals[proposalId];\\n        \\n        return (\\n            proposal.name,\\n            proposal.voteCount,\\n            proposal.startTime,\\n            proposal.endTime,\\n            proposal.executed,\\n            (block.timestamp >= proposal.startTime && block.timestamp <= proposal.endTime)\\n        );\\n    }\\n    \\n    /**\\n     * @dev Convert string to bytes32 (helper for frontend integration)\\n     * Note: This is a pure function that doesn't use state, so it's gas-efficient\\n     */\\n\\n}\\n```\\n\\n## \\n\\n在我们早期的投票合约中，我们走了传统的路线——使用人类可读的字符串作为提案名称，`uint256` 作为所有内容的默认类型，以及数组和映射来跟踪投票。它能工作，但不够精简。\\n\\n这一次，我们正在构建**相同的投票系统**，但带着一种新的思维模式：**如何在不牺牲功能的前提下，节省每一个可能的 Gas 单位？**\\n\\n那么哪些保持不变呢？\\n\\n- ✅ 用户仍然可以创建提案\\n- ✅ 用户可以投票\\n- ✅ 我们追踪投票历史\\n- ✅ 提案可以被执行\\n- ✅ 事件被触发以保持透明度\\n\\n但关键在于：我们通过做出更智能的存储和逻辑决策，使所有操作**更快、更便宜**。\\n\\n让我们一块一块地解析这个合约 👇\\n\\n---\\n\\n## 🧱 合约定义\\n\\n```solidity\\n\\n// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.0;\\n\\ncontract GasEfficientVoting {\\n```\\n\\n- 名字说明了一切——这个合约是我们投票系统的精简、Gas 友好的版本。\\n\\n---\\n\\n## 🔐 存储变量\\n\\n```solidity\\n\\nuint8 public proposalCount;\\n```\\n\\n- **为什么是 `uint8`？** 我们可能不会有超过 255 个提案。使用 `uint256` 会提供远远超出所需的范围，浪费 31 个额外的存储字节。\\n- 这一微小改变减少了读取和写入此变量的 Gas 使用量。\\n\\n---\\n\\n## 🗃️ 提案结构体（Proposal Struct）\\n\\n```solidity\\n \\nstruct Proposal {\\n    bytes32 name;\\n    uint32 voteCount;\\n    uint32 startTime;\\n    uint32 endTime;\\n    bool executed;\\n}\\n```\\n\\n这是优化真正开始显现的地方：\\n\\n| 字段 | 类型 | 为什么选择它 |\\n| --- | --- | --- |\\n| `name` | `bytes32` | 固定大小，比 `string` 便宜 |\\n| `voteCount` | `uint32` | 足以支持 42 亿次投票，节省 Gas |\\n| `startTime` | `uint32` | 同样，适合 UNIX 时间戳 |\\n| `endTime` | `uint32` | 我们不需要纳秒级的精度 |\\n| `executed` | `bool` | 一个字节用于表示真/假 |\\n\\n> 结构体打包技巧：Solidity 将结构体数据存储在 32 字节的块中。通过仔细选择类型（uint32、bool、bytes32），减少了浪费的空间——更少的存储槽意味着更低的 Gas。\\n> \\n\\n---\\n\\n## 🧭 提案映射（Proposal Mapping）\\n\\n```solidity\\nmapping(uint8 => Proposal) public proposals;\\n```\\n\\n- 我们使用映射而不是数组来存储提案。\\n- 映射为我们提供了对每个提案的**直接访问（O(1)）**，无需像数组那样进行迭代或边界检查。\\n\\n> 另外，我们使用 uint8 作为键（key)——更小的键意味着更小的存储占用。\\n> \\n\\n---\\n\\n## 💾 使用位图的投票者注册表\\n\\n```solidity\\n \\nmapping(address => uint256) private voterRegistry;\\n```\\n\\n这是合约变得非常巧妙的地方。\\n\\n我们没有使用：\\n\\n```solidity\\n \\nmapping(address => mapping(uint8 => bool)) voted;\\n```\\n\\n而是将投票者的所有历史记录压缩到**一个 `uint256` 中**：\\n\\n- 每一个**位（bit）**代表他们是否对该提案投了票。\\n- 位 0 = 对提案 0 投了票\\n- 位 1 = 对提案 1 投了票\\n- ……以此类推，最多支持 256 个提案。\\n\\n这让我们能够：\\n\\n- ✅ 每个地址只需一个存储槽即可存储所有投票\\n- ✅ 使用位运算 `AND` 检查某人是否投过票\\n- ✅ 使用位运算 `OR` 记录投票\\n\\n> 比起为每个用户使用多个映射和多个存储槽要便宜得多。\\n> \\n\\n---\\n\\n## 👥 提案投票者计数\\n\\n```solidity\\n \\nmapping(uint8 => uint32) public proposalVoterCount;\\n```\\n\\n- 跟踪每个提案有多少投票者投了票。\\n- 可选但对分析或用户界面很有用。\\n- 同样，我们使用 `uint32`——范围绰绰有余，Gas 消耗更低。\\n\\n---\\n\\n## 🧾 事件\\n\\n```solidity\\n \\nevent ProposalCreated(uint8 indexed proposalId, bytes32 name);\\nevent Voted(address indexed voter, uint8 indexed proposalId);\\nevent ProposalExecuted(uint8 indexed proposalId);\\n```\\n\\n- `indexed` 允许您更有效地过滤日志（例如，显示某人投过票的所有提案）。\\n- 我们保持这些事件最小化——触发巨大的日志会消耗 Gas。\\n\\n---\\n\\n## 🧱 函数 1：`createProposal`\\n\\n```solidity\\n  \\nfunction createProposal(bytes32 name, uint32 duration) external {\\n    require(duration > 0, \\\"Duration must be > 0\\\");\\n\\n    uint8 proposalId = proposalCount;\\n    proposalCount++;\\n\\n    Proposal memory newProposal = Proposal({\\n        name: name,\\n        voteCount: 0,\\n        startTime: uint32(block.timestamp),\\n        endTime: uint32(block.timestamp) + duration,\\n        executed: false\\n    });\\n\\n    proposals[proposalId] = newProposal;\\n\\n    emit ProposalCreated(proposalId, name);\\n}\\n```\\n\\n### 🔍 这里发生了什么？\\n\\n1. **输入验证**\\n    \\n    ```solidity\\n    \\n    require(duration > 0, \\\"Duration must be > 0\\\");\\n    ```\\n    \\n    我们确保投票持续时间不为零。否则，人们可能会创建永远无法投票的提案。\\n    \\n2. **为这个提案生成一个唯一的 ID**\\n    \\n    ```solidity\\n    \\n    uint8 proposalId = proposalCount;\\n    proposalCount++;\\n    ```\\n    \\n    我们使用一个简单的计数器（`uint8`）而不是推送到数组。数组需要动态调整大小和额外的 Gas 进行边界管理——这种方式更精简。\\n    \\n3. **在内存(memory)中创建提案**\\n    \\n    ```solidity\\n    \\n    Proposal memory newProposal = Proposal({...});\\n    ```\\n    \\n    为什么是内存？因为在链下构建数据结构然后只写入存储一次会更便宜。\\n    \\n4. **赋值给存储(storage)**\\n    \\n    ```solidity\\n    \\n    proposals[proposalId] = newProposal;\\n    ```\\n    \\n    现在我们已经组装好提案，我们使用它的 ID 将其放入 `proposals` 映射中。\\n    \\n5. **触发事件**\\n    \\n    ```solidity\\n    \\n    emit ProposalCreated(proposalId, name);\\n    ```\\n    \\n    用于前端用户界面或日志，以跟踪提案何时被创建。\\n    \\n\\n---\\n\\n## 🗳️ 函数 2：`vote`\\n\\n```solidity\\n  \\nfunction vote(uint8 proposalId) external {\\n    require(proposalId < proposalCount, \\\"Invalid proposal\\\");\\n\\n    uint32 currentTime = uint32(block.timestamp);\\n    require(currentTime >= proposals[proposalId].startTime, \\\"Voting not started\\\");\\n    require(currentTime <= proposals[proposalId].endTime, \\\"Voting ended\\\");\\n\\n    uint256 voterData = voterRegistry[msg.sender];\\n    uint256 mask = 1 << proposalId;\\n    require((voterData & mask) == 0, \\\"Already voted\\\");\\n\\n    voterRegistry[msg.sender] = voterData | mask;\\n\\n    proposals[proposalId].voteCount++;\\n    proposalVoterCount[proposalId]++;\\n\\n    emit Voted(msg.sender, proposalId);\\n}\\n```\\n\\n### 🔍 这里发生了什么？\\n\\n1. **检查提案是否存在**\\n    \\n    ```solidity\\n    \\n    require(proposalId < proposalCount, \\\"Invalid proposal\\\");\\n    ```\\n    \\n    ID 必须在有效范围内（0 到 proposalCount - 1）。\\n    \\n2. **检查是否允许投票（时间上）**\\n    \\n    ```solidity\\n    \\n    require(currentTime >= proposals[proposalId].startTime, \\\"Voting not started\\\");\\n    require(currentTime <= proposals[proposalId].endTime, \\\"Voting ended\\\");\\n    ```\\n    \\n    我们确保投票已经开始并且尚未结束。\\n    \\n3. **位掩码(Bitmask)检查是否已投票**\\n    \\n    ```solidity\\n    \\n    uint256 mask = 1 << proposalId;\\n    require((voterRegistry[msg.sender] & mask) == 0, \\\"Already voted\\\");\\n    ```\\n    \\n    - `1 << proposalId` 创建一个二进制掩码，例如 `000100`（如果 `proposalId` 是 2）。\\n    - 位运算 AND 检查该位是否已在用户的注册表中设置。\\n    - 如果已设置，则用户已投过票。\\n4. **使用位运算(bitwise )OR 记录投票**\\n    \\n    ```solidity\\n    \\n    voterRegistry[msg.sender] = voterData | mask;\\n    ```\\n    \\n    - 位运算OR 将位置 `proposalId` 处的位设置为 `1`，标记投票。\\n5. **增加投票计数**\\n    \\n    ```solidity\\n    \\n    proposals[proposalId].voteCount++;\\n    proposalVoterCount[proposalId]++;\\n    ```\\n    \\n6. **触发投票事件**\\n    \\n    ```solidity\\n    \\n    emit Voted(msg.sender, proposalId);\\n    ```\\n    \\n\\n---\\n\\n## ✅ 函数 3：`executeProposal`\\n\\n```solidity\\n  \\nfunction executeProposal(uint8 proposalId) external {\\n    require(proposalId < proposalCount, \\\"Invalid proposal\\\");\\n    require(block.timestamp > proposals[proposalId].endTime, \\\"Voting not ended\\\");\\n    require(!proposals[proposalId].executed, \\\"Already executed\\\");\\n\\n    proposals[proposalId].executed = true;\\n\\n    emit ProposalExecuted(proposalId);\\n}\\n```\\n\\n### 🔍 这个函数做了什么：\\n\\n- 任何人都可以**在**投票期结束后执行提案。\\n- 它确保：\\n    - 提案存在\\n    - 投票窗口已结束\\n    - 提案尚未被执行\\n\\n然后我们标记提案为已执行并触发一个事件。\\n\\n💡 **在实际应用中**，您可能会在这里添加提案的执行逻辑——也许是触发付款或 DAO 配置更改。\\n\\n---\\n\\n## 👁️ 函数 4：`hasVoted`\\n\\n```solidity\\n  \\nfunction hasVoted(address voter, uint8 proposalId) external view returns (bool) {\\n    return (voterRegistry[voter] & (1 << proposalId)) != 0;\\n}\\n```\\n\\n### 🔍 这个函数做了什么：\\n\\n- 创建一个像 `vote()` 函数中那样的位掩码。\\n- 检查该位是否在投票者的注册表中设置。\\n- 如果投票者已经对该提案投过票，则返回 `true`。\\n\\n> ⚡ 节省 Gas 的读取：只需一次存储访问(storage access)和一次位运算(bitwise operation)。\\n> \\n\\n---\\n\\n## 📊 函数 5：`getProposal`\\n\\n```solidity\\n  \\nfunction getProposal(uint8 proposalId) external view returns (\\n        bytes32 name,\\n        uint32 voteCount,\\n        uint32 startTime,\\n        uint32 endTime,\\n        bool executed,\\n        bool active\\n    ) {\\n        require(proposalId < proposalCount, \\\"Invalid proposal\\\");\\n\\n        Proposal storage proposal = proposals[proposalId];\\n\\n        return (\\n            proposal.name,\\n            proposal.voteCount,\\n            proposal.startTime,\\n            proposal.endTime,\\n            proposal.executed,\\n            (block.timestamp >= proposal.startTime && block.timestamp <= proposal.endTime)\\n        );\\n    }\\n```\\n\\n### 🔍 分解：\\n\\n- 检查提案是否存在。\\n- 返回其所有字段，**外加**一个额外的 `active` 标志，指示投票当前是否正在进行。\\n- 这对于 UI/UX 很有用——让前端知道是否应该显示\\\"投票\\\"按钮。\\n\\n> ✅ 高效：所有变量都很紧凑，并且该函数是 view 类型，这意味着通过 JSON-RPC / 前端调用它是不需要 Gas 费的（链下调用）。\\n> \\n\\n## 🧵 总结\\n\\n我们从一个简单、初学者风格的投票合约开始——它简单、可读，但对 Gas 不太友好。然后我们从头开始重建它，心中只有一个目标：**效率**。\\n\\n通过切换到固定大小的类型、使用映射而非数组，并将投票历史打包到位图（bitmaps）中，我们**在不损失任何核心功能的情况下**大幅减少了合约的 Gas 占用。\\n\\n本课不仅仅是关于编写一个更好的投票合约。它是关于学习如何**像一个编写真实、可扩展应用程序的 Solidity 开发者一样思考**——这些应用程序要考虑到链上的成本、性能和用户体验。\\n\\n因为在智能合约的世界里，Gas 不仅仅是一个技术细节——它是可用与过于昂贵而无人问津之间的区别。\\n\\n所以这是您的下一步：\\n\\n✅ 重新审视您过去的合约\\n\\n✅ 寻找可以优化的地方\\n\\n✅ 问自己——*我真的需要在这里使用 string 吗？* *我需要一个动态数组吗？*\\n\\n✅ 开始以位、字节和存储槽来思考\\n\\n因为*编写 Solidity 是一回事。编写节省 Gas 的 Solidity 呢？*\\n\\n那就是您升级的时候了。";
            const embeddedMarkdown = JSON.parse('"' + embeddedMarkdownJsonString + '"');
            
            // 加载并渲染Markdown
            function loadMarkdown() {
                // 使用marked.js渲染Markdown
                if (typeof marked !== 'undefined') {
                    const html = marked.parse(embeddedMarkdown);
                    markdownContainer.innerHTML = html;
                    
                    // 等待DOM更新后重新高亮代码块
                    setTimeout(function() {
                        // 查找所有代码块并高亮
                        markdownContainer.querySelectorAll('pre code').forEach(function(block) {
                            hljs.highlightElement(block);
                        });
                    }, 100);
                } else {
                    markdownContainer.innerHTML = '<pre>' + embeddedMarkdown + '</pre>';
                }
            }
            
            // 页面加载时立即加载Markdown
            loadMarkdown();
            
            // 点击信封打开弹窗
            envelopeContainer.addEventListener('click', function() {
                envelopeContainer.classList.add('open');
                
                // 延迟显示弹窗，让信封翻转动画完成
                setTimeout(function() {
                    answerModal.style.display = 'flex';
                    setTimeout(function() {
                        answerModal.classList.add('open');
                    }, 50);
                }, 400);
            });
            
            // 关闭弹窗
            closeLetter.addEventListener('click', function() {
                answerModal.classList.remove('open');
                
                setTimeout(function() {
                    answerModal.style.display = 'none';
                    envelopeContainer.classList.remove('open');
                }, 600);
            });
            
            // 点击弹窗外部关闭
            answerModal.addEventListener('click', function(e) {
                if (e.target === answerModal) {
                    closeLetter.click();
                }
            });
        });
    </script>
</body>
</html>