<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Marketplace - Solidityå­¦ä¹ </title>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Reenie+Beanie&family=Comic+Neue:ital,wght@0,400;0,700;1,400&family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --easy: #43AA8B;
            --medium: #F8961E;
            --hard: #E71D36;
            --expert: #7209B7;
            --warm-brown: #8B7355;
            --parchment: #F5F1E6;
            --vintage-blue: #6B8E9F;
            --warm-red: #C44536;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
            color: var(--dark);
            line-height: 1.8;
            background-image: radial-gradient(#d0e3ff 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .nav-bar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-btn:hover {
            background: var(--secondary);
            transform: translateX(-3px);
        }
        
        .nav-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            color: var(--secondary);
        }
        
        .nav-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 8px;
            font-family: 'Comic Neue', cursive;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .hero-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-top: 5px solid var(--accent);
        }
        
        .hero-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .hero-title {
            flex: 1;
            min-width: 250px;
        }
        
        .day-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 20px;
            border-radius: 15px;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        h1 {
            font-family: 'Gochi Hand', cursive;
            font-size: 2.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .meta-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .difficulty-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
            font-size: 1rem;
        }
        
        .tag {
            background: var(--light);
            padding: 5px 15px;
            border-radius: 15px;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px dashed var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .key-point {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--accent);
        }
        
        .key-point-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .concept-card {
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
            border-left: 5px solid var(--hard);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .concept-card.important {
            background: linear-gradient(135deg, #fff9e6, #ffedd5);
            border-left-color: var(--medium);
        }
        
        .concept-card.tip {
            background: linear-gradient(135deg, #e6f7ff, #d6f0ff);
            border-left-color: var(--primary);
        }
        
        .concept-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.4rem;
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        pre {
            background: #282c34;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        
        code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
        }
        
        .inline-code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Fira Code', monospace;
            color: var(--hard);
            font-size: 0.9em;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .warning-box strong {
            color: #ff6b35;
        }
        
        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .comparison-table tr:hover {
            background: #f8f9fa;
        }
        
        .steps-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }
        
        .steps-list li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding-left: 60px;
            position: relative;
        }
        
        .steps-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: var(--accent);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.2rem;
        }
        
        .navigation-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-footer-btn {
            flex: 1;
            min-width: 200px;
            background: white;
            border: 3px solid var(--primary);
            padding: 20px;
            border-radius: 15px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .nav-footer-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .nav-footer-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .nav-footer-title {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
        }        
        /* å‚è€ƒç­”æ¡ˆæ¨¡å—æ ·å¼ - æ¸©æš–æ²»æ„ˆé£æ ¼ */
        .answer-reference {
            position: relative;
            margin: 60px 0 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .envelope-container {
            position: relative;
            width: 340px;
            height: 240px;
            cursor: pointer;
            perspective: 1200px;
            margin-bottom: 20px;
            filter: drop-shadow(0 10px 20px rgba(139, 115, 85, 0.2));
        }
        
        .envelope {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .envelope-front, .envelope-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .envelope-front {
            background: linear-gradient(135deg, #f9f3e9, #e8dfd1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #d4c9b8;
        }
        
        .envelope-flap {
            position: absolute;
            top: -70px;
            width: 0;
            height: 0;
            border-left: 170px solid transparent;
            border-right: 170px solid transparent;
            border-bottom: 70px solid #e8dfd1;
            z-index: 1;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
        }
        
        .envelope-flap::after {
            content: "";
            position: absolute;
            top: 3px;
            left: -170px;
            width: 0;
            height: 0;
            border-left: 170px solid transparent;
            border-right: 170px solid transparent;
            border-bottom: 67px solid #f9f3e9;
        }
        
        .envelope-seal {
            position: absolute;
            bottom: 25px;
            right: 35px;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle at 30% 30%, #C44536, #8B2E24);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2;
            border: 2px solid #A52A2A;
        }
        
        .seal-icon {
            color: #F5F1E6;
            font-size: 1.8rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .envelope-text {
            font-family: 'Reenie Beanie', cursive;
            font-size: 2.4rem;
            color: var(--warm-brown);
            z-index: 2;
            position: relative;
            margin-top: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }
        
        .envelope-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(139, 115, 85, 0.05) 3px, transparent 3px),
                radial-gradient(circle at 85% 75%, rgba(139, 115, 85, 0.05) 3px, transparent 3px);
            background-size: 40px 40px;
            z-index: 0;
        }
        
        .envelope-back {
            background: linear-gradient(135deg, #f5f1e6, #e8dfd1);
            transform: rotateY(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d4c9b8;
        }
        
        .envelope-container:hover .envelope {
            transform: rotateY(10deg) translateY(-5px);
        }
        
        .envelope-container.open .envelope {
            transform: rotateY(180deg);
        }
        
        .envelope-hint {
            font-family: 'Gochi Hand', cursive;
            font-size: 1.3rem;
            color: var(--warm-brown);
            margin-top: 15px;
            opacity: 0.9;
            background: rgba(245, 241, 230, 0.7);
            padding: 8px 20px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        /* å¼¹çª—æ ·å¼ */
        .answer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            background: rgba(107, 142, 159, 0.7);
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(3px);
        }
        
        .letter-container {
            width: 90%;
            max-width: 900px;
            height: 80vh;
            background: #F5F1E6;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(107, 142, 159, 0.4);
            overflow: hidden;
            transform: scale(0);
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #d4c9b8;
        }
        
        .answer-modal.open .letter-container {
            transform: scale(1);
        }
        
        .letter-header {
            background: linear-gradient(135deg, #8B7355, #6B5A45);
            padding: 25px 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-bottom: 2px dashed #A5947A;
        }
        
        .letter-title {
            font-family: 'Reenie Beanie', cursive;
            font-size: 3rem;
            color: #F5F1E6;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            letter-spacing: 2px;
        }
        
        .letter-subtitle {
            color: rgba(245, 241, 230, 0.9);
            font-size: 1.3rem;
            font-family: 'Gochi Hand', cursive;
        }
        
        .close-letter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(245, 241, 230, 0.2);
            color: #F5F1E6;
            border: 1px solid rgba(245, 241, 230, 0.3);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .close-letter:hover {
            background: rgba(245, 241, 230, 0.3);
            transform: rotate(90deg);
        }
        
        .letter-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #F5F1E6;
            position: relative;
        }
        
        .letter-body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background-image: 
                linear-gradient(90deg, transparent 98%, rgba(139, 115, 85, 0.1) 98%),
                linear-gradient(rgba(139, 115, 85, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }
        
        /* MDå†…å®¹æ ·å¼ */
        .md-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .md-section {
            margin-bottom: 40px;
        }
        
        .md-section h1 {
            font-family: 'Reenie Beanie', cursive;
            font-size: 3rem;
            color: var(--warm-brown);
            margin-bottom: 20px;
            border-bottom: 2px dashed #A5947A;
            padding-bottom: 10px;
            text-align: center;
        }
        
        .md-section h2 {
            font-family: 'Reenie Beanie', cursive;
            font-size: 2.2rem;
            color: var(--warm-brown);
            margin: 30px 0 15px 0;
            position: relative;
            padding-left: 25px;
        }
        
        .md-section h2::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            top: 0;
            color: var(--warm-red);
            font-size: 2.5rem;
        }
        
        .md-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .md-tag {
            background: rgba(139, 115, 85, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--warm-brown);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-highlight {
            background: rgba(107, 142, 159, 0.1);
            border-left: 5px solid var(--vintage-blue);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(107, 142, 159, 0.2);
        }
        
        .md-content pre {
            background: #2d2a2e;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3), 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #3a363b;
        }
        
        .md-content code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #f8f8f2;
        }
        
        .md-content .inline-code {
            background: rgba(139, 115, 85, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            color: var(--warm-brown);
            font-size: 0.9em;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-content ul, .md-content ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }
        
        .md-content li {
            margin-bottom: 8px;
            line-height: 1.7;
        }
        
        .md-content blockquote {
            border-left: 4px solid var(--vintage-blue);
            padding-left: 20px;
            margin: 20px 0;
            font-style: italic;
            color: #666;
            background: rgba(107, 142, 159, 0.05);
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .md-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-content th, .md-content td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(139, 115, 85, 0.2);
        }
        
        .md-content th {
            background: linear-gradient(135deg, var(--warm-brown), #6B5A45);
            color: #F5F1E6;
            font-weight: bold;
            font-family: 'Gochi Hand', cursive;
            font-size: 1.1rem;
        }
        
        .md-content tr:nth-child(even) {
            background: rgba(139, 115, 85, 0.05);
        }
        
        .signature {
            text-align: right;
            margin-top: 40px;
            font-family: 'Reenie Beanie', cursive;
            font-size: 2rem;
            color: var(--warm-brown);
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .hero-section {
                padding: 25px;
            }
            
            .section {
                padding: 20px;
            }
            
            .key-points {
                grid-template-columns: 1fr;
            }
            
            .envelope-container {
                width: 300px;
                height: 210px;
            }
            
            .envelope-flap {
                border-left: 150px solid transparent;
                border-right: 150px solid transparent;
                border-bottom: 60px solid #e8dfd1;
            }
            
            .envelope-flap::after {
                border-left: 150px solid transparent;
                border-right: 150px solid transparent;
                border-bottom: 57px solid #f9f3e9;
                left: -150px;
            }
            
            .envelope-text {
                font-size: 2rem;
            }
            
            .answer-modal {
                padding: 10px;
            }
            
            .letter-container {
                width: 95%;
                height: 85vh;
            }
            
            .letter-title {
                font-size: 2.2rem;
            }
            
            .md-section h1 {
                font-size: 2.2rem;
            }
            
            .md-section h2 {
                font-size: 1.8rem;
            }
        }
    </style>

        <style>
        /* éšè— mermaid æ¸²æŸ“ç»„ä»¶ */
        .md-content section.js-render-needs-enrichment,
        .md-content .js-render-enrichment-target,
        .md-content .js-render-block-actions,
        .md-content .render-container,
        .md-content .js-render-enrichment-fallback,
        .md-content details[class*="details"],
        .md-content iframe[title="File display"] {
            display: none !important;
        }
        
        /* ä¿®å¤ GitHub ä»£ç å—æ ·å¼ */
        .md-content .highlight,
        .md-content .highlight-source-solidity,
        .md-content .highlight-source-js,
        .md-content .highlight-source-javascript {
            background: #2d2a2e !important;
            border-radius: 10px;
            padding: 20px !important;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3), 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #3a363b;
        }
        
        .md-content .highlight pre,
        .md-content .highlight-source-solidity pre,
        .md-content .highlight-source-js pre {
            background: transparent !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
        }
        
        /* åŸºç¡€ä»£ç æ–‡å­—é¢œè‰² - ç¡®ä¿æ‰€æœ‰æ–‡å­—éƒ½å¯è§ */
        .md-content .highlight pre {
            color: #f8f8f2 !important;
        }
        
        .md-content .highlight code,
        .md-content .highlight pre code,
        .md-content .highlight pre span,
        .md-content .highlight pre * {
            /* Added to ensure all text in pre is visible */
            color: #f8f8f2 !important;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* ç¡®ä¿ä»£ç å—å†…æ‰€æœ‰æ–‡å­—ï¼ˆåŒ…æ‹¬æ²¡æœ‰ span åŒ…è£¹çš„æ–‡å­—ï¼‰éƒ½å¯è§ */
        .md-content .highlight pre,
        .md-content .highlight pre code {
            color: #f8f8f2 !important;
        }
        
        /* ç‰¹åˆ«å¤„ç†ä»£ç å—ä¸­çš„çº¯æ–‡æœ¬èŠ‚ç‚¹ï¼ˆæ²¡æœ‰è¢« span åŒ…è£¹çš„æ–‡å­—ï¼Œå¦‚å˜é‡åï¼‰ */
        .md-content .highlight pre {
            color: #f8f8f2 !important;
        }
        
        /* ç¡®ä¿æ‰€æœ‰ç›´æ¥æ–‡æœ¬å†…å®¹éƒ½å¯è§ - è¦†ç›–ç»§æ‰¿çš„é¢œè‰² */
        .md-content .highlight pre * {
            color: #f8f8f2 !important;
        }
        
        /* ç‰¹åˆ«å¤„ç†å˜é‡å - ç¡®ä¿æ¸…æ™°å¯è§ */
        .md-content .highlight pre span.pl-v,
        .md-content .highlight pre span.pl-en,
        .md-content .highlight pre span.pl-e {
            color: #dcdcaa !important;
            font-weight: 500 !important;
        }
        
        /* GitHub è¯­æ³•é«˜äº®ç±»é¢œè‰²ä¿®å¤ */
        .md-content .highlight [class*="pl-"] {
            color: #f8f8f2 !important; /* Default to light color */
        }
        .md-content .highlight .pl-c { /* æ³¨é‡Š */
            color: #6a9955 !important;
        }
        .md-content .highlight .pl-s, .md-content .highlight .pl-s1 { /* å­—ç¬¦ä¸² */
            color: #ce9178 !important;
        }
        .md-content .highlight .pl-k, .md-content .highlight .pl-c1 { /* å…³é”®å­—/å¸¸é‡ */
            color: #569cd6 !important;
        }
        .md-content .highlight .pl-v, .md-content .highlight .pl-en, .md-content .highlight .pl-e, .md-content .highlight .pl-ent { /* å˜é‡/å‡½æ•°å/å®ä½“å */
            color: #dcdcaa !important;
            font-weight: 500 !important;
        }
        .md-content code {
            background-color: rgba(139, 115, 85, 0.15);
            color: var(--warm-brown);
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
        }
        </style>
        </head>
<body>
    <div class="nav-bar">
        <div class="nav-left">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
            </a>
            <span class="nav-title">ç¬¬26å¤©</span>
        </div>
        <div class="nav-right">
            <a href="#concepts" class="nav-btn">ğŸ“š æ ¸å¿ƒæ¦‚å¿µ</a>
            <a href="#code" class="nav-btn">ğŸ’» ä»£ç è®²è§£</a>
            <a href="#practice" class="nav-btn">ğŸ¯ ç»ƒä¹ </a>
        </div>
    </div>

    <div class="container">
        <div class="hero-section">
            <div class="hero-header">
                <div class="hero-title">
                    <div class="day-badge">ç¬¬ 26 å¤©</div>
                    <h1>ğŸ›’ NFT Marketplace</h1>
                    <p class="subtitle">å®Œæ•´é“¾ä¸ŠNFTå¸‚åœº - æŒ‚å•ã€è´­ä¹°ã€ç‰ˆç¨ä¸æ‰‹ç»­è´¹åˆ†é…</p>
                </div>
                <div class="meta-tags">
                    <div class="difficulty-badge" style="background: var(--hard);">
                        â­â­â­â­ å›°éš¾
                    </div>
                    <span class="tag">NFTäº¤æ˜“</span>
                    <span class="tag">è´¹ç”¨åˆ†é…</span>
                    <span class="tag">ReentrancyGuard</span>
                    <span class="tag">IERC721æ¥å£</span>
                </div>
            </div>
            
            <div class="key-points">
                <div class="key-point">
                    <div class="key-point-title">ğŸ¯ å­¦ä¹ ç›®æ ‡</div>
                    <div>æ„å»ºå®Œæ•´çš„é“¾ä¸ŠNFTäº¤æ˜“å¸‚åœºï¼ŒæŒæ¡è´¹ç”¨åˆ†é…å’Œå®‰å…¨æœºåˆ¶</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ› ï¸ æ ¸å¿ƒæŠ€èƒ½</div>
                    <div>IERC721æ¥å£ã€ReentrancyGuardã€è´¹ç”¨è®¡ç®—ã€äº‹ä»¶è®°å½•</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">â° é¢„è®¡æ—¶é—´</div>
                    <div>3-4å°æ—¶ (ç†è§£+ç¼–ç +æµ‹è¯•)</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ“Š ä¸»è§‚æ„Ÿå—éš¾åº¦</div>
                    <div>â­â­â­â­â­ æéš¾ - å¤æ‚çš„è´¹ç”¨åˆ†é…é€»è¾‘å’Œå¤šé‡å®‰å…¨è€ƒè™‘</div>
                </div>
            </div>
            
            <div class="key-points" style="margin-top: 20px;">
                <div class="key-point">
                    <div class="key-point-title">ğŸª æŒ‚å•ç³»ç»Ÿ</div>
                    <div>æ”¯æŒè‡ªå®šä¹‰ä»·æ ¼å’Œç‰ˆç¨æŒ‚å•NFT</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ’° ä¸‰å±‚è´¹ç”¨åˆ†é…</div>
                    <div>å¹³å°æ‰‹ç»­è´¹ + åˆ›ä½œè€…ç‰ˆç¨ + å–å®¶æ”¶ç›Š</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶</div>
                    <div>ReentrancyGuardé˜²é‡å…¥æ”»å‡»</div>
                </div>
                <div class="key-point">
                    <div class="key-point-title">ğŸ”— æ ‡å‡†é›†æˆ</div>
                    <div>é€šè¿‡IERC721æ¥å£ä¸ä»»ä½•NFTåˆçº¦äº¤äº’</div>
                </div>
            </div>
        </div>

        <div class="section" id="concepts">
            <h2 class="section-title">
                <i class="fas fa-lightbulb"></i> æ ¸å¿ƒæ¦‚å¿µ
            </h2>
            
            <div class="concept-card important">
                <div class="concept-title">ğŸ¯ NFTå¸‚åœºå·¥ä½œæµç¨‹</div>
                <ul class="steps-list">
                    <li>
                        <strong>å–å®¶æŒ‚å•</strong><br>
                        æˆæƒå¸‚åœºåˆçº¦æ“ä½œNFT,è®¾ç½®ä»·æ ¼å’Œç‰ˆç¨æ¯”ä¾‹
                    </li>
                    <li>
                        <strong>ä¹°å®¶è´­ä¹°</strong><br>
                        å‘é€ETH,å¸‚åœºåˆçº¦è½¬ç§»NFTå¹¶åˆ†é…èµ„é‡‘
                    </li>
                    <li>
                        <strong>è´¹ç”¨åˆ†é…</strong><br>
                        å¹³å°æŠ½å–æ‰‹ç»­è´¹,åˆ›ä½œè€…è·å¾—ç‰ˆç¨,å–å®¶è·å¾—å‰©ä½™é‡‘é¢
                    </li>
                    <li>
                        <strong>å–æ¶ˆæŒ‚å•</strong><br>
                        å–å®¶å¯éšæ—¶å–æ¶ˆæœªå”®å‡ºçš„æŒ‚å•
                    </li>
                </ul>
            </div>

            <div class="concept-card tip">
                <div class="concept-title">ğŸ’¸ è´¹ç”¨åˆ†é…æœºåˆ¶</div>
                <p><strong>ç¤ºä¾‹:</strong> NFTå”®ä»· 100 ETH</p>
                <pre style="background: #f8f9fa; color: #333; padding: 15px;">æ€»ä»· = 100 ETH
â”œâ”€ å¹³å°è´¹ (2%) = 2 ETH â†’ å¹³å°
â”œâ”€ ç‰ˆç¨ (10%) = 10 ETH â†’ å–å®¶(åˆ›ä½œè€…)
â””â”€ å–å®¶æ”¶å…¥ = 88 ETH â†’ å–å®¶</pre>
                <div class="success-box" style="margin-top: 15px;">
                    <strong>âœ… å…¬å¼:</strong><br>
                    å–å®¶æ”¶å…¥ = æ€»ä»· - (æ€»ä»· Ã— å¹³å°è´¹ç‡) - (æ€»ä»· Ã— ç‰ˆç¨è´¹ç‡)
                </div>
            </div>

            <div class="concept-card">
                <div class="concept-title">ğŸ”‘ ListingID ç”Ÿæˆæœºåˆ¶</div>
                <p>ä½¿ç”¨keccak256å“ˆå¸Œç¡®ä¿æ¯ä¸ªæŒ‚å•çš„å”¯ä¸€æ€§:</p>
                <pre><code class="language-solidity">bytes32 listingId = keccak256(abi.encodePacked(
    nftContract,  // NFTåˆçº¦åœ°å€
    tokenId,      // NFTçš„ID
    seller        // å–å®¶åœ°å€
));</code></pre>
                <p style="margin-top: 10px;">è¿™æ ·å³ä½¿åŒä¸€ä¸ªNFTè¢«å¤šæ¬¡æŒ‚å•,æ¯æ¬¡çš„listingIdä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚</p>
            </div>

            <div class="concept-card important">
                <div class="concept-title">ğŸ›¡ï¸ å®‰å…¨æªæ–½</div>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>å®‰å…¨ç‰¹æ€§</th>
                            <th>å®ç°æ–¹å¼</th>
                            <th>é˜²èŒƒé£é™©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ReentrancyGuard</strong></td>
                            <td>nonReentrantä¿®é¥°ç¬¦</td>
                            <td>é˜²æ­¢é‡å…¥æ”»å‡»</td>
                        </tr>
                        <tr>
                            <td><strong>è´­ä¹°å‰åˆ é™¤æŒ‚å•</strong></td>
                            <td>delete listings[listingId]</td>
                            <td>é˜²æ­¢åŒé‡æ¶ˆè´¹</td>
                        </tr>
                        <tr>
                            <td><strong>æ‰€æœ‰æƒæ£€æŸ¥</strong></td>
                            <td>nft.ownerOf(tokenId)</td>
                            <td>éªŒè¯å–å®¶æ‹¥æœ‰NFT</td>
                        </tr>
                        <tr>
                            <td><strong>æ‰¹å‡†æ£€æŸ¥</strong></td>
                            <td>getApproved/isApprovedForAll</td>
                            <td>ç¡®ä¿å¸‚åœºå¯è½¬ç§»NFT</td>
                        </tr>
                        <tr>
                            <td><strong>ä»·æ ¼éªŒè¯</strong></td>
                            <td>require(msg.value == price)</td>
                            <td>ç¡®ä¿ä»˜æ¬¾é‡‘é¢æ­£ç¡®</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section" id="code">
            <h2 class="section-title">
                <i class="fas fa-code"></i> ä»£ç è¯¦è§£
            </h2>

            <h3 style="color: var(--primary); margin: 20px 0;">1ï¸âƒ£ çŠ¶æ€å˜é‡ä¸æ•°æ®ç»“æ„</h3>
            <pre><code class="language-solidity">address public owner;
uint256 public marketplaceFeePercent;
address public feeRecipient;

struct Listing {
    address seller;
    address nftContract;
    uint256 tokenId;
    uint256 price;
    uint256 royaltyPercent;
}

mapping(bytes32 => Listing) public listings;</code></pre>

            <h3 style="color: var(--primary); margin: 20px 0;">2ï¸âƒ£ æŒ‚å•NFT</h3>
            <pre><code class="language-solidity">function listNFT(
    address nftContract,
    uint256 tokenId,
    uint256 price,
    uint256 royaltyPercent
) external {
    require(price > 0, "Price must be > 0");
    require(royaltyPercent <= 100, "Royalty too high");
    
    // éªŒè¯æ‰€æœ‰æƒ
    IERC721 nft = IERC721(nftContract);
    require(nft.ownerOf(tokenId) == msg.sender, "Not owner");
    
    // éªŒè¯æ‰¹å‡†
    require(
        nft.getApproved(tokenId) == address(this) || 
        nft.isApprovedForAll(msg.sender, address(this)),
        "Not approved"
    );
    
    // ç”Ÿæˆå”¯ä¸€ID
    bytes32 listingId = keccak256(abi.encodePacked(nftContract, tokenId, msg.sender));
    
    // ä¿å­˜æŒ‚å•
    listings[listingId] = Listing({
        seller: msg.sender,
        nftContract: nftContract,
        tokenId: tokenId,
        price: price,
        royaltyPercent: royaltyPercent
    });
    
    emit Listed(listingId, msg.sender, nftContract, tokenId, price, royaltyPercent);
}</code></pre>
            <div class="warning-box">
                <strong>âš ï¸ é‡è¦:</strong> å–å®¶å¿…é¡»å…ˆè°ƒç”¨NFTåˆçº¦çš„ <code class="inline-code">approve()</code> æˆ– <code class="inline-code">setApprovalForAll()</code> æˆæƒå¸‚åœºåˆçº¦!
            </div>

            <h3 style="color: var(--primary); margin: 20px 0;">3ï¸âƒ£ è´­ä¹°NFT</h3>
            <pre><code class="language-solidity">function buyNFT(bytes32 listingId) external payable nonReentrant {
    Listing memory listing = listings[listingId];
    require(listing.price > 0, "Not listed");
    require(msg.value == listing.price, "Incorrect price");
    
    // å…ˆåˆ é™¤æŒ‚å•(é˜²æ­¢é‡å…¥)
    delete listings[listingId];
    
    // è®¡ç®—è´¹ç”¨åˆ†é…
    uint256 marketplaceFee = (listing.price * marketplaceFeePercent) / 100;
    uint256 royaltyFee = (listing.price * listing.royaltyPercent) / 100;
    uint256 sellerProceeds = listing.price - marketplaceFee - royaltyFee;
    
    // è½¬ç§»NFT
    IERC721(listing.nftContract).transferFrom(
        listing.seller,
        msg.sender,
        listing.tokenId
    );
    
    // åˆ†é…ä»˜æ¬¾
    if (marketplaceFee > 0) {
        payable(feeRecipient).transfer(marketplaceFee);
    }
    
    if (royaltyFee > 0) {
        payable(listing.seller).transfer(royaltyFee);
    }
    
    payable(listing.seller).transfer(sellerProceeds);
    
    emit Purchase(listingId, msg.sender, listing.seller, listing.price);
}</code></pre>

            <div class="concept-card tip">
                <div class="concept-title">ğŸ’¡ ä¸ºä»€ä¹ˆå…ˆåˆ é™¤æŒ‚å•?</div>
                <p>åœ¨CEIæ¨¡å¼(Checks-Effects-Interactions)ä¸­:</p>
                <ol style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Checks:</strong> requireéªŒè¯</li>
                    <li><strong>Effects:</strong> ä¿®æ”¹çŠ¶æ€(delete listings)</li>
                    <li><strong>Interactions:</strong> å¤–éƒ¨è°ƒç”¨(transfer)</li>
                </ol>
                <p style="margin-top: 10px;">å…ˆä¿®æ”¹çŠ¶æ€å¯é˜²æ­¢é‡å…¥æ”»å‡»!</p>
            </div>

            <h3 style="color: var(--primary); margin: 20px 0;">4ï¸âƒ£ å–æ¶ˆæŒ‚å•</h3>
            <pre><code class="language-solidity">function cancelListing(bytes32 listingId) external {
    Listing memory listing = listings[listingId];
    require(listing.seller == msg.sender, "Not seller");
    
    delete listings[listingId];
    emit Unlisted(listingId);
}</code></pre>

            <h3 style="color: var(--primary); margin: 20px 0;">5ï¸âƒ£ ç®¡ç†å‡½æ•°</h3>
            <pre><code class="language-solidity">function setMarketplaceFeePercent(uint256 _newFeePercent) external onlyOwner {
    require(_newFeePercent <= 100, "Fee too high");
    marketplaceFeePercent = _newFeePercent;
    emit FeeUpdated(_newFeePercent);
}

function setFeeRecipient(address _newRecipient) external onlyOwner {
    require(_newRecipient != address(0), "Invalid address");
    feeRecipient = _newRecipient;
}</code></pre>

            <h3 style="color: var(--primary); margin: 20px 0;">6ï¸âƒ£ Fallback å‡½æ•°</h3>
            <pre><code class="language-solidity">receive() external payable {
    revert("Direct payments not accepted");
}

fallback() external payable {
    revert("Invalid function call");
}</code></pre>
            <div class="warning-box">
                <strong>âš ï¸ å®‰å…¨è®¾è®¡:</strong> æ‹’ç»ç›´æ¥å‘é€ETH,æ‰€æœ‰äº¤æ˜“å¿…é¡»é€šè¿‡ <code class="inline-code">buyNFT()</code> è¿›è¡Œ!
            </div>
        </div>

        <div class="section" id="practice">
            <h2 class="section-title">
                <i class="fas fa-dumbbell"></i> å®è·µè¦ç‚¹
            </h2>

            <div class="concept-card important">
                <div class="concept-title">ğŸ¯ å…³é”®çŸ¥è¯†ç‚¹</div>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>IERC721æ¥å£ä½¿ç”¨:</strong> é€šè¿‡æ¥å£ä¸ä»»ä½•ERC-721åˆçº¦äº¤äº’</li>
                    <li><strong>æ‰¹å‡†æµç¨‹:</strong> ç†è§£approve vs setApprovalForAllçš„åŒºåˆ«</li>
                    <li><strong>è´¹ç”¨è®¡ç®—:</strong> æŒæ¡ç™¾åˆ†æ¯”è®¡ç®—å’Œæ•´æ•°é™¤æ³•</li>
                    <li><strong>é‡å…¥é˜²æŠ¤:</strong> ä½¿ç”¨nonReentrantå’ŒCEIæ¨¡å¼</li>
                    <li><strong>äº‹ä»¶è®°å½•:</strong> ç”¨äº‹ä»¶è¿½è¸ªæ‰€æœ‰é‡è¦æ“ä½œ</li>
                </ul>
            </div>

            <div class="concept-card tip">
                <div class="concept-title">ğŸ’ª ç»ƒä¹ ä»»åŠ¡</div>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li>æ·»åŠ å‡ºä»·(offer)åŠŸèƒ½,å…è®¸ä¹°å®¶å‡ºä»·ä½äºæŒ‚å•ä»·</li>
                    <li>å®ç°æ‹å–åŠŸèƒ½,æ”¯æŒè‹±å¼æ‹å–å’Œè·å…°å¼æ‹å–</li>
                    <li>æ·»åŠ æ‰¹é‡è´­ä¹°åŠŸèƒ½</li>
                    <li>å®ç°ERC-2981ç‰ˆç¨æ ‡å‡†é›†æˆ</li>
                    <li>æ·»åŠ ç™½åå•åŠŸèƒ½,åªå…è®¸ç‰¹å®šNFTåˆçº¦</li>
                </ol>
            </div>

            <div class="concept-card">
                <div class="concept-title">ğŸš€ æ‰©å±•æ–¹å‘</div>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>åŠŸèƒ½</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>æ”¯æŒERC-1155</strong></td>
                            <td>åŠåŒè´¨åŒ–ä»£å¸,æ”¯æŒæ‰¹é‡äº¤æ˜“</td>
                        </tr>
                        <tr>
                            <td><strong>è·¨é“¾æ¡¥æ¥</strong></td>
                            <td>æ”¯æŒå¤šé“¾NFTäº¤æ˜“</td>
                        </tr>
                        <tr>
                            <td><strong>ç§ŸèµåŠŸèƒ½</strong></td>
                            <td>NFTæ—¶é—´ç§Ÿèµ</td>
                        </tr>
                        <tr>
                            <td><strong>ç¢ç‰‡åŒ–</strong></td>
                            <td>å°†æ˜‚è´µNFTåˆ†å‰²ä¸ºå¤šä»½</td>
                        </tr>
                        <tr>
                            <td><strong>å…ƒæ•°æ®ç¼“å­˜</strong></td>
                            <td>é“¾ä¸‹ç´¢å¼•åŠ é€ŸæŸ¥è¯¢</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="success-box">
                <strong>âœ… å®Œæˆæ ‡å¿—:</strong> ä½ å·²æŒæ¡NFTå¸‚åœºåˆçº¦çš„æ ¸å¿ƒæœºåˆ¶!è¿™æ˜¯OpenSeaã€Blurç­‰ä¸»æµå¸‚åœºçš„åŸºç¡€å®ç°ã€‚
            </div>
        </div>

        <div class="navigation-footer">
            <a href="contract-25.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">â† ä¸Šä¸€ä¸ª</div>
                <div class="nav-footer-title">AMM - è‡ªåŠ¨åšå¸‚å•†</div>
            </a>
            <a href="contract-27.html" class="nav-footer-btn" style="border-color: var(--accent);">
                <div class="nav-footer-label">ä¸‹ä¸€ä¸ª â†’</div>
                <div class="nav-footer-title">YieldFarming - æ”¶ç›Šå†œåœº</div>
            </a>
        </div>
    
        <!-- Snehaçš„ä¸€å°æ¥ä¿¡æ¨¡å— -->
        <div class="answer-reference">
            <div class="envelope-container" id="envelope-container">
                <div class="envelope">
                    <div class="envelope-front">
                        <div class="envelope-flap"></div>
                        <div class="envelope-pattern"></div>
                        <div class="envelope-seal">
                            <i class="fas fa-feather-alt seal-icon"></i>
                        </div>
                        <div class="envelope-text">Snehaçš„ä¸€å°æ¥ä¿¡</div>
                    </div>
                    <div class="envelope-back">
                        <div class="envelope-text" style="color: var(--warm-brown);">ç‚¹å‡»å¼€å¯</div>
                    </div>
                </div>
            </div>
            <div class="envelope-hint">ç‚¹å‡»ä¿¡å°æŸ¥çœ‹Snehaçš„æ¥ä¿¡</div>
        </div>
    </div>

    <!-- å¼¹çª— - å†…å®¹å¾…åç»­ç²¾ç»†åŒ–å¤„ç† -->
    <div class="answer-modal" id="answer-modal">
        <div class="letter-container">
            <div class="letter-header">
                <div class="letter-title">Snehaçš„ä¸€å°æ¥ä¿¡</div>
                <div class="letter-subtitle">å…³äºç¬¬26å¤©çš„å­¦ä¹ æŒ‡å¯¼</div>
                <button id="close-letter" class="close-letter">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="letter-body">
                <div id="md-content" class="md-content">
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">NFTå¸‚åœºåˆçº¦å­¦ä¹ å†…å®¹</h1></div>
<p dir="auto">Day: Day 26
ID: 26
è¯‘è€…: Bala Chen
éš¾åº¦ç­‰çº§: é«˜çº§</p>
<p dir="auto">å˜¿å˜¿ï¼Œæ¬¢è¿å›åˆ°<strong>30å¤©Solidityå­¦ä¹ </strong>â€”â€”æ¯å¤©ï¼Œä½ ä¸ä»…é€šè¿‡é˜…è¯»æ™ºèƒ½åˆçº¦çš„å·¥ä½œåŸç†æ¥å‡çº§ï¼Œè€Œæ˜¯é€šè¿‡å®é™…æ„å»ºæ„Ÿè§‰åƒçœŸå®ä¸–ç•Œåº”ç”¨çš„ä¸œè¥¿ã€‚</p>
<p dir="auto">ä»Šå¤©ï¼Œæˆ‘ä»¬ä»<strong>é“¸é€ NFT</strong>è½¬å‘<strong>å°†å®ƒä»¬è´§å¸åŒ–</strong>ã€‚</p>
<p dir="auto">è¿™ä¸ä»…ä»…æ˜¯ç»ƒä¹ ã€‚</p>
<p dir="auto">è¿™æ˜¯ä½ æ„å»ºçœŸå®äº§å“çš„ç¬¬ä¸€æ­¥ã€‚</p>
<p dir="auto">å¯ä»¥åœ¨ä¸»ç½‘ä¸Šè¿è¡Œçš„ä¸œè¥¿ã€‚ä½ æœ€å–œæ¬¢çš„NFTè‰ºæœ¯å®¶å¯ä»¥ç”¨æ¥åˆ—å‡ºä»–ä»¬ä½œå“çš„ä¸œè¥¿ã€‚</p>
<p dir="auto">ä»Šå¤©...</p>
<p dir="auto">ä½ æ­£åœ¨æ„å»ºè‡ªå·±çš„<strong>NFTå¸‚åœº</strong>ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ›ï¸ è®©æˆ‘ä»¬è°ˆè°ˆå¸‚åœº</h3></div>
<p dir="auto">æƒ³æƒ³ä½ æœ€å–œæ¬¢çš„åœ¨çº¿å¸‚åœºâ€”â€”ä¹Ÿè®¸æ˜¯OpenSeaï¼Œä¹Ÿè®¸æ˜¯æ·˜å®ï¼Œä¹Ÿè®¸æ˜¯ä½ é™„è¿‘çš„è·³èš¤å¸‚åœºã€‚</p>
<p dir="auto">æ€»æ˜¯æœ‰ç›¸åŒçš„3ä¸ªè§’è‰²ï¼š</p>
<ul dir="auto">
<li>æœ‰äºº<strong>å‡ºå”®</strong>æœ‰ä»·å€¼çš„ä¸œè¥¿</li>
<li>æœ‰äºº<strong>è´­ä¹°</strong>å®ƒ</li>
<li>ä¸­é—´æœ‰ä¸€ä¸ªå¹³å°å¤„ç†äº¤æ˜“ï¼ŒæŠ½å–ä½£é‡‘ï¼Œå¹¶ç§»åŠ¨å•†å“</li>
</ul>
<p dir="auto">ç°åœ¨æŠŠè¿™ä¸ªæƒ³æ³•â€”â€”å®Œå…¨æ”¾åœ¨é“¾ä¸Šã€‚</p>
<p dir="auto">æ²¡æœ‰ä¸­é—´äººã€‚æ²¡æœ‰åç«¯ã€‚æ²¡æœ‰äººé˜»æŒ¡é“è·¯ã€‚</p>
<p dir="auto">åªæ˜¯ä¸€ä¸ªæ™ºèƒ½åˆçº¦ï¼š</p>
<ul dir="auto">
<li>åˆ—å‡ºNFT</li>
<li>å¤„ç†ETHæ”¯ä»˜</li>
<li>æ”¯ä»˜ç»™å–å®¶ã€å¹³å°ï¼Œç”šè‡³åŸåˆ›è€…â€”â€”<strong>è‡ªåŠ¨åœ°</strong></li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  ä¸ºä»€ä¹ˆè¿™ä¸ªé¡¹ç›®å¾ˆé‡è¦</h3></div>
<p dir="auto">NFTå¸‚åœºæ˜¯ä¸€åˆ‡æ±‡èšçš„åœ°æ–¹ï¼š</p>
<ul dir="auto">
<li>ERC721é€»è¾‘ âœ…</li>
<li>å®‰å…¨çš„ETHè½¬è´¦ âœ…</li>
<li>åˆ›ä½œè€…ç‰ˆç¨ âœ…</li>
<li>è´¹ç”¨åˆ†é… âœ…</li>
<li>é‡å…¥ä¿æŠ¤ âœ…</li>
<li>æ‰€æœ‰æƒ+æ‰¹å‡†æµç¨‹ âœ…</li>
</ul>
<p dir="auto">è¿™æ˜¯å±•ç¤ºçœŸå®ä¸–ç•Œé‡ŒWeb3åº”ç”¨å¦‚ä½•åœ¨åº•å±‚å·¥ä½œçš„åˆçº¦ç±»å‹ã€‚</p>
<p dir="auto">å½“ä½ æ„å»ºè¿™ä¸ªæ—¶...ä½ ä¸ä»…ä»…æ˜¯åœ¨å¤åˆ¶OpenSeaã€‚</p>
<p dir="auto">ä½ åœ¨ç†è§£å®ƒâ€”â€”å¹¶åˆ›å»ºä½ è‡ªå·±çš„ç²¾ç®€ç‰ˆã€ä¸è‡ƒè‚¿ç‰ˆæœ¬ã€‚</p>
<p dir="auto">ä¸€ä¸ª<strong>ä½ æ§åˆ¶</strong>çš„ç‰ˆæœ¬ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§¾ ä½ ä»Šå¤©å°†å­¦åˆ°ä»€ä¹ˆ</h3></div>
<ul dir="auto">
<li>å¦‚ä½•<strong>åˆ—å‡º</strong>å¸¦æœ‰è‡ªå®šä¹‰ä»·æ ¼å’Œå¯é€‰ç‰ˆç¨çš„NFT</li>
<li>å¦‚ä½•ä½¿ç”¨ETH<strong>è´­ä¹°</strong>NFTï¼ˆè‡ªåŠ¨åˆ†é…ç»™å–å®¶ã€åˆ›ä½œè€…å’Œå¸‚åœºï¼‰</li>
<li>å¦‚æœå–å®¶æ”¹å˜ä¸»æ„ï¼Œå¦‚ä½•<strong>å–æ¶ˆåˆ—å‡º</strong>NFT</li>
<li>å¦‚ä½•ä½¿ç”¨<code>ReentrancyGuard</code><strong>ä¿æŠ¤</strong>ä¸€åˆ‡</li>
<li>ä»¥åŠå¦‚ä½•ä½œä¸ºåˆçº¦æ‰€æœ‰è€…<strong>è·Ÿè¸ªå’Œæ›´æ–°è´¹ç”¨</strong>å¹¶æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒ</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ’¡ æ˜¯ä»€ä¹ˆè®©è¿™ä¸ªç‰¹åˆ«ï¼Ÿ</h3></div>
<p dir="auto">è¿™ä¸ªå¸‚åœºä¸ä»…è®©äººä»¬äº¤æ˜“NFTã€‚å®ƒï¼š</p>
<ul dir="auto">
<li>å°Šé‡åˆ›ä½œè€…ç‰ˆç¨</li>
<li>è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æƒ</li>
<li>ç¡®ä¿æ¯ä¸ªäººéƒ½å¾—åˆ°æ­£ç¡®çš„æŠ¥é…¬ï¼ˆå–å®¶ã€åˆ›ä½œè€…å’Œä½ ï¼ï¼‰</li>
<li>ä¸éœ€è¦<strong>åç«¯</strong>å’Œ<strong>ä¿¡ä»»</strong>â€”â€”ä¸€åˆ‡éƒ½ç”±ä»£ç æ‰§è¡Œ</li>
</ul>
<p dir="auto">ä½ ä¸æ˜¯åœ¨æ„å»ºä¸€ä¸ª<em>å‡è£…</em>åšäº‹æƒ…çš„UIã€‚</p>
<p dir="auto">ä½ åœ¨æ„å»ºå®é™…<em>åš</em>è¿™äº›äº‹æƒ…çš„åç«¯é€»è¾‘â€”â€”å®æ—¶ï¼Œåœ¨é“¾ä¸Šã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸš€ åˆ°æœ€å</h3></div>
<p dir="auto">ä½ å°†æ‹¥æœ‰ä¸€ä¸ªè‡ªåŒ…å«çš„NFTå¸‚åœºåˆçº¦ï¼Œå¯ä»¥ï¼š</p>
<ul dir="auto">
<li>åˆ—å‡ºä»»ä½•ERC-721</li>
<li>ç”¨ETHå‡ºå”®å®ƒ</li>
<li>åˆ†é…è´¹ç”¨</li>
<li>å®‰å…¨åœ°è½¬ç§»NFT</li>
<li>ç”¨äº‹ä»¶è®°å½•æ‰€æœ‰æ´»åŠ¨ï¼Œä¾›å‰ç«¯è·å–</li>
</ul>
<p dir="auto">è¿™å°±åƒä½ è‡ªå·±çš„å°OpenSeaâ€”â€”ä½†æŒ‰ä½ çš„æ¡ä»¶ã€‚</p>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">äº§å“éœ€æ±‚è¯´æ˜</h1></div>
<p dir="auto">ç”¨æˆ·æµç¨‹</p>
<p dir="auto">éœ€è¦çš„æ•°æ®ç»“æ„</p>
<markdown-accessiblity-table data-catalyst=""><table>
<thead>
<tr>
<th>â”” Function Name</th>
<th>Visibility</th>
<th>Mutability</th>
</tr>
</thead>
<tbody>
<tr>
<td>constructor</td>
<td>Public</td>
<td>ğŸ›‘</td>
</tr>
<tr>
<td>setMarketplaceFeePercent</td>
<td>External</td>
<td>âš™ï¸</td>
</tr>
<tr>
<td>setFeeRecipient</td>
<td>External</td>
<td>âš™ï¸</td>
</tr>
<tr>
<td>listNFT</td>
<td>External</td>
<td>âš™ï¸</td>
</tr>
<tr>
<td>buyNFT</td>
<td>External</td>
<td>ğŸ›‘</td>
</tr>
<tr>
<td>cancelListing</td>
<td>External</td>
<td>âš™ï¸</td>
</tr>
<tr>
<td>getListing</td>
<td>External</td>
<td>View</td>
</tr>
<tr>
<td>receive</td>
<td>External</td>
<td>ğŸ›‘</td>
</tr>
<tr>
<td>fallback</td>
<td>External</td>
<td>ğŸ›‘</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto">ç»†èŠ‚è§£è¯´</h1></div>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">ğŸ§¾ æ¦‚è¿°ï¼šè¿™ä¸ªNFTå¸‚åœºåˆçº¦å¦‚ä½•å·¥ä½œ</h2></div>
<p dir="auto">é‚£ä¹ˆæˆ‘ä»¬çœŸæ­£åœ¨æ„å»ºä»€ä¹ˆï¼Ÿ</p>
<p dir="auto">è¿™ä¸ªåˆçº¦æ˜¯ä¸€ä¸ª<strong>å®Œå…¨é“¾ä¸Šçš„NFTå¸‚åœº</strong>ï¼Œç”¨çº¯Solidityç¼–å†™ã€‚å®ƒè®©äººä»¬ï¼š</p>
<ul dir="auto">
<li><strong>åˆ—å‡ºä»–ä»¬çš„NFTå‡ºå”®</strong>ï¼Œè®¾ç½®ä»·æ ¼ç”šè‡³è‡ªå®šä¹‰ç‰ˆç¨</li>
<li>é€šè¿‡ç›´æ¥å‘åˆçº¦å‘é€ETHæ¥<strong>è´­ä¹°NFT</strong></li>
<li><strong>è‡ªåŠ¨åˆ†å‰²é”€å”®</strong>åœ¨å–å®¶ã€åˆ›ä½œè€…ï¼ˆç‰ˆç¨ï¼‰å’Œå¹³å°ï¼ˆå¸‚åœºè´¹ç”¨ï¼‰ä¹‹é—´</li>
<li>éšæ—¶<strong>å–æ¶ˆåˆ—è¡¨</strong></li>
<li>ä½œä¸ºå¸‚åœºæ‰€æœ‰è€…<strong>æ›´æ–°è´¹ç”¨è®¾ç½®</strong></li>
</ul>
<p dir="auto">æ‰€æœ‰è¿™äº›éƒ½<strong>å®‰å…¨åœ°</strong>å‘ç”Ÿï¼Œå…·æœ‰å†…ç½®ä¿æŠ¤ï¼Œå¦‚<code>ReentrancyGuard</code>æ¥é˜²æ­¢æ”»å‡»ã€‚</p>
<p dir="auto">è¿™é‡Œæ²¡æœ‰å‰ç«¯ï¼Œæ²¡æœ‰JavaScriptï¼Œæ²¡æœ‰åç«¯æ•°æ®åº“â€”â€”åªæ˜¯ä¸€ä¸ªæ™ºèƒ½åˆçº¦ï¼š</p>
<ul dir="auto">
<li>è·Ÿè¸ªæ¯ä¸ªåˆ—è¡¨</li>
<li>éªŒè¯æ¯ä¸ªNFTå’Œå–å®¶</li>
<li>æ­£ç¡®ç§»åŠ¨ETHå’ŒNFT</li>
<li>å‘å‡ºäº‹ä»¶ï¼Œä»¥ä¾¿UIå¯ä»¥è·Ÿéš</li>
</ul>
<p dir="auto">è¿™æ˜¯åƒ<strong>OpenSea</strong>å’Œ<strong>LooksRare</strong>è¿™æ ·çš„å¹³å°æ„å»ºçš„ç›¸åŒåŸºç¡€â€”â€”ä½†æ›´å¹²å‡€ã€æ›´ç®€å•ã€å¯¹åˆå­¦è€…å‹å¥½ã€‚</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">ğŸ§¾ å®Œæ•´çš„NFTå¸‚åœºåˆçº¦ä»£ç </h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c">// SPDX-License-Identifier: MIT</span>
<span class="pl-k">pragma solidity</span> <span class="pl-k">^</span><span class="pl-c1">0.8.20</span>;

<span class="pl-k">import</span> <span class="pl-s">"<span class="pl-s">@openzeppelin/contracts/token/ERC721/IERC721.sol</span>"</span>;
<span class="pl-k">import</span> <span class="pl-s">"<span class="pl-s">@openzeppelin/contracts/security/ReentrancyGuard.sol</span>"</span>;

<span class="pl-k">contract</span> <span class="pl-en">NFTMarketplace</span> <span class="pl-k">is</span> <span class="pl-en">ReentrancyGuard</span> {
    <span class="pl-c1">address</span> <span class="pl-k">public</span> owner;
    <span class="pl-c1">uint256</span> <span class="pl-k">public</span> marketplaceFeePercent; <span class="pl-c">// ä»¥åŸºç‚¹ä¸ºå•ä½ (100 = 1%)</span>
    <span class="pl-c1">address</span> <span class="pl-k">public</span> feeRecipient;

    <span class="pl-k">struct<span class="pl-en"> Listing</span></span> {
        <span class="pl-c1">address</span> seller;
        <span class="pl-c1">address</span> nftAddress;
        <span class="pl-c1">uint256</span> tokenId;
        <span class="pl-c1">uint256</span> price;
        <span class="pl-c1">address</span> royaltyReceiver;
        <span class="pl-c1">uint256</span> royaltyPercent; <span class="pl-c">// ä»¥åŸºç‚¹ä¸ºå•ä½</span>
        <span class="pl-c1">bool</span> isListed;
    }

    <span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-k">mapping</span>(<span class="pl-c1">uint256</span> <span class="pl-k">=&gt;</span> Listing)) <span class="pl-k">public</span> listings;

    <span class="pl-k">event <span class="pl-en">Listed</span></span>(
        <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">seller</span>,
        <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
        <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
        <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">royaltyPercent</span>
    );

    <span class="pl-k">event <span class="pl-en">Purchase</span></span>(
        <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">buyer</span>,
        <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
        <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
        <span class="pl-c1">address</span> <span class="pl-v">seller</span>,
        <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">royaltyAmount</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">marketplaceFeeAmount</span>
    );

    <span class="pl-k">event <span class="pl-en">Unlisted</span></span>(
        <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">seller</span>,
        <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
        <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>
    );

    <span class="pl-k">event <span class="pl-en">FeeUpdated</span></span>(
        <span class="pl-c1">uint256</span> <span class="pl-v">newMarketplaceFee</span>,
        <span class="pl-c1">address</span> <span class="pl-v">newFeeRecipient</span>
    );

    <span class="pl-k">constructor</span>(<span class="pl-c1">uint256</span> <span class="pl-v">_marketplaceFeePercent</span>, <span class="pl-c1">address</span> <span class="pl-v">_feeRecipient</span>) {
        <span class="pl-k">require</span>(_marketplaceFeePercent <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Marketplace fee too high (max 10%)</span>"</span>);
        <span class="pl-k">require</span>(_feeRecipient <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>), <span class="pl-s">"<span class="pl-s">Fee recipient cannot be zero</span>"</span>);

        owner <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>;
        marketplaceFeePercent <span class="pl-k">=</span> _marketplaceFeePercent;
        feeRecipient <span class="pl-k">=</span> _feeRecipient;
    }

    <span class="pl-k">modifier<span class="pl-en"> onlyOwner</span></span>() {
        <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span> <span class="pl-k">==</span> owner, <span class="pl-s">"<span class="pl-s">Only owner</span>"</span>);
        <span class="pl-k">_;</span>
    }

    <span class="pl-k">function<span class="pl-en"> setMarketplaceFeePercent</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">_newFee</span>) <span class="pl-k">external</span> onlyOwner {
        <span class="pl-k">require</span>(_newFee <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Marketplace fee too high</span>"</span>);
        marketplaceFeePercent <span class="pl-k">=</span> _newFee;
        <span class="pl-k">emit</span> <span class="pl-en">FeeUpdated</span>(_newFee, feeRecipient);
    }

    <span class="pl-k">function<span class="pl-en"> setFeeRecipient</span></span>(<span class="pl-c1">address</span> <span class="pl-v">_newRecipient</span>) <span class="pl-k">external</span> onlyOwner {
        <span class="pl-k">require</span>(_newRecipient <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>), <span class="pl-s">"<span class="pl-s">Invalid fee recipient</span>"</span>);
        feeRecipient <span class="pl-k">=</span> _newRecipient;
        <span class="pl-k">emit</span> <span class="pl-en">FeeUpdated</span>(marketplaceFeePercent, _newRecipient);
    }

    <span class="pl-k">function<span class="pl-en"> listNFT</span></span>(
        <span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
        <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
        <span class="pl-c1">uint256</span> <span class="pl-v">royaltyPercent</span>
    ) <span class="pl-k">external</span> {
        <span class="pl-k">require</span>(price <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Price must be above zero</span>"</span>);
        <span class="pl-k">require</span>(royaltyPercent <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Max 10% royalty allowed</span>"</span>);
        <span class="pl-k">require</span>(<span class="pl-k">!</span>listings[nftAddress][tokenId].isListed, <span class="pl-s">"<span class="pl-s">Already listed</span>"</span>);

        <span class="pl-c1">IERC721</span> nft <span class="pl-k">=</span> <span class="pl-c1">IERC721</span>(nftAddress);
        <span class="pl-k">require</span>(nft.<span class="pl-en">ownerOf</span>(tokenId) <span class="pl-k">==</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-s">"<span class="pl-s">Not the owner</span>"</span>);
        <span class="pl-k">require</span>(
            nft.<span class="pl-en">getApproved</span>(tokenId) <span class="pl-k">==</span> <span class="pl-c1">address</span>(<span class="pl-mi">this</span>) <span class="pl-k">||</span> nft.<span class="pl-en">isApprovedForAll</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">address</span>(<span class="pl-mi">this</span>)),
            <span class="pl-s">"<span class="pl-s">Marketplace not approved</span>"</span>
        );

        listings[nftAddress][tokenId] <span class="pl-k">=</span> <span class="pl-en">Listing</span>({
            seller: <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>,
            nftAddress: nftAddress,
            tokenId: tokenId,
            price: price,
            royaltyReceiver: royaltyReceiver,
            royaltyPercent: royaltyPercent,
            isListed: <span class="pl-c1">true</span>
        });

        <span class="pl-k">emit</span> <span class="pl-en">Listed</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, nftAddress, tokenId, price, royaltyReceiver, royaltyPercent);
    }

    <span class="pl-k">function<span class="pl-en"> buyNFT</span></span>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>) <span class="pl-k">external</span> <span class="pl-k">payable</span> nonReentrant {
        Listing <span class="pl-k">memory</span> item <span class="pl-k">=</span> listings[nftAddress][tokenId];
        <span class="pl-k">require</span>(item.isListed, <span class="pl-s">"<span class="pl-s">Not listed</span>"</span>);
        <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">==</span> item.price, <span class="pl-s">"<span class="pl-s">Incorrect ETH sent</span>"</span>);
        <span class="pl-k">require</span>(
            item.royaltyPercent <span class="pl-k">+</span> marketplaceFeePercent <span class="pl-k">&lt;=</span> <span class="pl-c1">10000</span>,
            <span class="pl-s">"<span class="pl-s">Combined fees exceed 100%</span>"</span>
        );

        <span class="pl-c1">uint256</span> feeAmount <span class="pl-k">=</span> (<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">*</span> marketplaceFeePercent) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
        <span class="pl-c1">uint256</span> royaltyAmount <span class="pl-k">=</span> (<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">*</span> item.royaltyPercent) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
        <span class="pl-c1">uint256</span> sellerAmount <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">-</span> feeAmount <span class="pl-k">-</span> royaltyAmount;

        <span class="pl-c">// å¸‚åœºè´¹ç”¨</span>
        <span class="pl-k">if</span> (feeAmount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {
            <span class="pl-c1">payable</span>(feeRecipient).<span class="pl-en">transfer</span>(feeAmount);
        }

        <span class="pl-c">// åˆ›ä½œè€…ç‰ˆç¨</span>
        <span class="pl-k">if</span> (royaltyAmount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span> <span class="pl-k">&amp;&amp;</span> item.royaltyReceiver <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>)) {
            <span class="pl-c1">payable</span>(item.royaltyReceiver).<span class="pl-en">transfer</span>(royaltyAmount);
        }

        <span class="pl-c">// å–å®¶æ”¯ä»˜</span>
        <span class="pl-c1">payable</span>(item.seller).<span class="pl-en">transfer</span>(sellerAmount);

        <span class="pl-c">// å°†NFTè½¬ç§»ç»™ä¹°å®¶</span>
        <span class="pl-c1">IERC721</span>(item.nftAddress).<span class="pl-en">safeTransferFrom</span>(item.seller, <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, item.tokenId);

        <span class="pl-c">// åˆ é™¤åˆ—è¡¨</span>
        <span class="pl-k">delete</span> listings[nftAddress][tokenId];

        <span class="pl-k">emit</span> <span class="pl-en">Purchase</span>(
            <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>,
            nftAddress,
            tokenId,
            <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>,
            item.seller,
            item.royaltyReceiver,
            royaltyAmount,
            feeAmount
        );
    }

    <span class="pl-k">function<span class="pl-en"> cancelListing</span></span>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>) <span class="pl-k">external</span> {
        Listing <span class="pl-k">memory</span> item <span class="pl-k">=</span> listings[nftAddress][tokenId];
        <span class="pl-k">require</span>(item.isListed, <span class="pl-s">"<span class="pl-s">Not listed</span>"</span>);
        <span class="pl-k">require</span>(item.seller <span class="pl-k">==</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-s">"<span class="pl-s">Not the seller</span>"</span>);

        <span class="pl-k">delete</span> listings[nftAddress][tokenId];
        <span class="pl-k">emit</span> <span class="pl-en">Unlisted</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, nftAddress, tokenId);
    }

    <span class="pl-k">function<span class="pl-en"> getListing</span></span>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>) <span class="pl-k">external</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (Listing <span class="pl-k">memory</span>) {
        <span class="pl-k">return</span> listings[nftAddress][tokenId];
    }

    <span class="pl-k">receive</span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
        <span class="pl-k">revert</span>(<span class="pl-s">"<span class="pl-s">Direct ETH not accepted</span>"</span>);
    }

    <span class="pl-k">fallback</span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
        <span class="pl-k">revert</span>(<span class="pl-s">"<span class="pl-s">Unknown function</span>"</span>);
    }
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">1. ğŸ“¦ å¯¼å…¥â€”â€”å¼•å…¥å¯ä¿¡çš„æ„å»ºå—</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">import</span> <span class="pl-s">"<span class="pl-s">@openzeppelin/contracts/token/ERC721/IERC721.sol</span>"</span>;
<span class="pl-k">import</span> <span class="pl-s">"<span class="pl-s">@openzeppelin/contracts/security/ReentrancyGuard.sol</span>"</span>;
</pre></div>
<p dir="auto">è¿™ä¸¤è¡Œæ˜¯ä»OpenZeppelinåˆçº¦åº“<strong>å¼•å…¥å¼ºå¤§çš„ã€ç»è¿‡å®æˆ˜æµ‹è¯•çš„ç»„ä»¶</strong>ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬çš„ä½œç”¨ï¼š</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">âœ… <code>IERC721</code></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">import</span> <span class="pl-s">"<span class="pl-s">@openzeppelin/contracts/token/ERC721/IERC721.sol</span>"</span>;
</pre></div>
<p dir="auto">è¿™å¼•å…¥äº†ä»»ä½•ERC-721 NFTçš„<strong>æ¥å£</strong>â€”â€”è¿™æ˜¯éåŒè´¨åŒ–ä»£å¸ï¼ˆNFTï¼‰ä½¿ç”¨çš„æ ‡å‡†ã€‚</p>
<p dir="auto">æŠŠ<code>IERC721</code>æƒ³è±¡æˆå®šä¹‰ä»¥ä¸‹å†…å®¹çš„åˆçº¦è“å›¾ï¼š</p>
<ul dir="auto">
<li>è°æ‹¥æœ‰ä»£å¸ï¼ˆ<code>ownerOf</code>ï¼‰</li>
<li>å¦‚ä½•å®‰å…¨å‘é€ä»£å¸ï¼ˆ<code>safeTransferFrom</code>ï¼‰</li>
<li>å¦‚ä½•æ‰¹å‡†æŸäººè½¬ç§»ä½ çš„NFTï¼ˆ<code>approve</code>ã€<code>isApprovedForAll</code>ç­‰ï¼‰</li>
</ul>
<p dir="auto">é€šè¿‡å¯¼å…¥è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥<strong>ä¸ä»»ä½•NFTåˆçº¦äº¤äº’</strong>â€”â€”ä¸ä»…ä»…æ˜¯æˆ‘ä»¬åˆ›å»ºçš„NFTï¼Œè€Œæ˜¯<em>ä»»ä½•ERC-721å…¼å®¹åˆçº¦</em>ï¼Œæ¯”å¦‚æ— èŠçŒ¿æˆ–è‡ªå®šä¹‰æ¸¸æˆå†…ç‰©å“ã€‚</p>
<blockquote>
<p dir="auto">ğŸ§  æˆ‘ä»¬è¿™é‡Œä¸éœ€è¦å®Œæ•´çš„NFTåˆçº¦â€”â€”æˆ‘ä»¬ä¸æ˜¯åœ¨åˆ›å»ºNFTã€‚</p>
<p dir="auto">æˆ‘ä»¬åªæ˜¯<strong>ä¸ç°æœ‰NFTä¸€èµ·å·¥ä½œ</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ¥å£æ¥è°ƒç”¨å®ƒä»¬çš„å‡½æ•°ã€‚</p>
</blockquote>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ›¡ï¸ <code>ReentrancyGuard</code></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">import</span> <span class="pl-s">"<span class="pl-s">@openzeppelin/contracts/security/ReentrancyGuard.sol</span>"</span>;
</pre></div>
<p dir="auto">è¿™æ˜¯ä¸€ä¸ª<strong>å®‰å…¨å·¥å…·</strong>ï¼Œå¸®åŠ©ä¿æŠ¤æˆ‘ä»¬çš„åˆçº¦å…å—ç§°ä¸º<strong>é‡å…¥æ”»å‡»</strong>çš„å¸¸è§é»‘å®¢æ”»å‡»ã€‚</p>
<p dir="auto">é‚£æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p dir="auto">æƒ³è±¡æœ‰äººå¼€å§‹è´­ä¹°NFTï¼Œåœ¨è¯¥äº¤æ˜“å®Œæˆä¹‹å‰ï¼Œä»–ä»¬å·å·è¿›å…¥å¦ä¸€ä¸ªï¼ˆæˆ–ä¸€ç³»åˆ—äº¤æ˜“ï¼‰ï¼Œæä¹±ä½™é¢å¹¶è€—å°½èµ„é‡‘ã€‚</p>
</blockquote>
<p dir="auto">é€šè¿‡ä½¿ç”¨<code>ReentrancyGuard</code>ï¼Œæˆ‘ä»¬å¯ä»¥<strong>é”å®šæˆ‘ä»¬çš„æ•æ„Ÿå‡½æ•°</strong>ï¼Œå¦‚<code>buyNFT()</code>ï¼Œè¿™æ ·æ²¡æœ‰äººå¯ä»¥é‡æ–°è¿›å…¥å¹¶åœ¨ä¸­é€”åˆ©ç”¨é€»è¾‘ã€‚</p>
<p dir="auto">æˆ‘ä»¬å°†ä½¿ç”¨<code>nonReentrant</code>ä¿®é¥°ç¬¦åº”ç”¨è¿™ä¸ªä¿æŠ¤ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">2. ğŸ—ï¸ åˆçº¦å£°æ˜â€”â€”å¯åŠ¨å¸‚åœº</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">contract</span> <span class="pl-en">NFTMarketplace</span> <span class="pl-k">is</span> <span class="pl-en">ReentrancyGuard</span> {
</pre></div>
<p dir="auto">è¿™ä¸€è¡Œå¯åŠ¨äº†å®é™…çš„æ™ºèƒ½åˆçº¦â€”â€”å®ƒåšäº†<strong>ä¸¤ä»¶å¤§äº‹</strong>ï¼š</p>
<ol dir="auto">
<li><strong>å‘½åæˆ‘ä»¬çš„åˆçº¦</strong>
<ul dir="auto">
<li>å®ƒå«åš<code>NFTMarketplace</code>â€”â€”è¿™æ˜¯å…¶ä»–åˆçº¦ã€å·¥å…·å’Œå‰ç«¯å°†å¼•ç”¨å®ƒçš„æ–¹å¼ã€‚</li>
</ul>
</li>
<li><strong>ä»ReentrancyGuardç»§æ‰¿</strong>
<ul dir="auto">
<li>é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬çš„åˆçº¦<em>è‡ªåŠ¨è·å¾—ä¿æŠ¤</em>ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨<code>nonReentrant</code>ä¿®é¥°ç¬¦çš„ä»»ä½•å‡½æ•°ä¸Šå…å—é‡å…¥æ”»å‡»ã€‚</li>
<li>è¿™å°±åƒç»™æˆ‘ä»¬çš„æ•æ„Ÿå‡½æ•°ä¸€ä¸ªç§äººä¿é•–ã€‚</li>
</ul>
</li>
</ol>
<hr>
<p dir="auto">ğŸ”‘ ä¸ºä»€ä¹ˆè¿™ä¸ªè®¾ç½®å¾ˆé‡è¦</p>
<p dir="auto">ä»…ä»…é€šè¿‡è¿™ä¸¤ä¸ªå¯¼å…¥å’Œå£°æ˜ï¼Œæˆ‘ä»¬å°±ä¸ºä»¥ä¸‹å†…å®¹å¥ å®šäº†åŸºç¡€ï¼š</p>
<ul dir="auto">
<li>ä¸ä»»ä½•ERC-721 NFTåˆçº¦ä¸€èµ·å·¥ä½œ</li>
<li>ä¿æŒæˆ‘ä»¬çš„å¸‚åœºå…å—å…³é”®æ¼æ´çš„å½±å“</li>
</ul>
<p dir="auto">ç°åœ¨æˆ‘ä»¬å‡†å¤‡æ·±å…¥<strong>çŠ¶æ€å˜é‡</strong>â€”â€”æˆ‘ä»¬çš„åˆçº¦å­˜å‚¨çš„æ•°æ®ï¼Œç”¨äºè·Ÿè¸ªåˆ—è¡¨ã€è´¹ç”¨å’Œæ‰€æœ‰æƒã€‚</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">3. çŠ¶æ€å˜é‡</h2></div>
<p dir="auto">è¿™äº›å˜é‡ä½äºåˆçº¦çš„é¡¶éƒ¨ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">address</span> <span class="pl-k">public</span> owner;
<span class="pl-c1">uint256</span> <span class="pl-k">public</span> marketplaceFeePercent; <span class="pl-c">// ä»¥åŸºç‚¹ä¸ºå•ä½ (100 = 1%)</span>
<span class="pl-c1">address</span> <span class="pl-k">public</span> feeRecipient;
</pre></div>
<hr>
<p dir="auto"><strong>ğŸ§  è¿™äº›å˜é‡çš„ä½œç”¨</strong></p>
<p dir="auto">è¿™ä¸‰ä¸ªå€¼ä¸ºæˆ‘ä»¬çš„å¸‚åœºæä¾›äº†<strong>åŸºæœ¬çš„ç®¡ç†æ§åˆ¶å’Œæ”¶å…¥é€»è¾‘</strong>ã€‚å®ƒä»¬å®šä¹‰ï¼š</p>
<ul dir="auto">
<li>è°è´Ÿè´£</li>
<li>å¸‚åœºæ”¶å–å¤šå°‘è´¹ç”¨</li>
<li>è¿™äº›è´¹ç”¨å»å“ªé‡Œ</li>
</ul>
<p dir="auto">è®©æˆ‘ä»¬é€ä¸€åˆ†æï¼š</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ‘‘ <code>owner</code></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">address</span> <span class="pl-k">public</span> owner;
</pre></div>
<ul dir="auto">
<li>è¿™å­˜å‚¨äº†<strong>éƒ¨ç½²åˆçº¦çš„åœ°å€</strong>ã€‚</li>
<li>æ‰€æœ‰è€…è¢«è®¤ä¸ºæ˜¯<strong>ç®¡ç†å‘˜</strong>â€”â€”å”¯ä¸€è¢«å…è®¸æ›´æ–°è´¹ç”¨æˆ–æ›´æ”¹è´¹ç”¨æ¥æ”¶è€…çš„äººã€‚</li>
</ul>
<blockquote>
<p dir="auto">ğŸ’¡ ä¸ºä»€ä¹ˆæ‰‹åŠ¨è·Ÿè¸ªæ‰€æœ‰æƒï¼Ÿ</p>
<p dir="auto">å› ä¸ºè¿™æ²¡æœ‰ä½¿ç”¨OpenZeppelinçš„<code>Ownable</code>åˆçº¦â€”â€”æˆ‘ä»¬ä¿æŒç²¾ç®€å¹¶ç¼–å†™è‡ªå·±çš„åŸºæœ¬è®¿é—®æ§åˆ¶ã€‚</p>
</blockquote>
<p dir="auto">ä½ ç¨åä¼šåœ¨ä»£ç ä¸­çœ‹åˆ°ä¸€ä¸ªåä¸º<code>onlyOwner</code>çš„ä¿®é¥°ç¬¦ï¼Œå®ƒä½¿ç”¨è¿™ä¸ªå€¼ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ’¸ <code>marketplaceFeePercent</code></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> <span class="pl-k">public</span> marketplaceFeePercent; <span class="pl-c">// ä»¥åŸºç‚¹ä¸ºå•ä½ (100 = 1%)</span>
</pre></div>
<p dir="auto">è¿™è®¾ç½®äº†å¸‚åœºå°†ä»æ¯æ¬¡é”€å”®ä¸­æ”¶å–çš„<strong>è´¹ç”¨ç™¾åˆ†æ¯”</strong>â€”â€”ä½†ä»¥<strong>åŸºç‚¹</strong>ä¸ºå•ä½ã€‚</p>
<blockquote>
<p dir="auto">ğŸ§¾ ä»€ä¹ˆæ˜¯åŸºç‚¹ï¼Ÿ</p>
<p dir="auto">1åŸºç‚¹ = 0.01%ã€‚</p>
<p dir="auto">æ‰€ä»¥100åŸºç‚¹ = 1%ã€‚</p>
<p dir="auto">1000åŸºç‚¹ = 10%ã€‚</p>
</blockquote>
<p dir="auto">ä½¿ç”¨åŸºç‚¹ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹è´¹ç”¨çš„<strong>ç»†ç²’åº¦æ§åˆ¶</strong>ï¼Œå¹¶é¿å…äº†Solidityç¼ºä¹å°æ•°çš„é—®é¢˜ã€‚</p>
<p dir="auto">ä¾‹å¦‚ï¼š</p>
<ul dir="auto">
<li>è´¹ç”¨ä¸º<code>250</code>æ„å‘³ç€æ¯æ¬¡é”€å”®çš„2.5%å½’å¸‚åœºæ‰€æœ‰ã€‚</li>
</ul>
<p dir="auto">è¿™ä¸ªå˜é‡ç¨åå¯ä»¥ç”±æ‰€æœ‰è€…æ›´æ–°ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ¦ <code>feeRecipient</code></h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">address</span> <span class="pl-k">public</span> feeRecipient;
</pre></div>
<p dir="auto">è¿™æ˜¯ä»æ¯æ¬¡NFTé”€å”®ä¸­<strong>æ¥æ”¶å¸‚åœºä»½é¢</strong>çš„<strong>é’±åŒ…</strong>ã€‚</p>
<p dir="auto">å®ƒå¯èƒ½æ˜¯ï¼š</p>
<ul dir="auto">
<li>å¸‚åœºåˆ›å§‹äºº</li>
<li>DAOé‡‘åº“</li>
<li>å¤šé‡ç­¾åé’±åŒ…</li>
<li>ç”šè‡³æ˜¯è‡ªåŠ¨åˆ†é…èµ„é‡‘çš„æ™ºèƒ½åˆçº¦</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">4. ç»“æ„ä½“å’Œæ˜ å°„</h2></div>
<p dir="auto">ç°åœ¨æˆ‘ä»¬è¿›å…¥å¸‚åœºçš„<strong>æ ¸å¿ƒæ•°æ®æ¨¡å‹</strong>ï¼š<strong><code>Listing</code>ç»“æ„ä½“</strong>å’Œå­˜å‚¨æ‰€æœ‰åˆ—å‡ºNFTçš„<strong>æ˜ å°„</strong>ã€‚</p>
<p dir="auto">è¿™æ˜¯ä½ çš„å¸‚åœºè·Ÿè¸ªä»€ä¹ˆåœ¨å‡ºå”®ã€è°æ‹¥æœ‰å®ƒã€æˆæœ¬å¤šå°‘ä»¥åŠè°å¾—åˆ°ä»€ä¹ˆæŠ¥é…¬çš„åœ°æ–¹ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§± <code>Listing</code>ç»“æ„ä½“</h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">struct<span class="pl-en"> Listing</span></span> {
    <span class="pl-c1">address</span> seller;
    <span class="pl-c1">address</span> nftAddress;
    <span class="pl-c1">uint256</span> tokenId;
    <span class="pl-c1">uint256</span> price;
    <span class="pl-c1">address</span> royaltyReceiver;
    <span class="pl-c1">uint256</span> royaltyPercent; <span class="pl-c">// ä»¥åŸºç‚¹ä¸ºå•ä½</span>
    <span class="pl-c1">bool</span> isListed;
}
</pre></div>
<p dir="auto">è¿™ä¸ªç»“æ„ä½“å°±åƒåœ¨å¸‚åœºä¸Šåˆ—å‡ºçš„å•ä¸ªNFTçš„<strong>è¿·ä½ æ•°æ®åº“æ¡ç›®</strong>ã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬åˆ†è§£æ¯ä¸ªå­—æ®µï¼š</p>
<hr>
<p dir="auto">ğŸ§ <code>seller</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">address</span> seller;
</pre></div>
<p dir="auto">åˆ—å‡ºNFTçš„äººã€‚</p>
<p dir="auto">ä»–ä»¬å°†æ˜¯æ¥æ”¶å¤§éƒ¨åˆ†ä»˜æ¬¾çš„äººï¼ˆåœ¨å¸‚åœºè´¹ç”¨å’Œç‰ˆç¨ä¹‹åï¼‰ã€‚</p>
<hr>
<p dir="auto">ğŸ–¼ï¸ <code>nftAddress</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">address</span> nftAddress;
</pre></div>
<p dir="auto">è¿™æ˜¯NFTçš„<strong>åˆçº¦åœ°å€</strong>ã€‚</p>
<p dir="auto">ä½ çš„å¸‚åœºæ”¯æŒ<em>ä»»ä½•</em>ERC-721ä»£å¸â€”â€”ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ”¶è—â€”â€”æ‰€ä»¥æˆ‘ä»¬éœ€è¦çŸ¥é“<strong>è¿™ä¸ªä»£å¸å±äºå“ªä¸ªNFTåˆçº¦</strong>ã€‚</p>
<hr>
<p dir="auto">ğŸ·ï¸ <code>tokenId</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> tokenId;
</pre></div>
<p dir="auto">è¢«åˆ—å‡ºçš„<strong>NFTçš„ID</strong>ã€‚</p>
<p dir="auto">ä¸<code>nftAddress</code>ä¸€èµ·ï¼Œè¿™æŒ‡å‘åŒºå—é“¾ä¸Šçš„ç‰¹å®šNFTã€‚</p>
<hr>
<p dir="auto">ğŸ’° <code>price</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> price;
</pre></div>
<p dir="auto">å–å®¶æƒ³è¦NFTçš„é‡‘é¢ï¼ˆä»¥<strong>ETH</strong>ä¸ºå•ä½ï¼‰ã€‚</p>
<p dir="auto">å½“æœ‰äººè´­ä¹°å®ƒæ—¶ï¼Œä»–ä»¬éœ€è¦å‘é€ç¡®åˆ‡çš„è¿™ä¸ªETHæ•°é‡ã€‚</p>
<hr>
<p dir="auto">ğŸ¨ <code>royaltyReceiver</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">address</span> royaltyReceiver;
</pre></div>
<p dir="auto">å¯é€‰ï¼šåº”è¯¥ä»æ­¤æ¬¡é”€å”®ä¸­æ¥æ”¶<strong>åˆ›ä½œè€…ç‰ˆç¨</strong>çš„åœ°å€ã€‚</p>
<p dir="auto">è¿™å…è®¸åˆ›ä½œè€…ç»§ç»­ä»äºŒæ¬¡é”€å”®ä¸­èµšé’±ï¼Œå³ä½¿ä»–ä»¬ä¸å†æ˜¯å–å®¶ã€‚</p>
<hr>
<p dir="auto">ğŸ“ˆ <code>royaltyPercent</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> royaltyPercent; <span class="pl-c">// ä»¥åŸºç‚¹ä¸ºå•ä½</span>
</pre></div>
<p dir="auto"><code>royaltyReceiver</code>åº”è¯¥è·å¾—å¤šå°‘ç‰ˆç¨â€”â€”ä»¥åŸºç‚¹ä¸ºå•ä½ï¼ˆ1% = 100ï¼‰ã€‚</p>
<p dir="auto">ä¾‹å­ï¼š</p>
<ul dir="auto">
<li>å¦‚æœ<code>price = 1 ETH</code>ä¸”<code>royaltyPercent = 500</code>ï¼Œåˆ›ä½œè€…è·å¾—<code>0.05 ETH</code>ã€‚</li>
</ul>
<blockquote>
<p dir="auto">ğŸ¯ ä½ å¯ä»¥ä¸ºæ¯ä¸ªåˆ—è¡¨è‡ªå®šä¹‰è¿™ä¸ªâ€”â€”ä¸éœ€è¦åœ¨NFTåˆçº¦ä¸­çƒ˜ç„™å›ºå®šç‰ˆç¨ã€‚</p>
</blockquote>
<hr>
<p dir="auto">ğŸ“¦ <code>isListed</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">bool</span> isListed;
</pre></div>
<p dir="auto">å‘Šè¯‰æˆ‘ä»¬NFTæ˜¯å¦<strong>å½“å‰åˆ—å‡º</strong>çš„æ ‡å¿—ã€‚</p>
<p dir="auto">æˆ‘ä»¬ç”¨è¿™ä¸ªæ¥ï¼š</p>
<ul dir="auto">
<li>é˜²æ­¢é‡å¤åˆ—è¡¨</li>
<li>æ£€æŸ¥æŸäº›ä¸œè¥¿æ˜¯å¦ä»åœ¨å‡ºå”®</li>
<li>æ§åˆ¶åœ¨å¸‚åœºå‰ç«¯æ˜¾ç¤ºä»€ä¹ˆ</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ“š æ˜ å°„ï¼šå­˜å‚¨æ‰€æœ‰åˆ—è¡¨</h3></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">mapping</span>(<span class="pl-c1">address</span> <span class="pl-k">=&gt;</span> <span class="pl-k">mapping</span>(<span class="pl-c1">uint256</span> <span class="pl-k">=&gt;</span> Listing)) <span class="pl-k">public</span> listings;
</pre></div>
<p dir="auto">è¿™æ˜¯æˆ‘ä»¬åœ¨åˆçº¦ä¸­<strong>å­˜å‚¨å’Œç»„ç»‡</strong>æ‰€æœ‰åˆ—è¡¨çš„æ–¹å¼ã€‚</p>
<p dir="auto">è¿™æ˜¯ä¸€ä¸ª<strong>åµŒå¥—æ˜ å°„</strong>ï¼Œæ„å‘³ç€ï¼š</p>
<ul dir="auto">
<li>ç¬¬ä¸€ä¸ªé”®æ˜¯<strong>NFTåˆçº¦åœ°å€</strong></li>
<li>ç¬¬äºŒä¸ªé”®æ˜¯<strong>ä»£å¸ID</strong></li>
</ul>
<p dir="auto">æ‰€ä»¥å¦‚æœä½ æƒ³è®¿é—®ç‰¹å®šNFTçš„åˆ—è¡¨ï¼Œä½ ä¼šä½¿ç”¨ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>listings[nftAddress][tokenId]
</pre></div>
<blockquote>
<p dir="auto">ğŸ’¡ ä¸ºä»€ä¹ˆåµŒå¥—ï¼Ÿ</p>
<p dir="auto">å› ä¸ºè¿™å…è®¸æ”¯æŒå¤šä¸ªä¸åŒçš„NFTæ”¶è—â€”â€”å…¨éƒ¨åœ¨ä¸€ä¸ªåˆçº¦ä¸­ã€‚å®ƒå¹²å‡€ã€å¯æ‰©å±•ï¼Œå¹¶ä¸”ä¸ä»»ä½•ERC-721éƒ½èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">5. ğŸ”” NFTå¸‚åœºä¸­çš„å…³é”®äº‹ä»¶</h2></div>
<p dir="auto">äº‹ä»¶èµ·åˆå¯èƒ½çœ‹èµ·æ¥åƒèƒŒæ™¯å™ªéŸ³...ä½†å®ƒä»¬å®é™…ä¸Šæ˜¯æ™ºèƒ½åˆçº¦ä¸å¤–éƒ¨ä¸–ç•Œå¯¹è¯çš„<strong>ä¸»è¦æ–¹å¼</strong>ã€‚</p>
<p dir="auto">å½“é“¾ä¸Šå‘ç”ŸæŸäº‹æ—¶â€”â€”æ¯”å¦‚åˆ—å‡ºNFTæˆ–è¿›è¡Œé”€å”®â€”â€”æˆ‘ä»¬å‘å‡ºä¸€ä¸ª<strong>äº‹ä»¶</strong>ï¼Œä»¥ä¾¿ï¼š</p>
<ul dir="auto">
<li>å‰ç«¯åº”ç”¨ï¼ˆå¦‚ä½ çš„å¸‚åœºUIï¼‰å¯ä»¥è·å–å¹¶æ˜¾ç¤ºå®ƒ</li>
<li>ç´¢å¼•å™¨ï¼ˆå¦‚The Graphï¼‰å¯ä»¥è·Ÿè¸ªå’Œåˆ†ç±»å®ƒ</li>
<li>å¼€å‘è€…å’Œç”¨æˆ·å¯ä»¥åœ¨åƒEtherscanè¿™æ ·çš„åŒºå—æµè§ˆå™¨ä¸ŠæŸ¥çœ‹å®ƒ</li>
</ul>
<p dir="auto">å®ƒä»¬ä¸å½±å“åˆçº¦å†…éƒ¨çš„é€»è¾‘â€”â€”ä½†å®ƒä»¬å¯¹<strong>é€æ˜åº¦å’Œå¯ç”¨æ€§</strong>è‡³å…³é‡è¦ã€‚</p>
<p dir="auto">è¿™é‡Œæ˜¯åˆçº¦ä¸­å®šä¹‰çš„å››ä¸ªäº‹ä»¶ï¼š</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">event <span class="pl-en">Listed</span></span>(
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">seller</span>,
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
    <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">royaltyPercent</span>
);

<span class="pl-k">event <span class="pl-en">Purchase</span></span>(
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">buyer</span>,
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
    <span class="pl-c1">address</span> <span class="pl-v">seller</span>,
    <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">royaltyAmount</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">marketplaceFeeAmount</span>
);

<span class="pl-k">event <span class="pl-en">Unlisted</span></span>(
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">seller</span>,
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>
);

<span class="pl-k">event <span class="pl-en">FeeUpdated</span></span>(
    <span class="pl-c1">uint256</span> <span class="pl-v">newMarketplaceFee</span>,
    <span class="pl-c1">address</span> <span class="pl-v">newFeeRecipient</span>
);
</pre></div>
<hr>
<p dir="auto">ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€ä¸€åˆ†è§£å®ƒä»¬ï¼š</p>
<hr>
<p dir="auto">âœ… 1. <code>Listed</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">event <span class="pl-en">Listed</span></span>(
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">seller</span>,
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
    <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">royaltyPercent</span>
);
</pre></div>
<p dir="auto">å½“NFTè¢«<strong>åˆ—å‡º</strong>å‡ºå”®æ—¶å‘å‡ºæ­¤äº‹ä»¶ã€‚</p>
<p dir="auto">å®ƒå‘Šè¯‰ä¸–ç•Œï¼š</p>
<ul dir="auto">
<li><strong>è°</strong>åˆ—å‡ºäº†å®ƒï¼ˆ<code>seller</code>ï¼‰</li>
<li><strong>å“ªä¸ªNFT</strong>æ­£åœ¨è¢«å‡ºå”®ï¼ˆ<code>nftAddress</code>ã€<code>tokenId</code>ï¼‰</li>
<li><strong>å¤šå°‘é’±</strong>ï¼ˆ<code>price</code>ï¼‰</li>
<li><strong>è°è·å¾—ç‰ˆç¨</strong>ï¼Œä»¥åŠ<strong>å¤šå°‘</strong>ï¼ˆ<code>royaltyReceiver</code>ã€<code>royaltyPercent</code>ï¼‰</li>
</ul>
<p dir="auto"><code>indexed</code>å­—æ®µä½¿å¾—åœ¨UIå’Œæµè§ˆå™¨å·¥å…·ä¸­æŒ‰å–å®¶æˆ–NFTè¿‡æ»¤åˆ—è¡¨å˜å¾—å®¹æ˜“ã€‚</p>
<hr>
<p dir="auto">ğŸ›ï¸ 2. <code>Purchase</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">event <span class="pl-en">Purchase</span></span>(
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">buyer</span>,
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
    <span class="pl-c1">address</span> <span class="pl-v">seller</span>,
    <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">royaltyAmount</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">marketplaceFeeAmount</span>
);
</pre></div>
<p dir="auto">å½“æœ‰äºº<strong>è´­ä¹°NFT</strong>æ—¶è§¦å‘æ­¤äº‹ä»¶ã€‚</p>
<p dir="auto">å®ƒåŒ…æ‹¬ï¼š</p>
<ul dir="auto">
<li><strong>ä¹°å®¶</strong>çš„åœ°å€</li>
<li>è¢«å‡ºå”®çš„<strong>NFT</strong>ï¼ˆé€šè¿‡<code>nftAddress</code>å’Œ<code>tokenId</code>ï¼‰</li>
<li>æ”¯ä»˜çš„<strong>æ€»ä»·æ ¼</strong></li>
<li>æ¥æ”¶ETHçš„<strong>å–å®¶</strong>ï¼ˆå‡å»è´¹ç”¨ï¼‰</li>
<li><strong>ç‰ˆç¨æ¥æ”¶è€…</strong>ï¼ˆå¦‚æœæœ‰ï¼‰ä»¥åŠä»–ä»¬å¾—åˆ°å¤šå°‘</li>
<li><strong>å¸‚åœºè´¹ç”¨é‡‘é¢</strong></li>
</ul>
<p dir="auto">è¿™æ˜¯æœ€è¯¦ç»†çš„äº‹ä»¶â€”â€”å®ƒè·Ÿè¸ª<strong>äº¤æ˜“çš„æ¯ä¸ªéƒ¨åˆ†</strong>ã€‚å¯¹ä»¥ä¸‹æœ‰ç”¨ï¼š</p>
<ul dir="auto">
<li>å‰ç«¯æ˜¾ç¤ºè´­ä¹°æ”¶æ®</li>
<li>æ˜¾ç¤ºå¸‚åœºæ”¶å…¥çš„åˆ†æä»ªè¡¨æ¿</li>
<li>åˆ›ä½œè€…ç‰ˆç¨æŠ¥å‘Š</li>
</ul>
<hr>
<p dir="auto">ğŸš« 3. <code>Unlisted</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">event <span class="pl-en">Unlisted</span></span>(
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">seller</span>,
    <span class="pl-c1">address</span> <span class="pl-k">indexed</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-k">indexed</span> <span class="pl-v">tokenId</span>
);
</pre></div>
<p dir="auto">å½“å–å®¶<strong>å–æ¶ˆ</strong>ä»–ä»¬çš„åˆ—è¡¨æ—¶å‘å‡ºã€‚</p>
<p dir="auto">è¿™ä¸ªäº‹ä»¶å¸®åŠ©ï¼š</p>
<ul dir="auto">
<li>UIåœæ­¢æ˜¾ç¤ºè¿‡æœŸæˆ–åˆ é™¤çš„åˆ—è¡¨</li>
<li>ç´¢å¼•å™¨æ›´æ–°ä»–ä»¬çš„æ•°æ®åº“</li>
<li>æ¯ä¸ªäººéƒ½ä¿æŒå¯¹å®é™…å‡ºå”®å†…å®¹çš„åŒæ­¥</li>
</ul>
<hr>
<p dir="auto">ğŸ› ï¸ 4. <code>FeeUpdated</code></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">event <span class="pl-en">FeeUpdated</span></span>(
    <span class="pl-c1">uint256</span> <span class="pl-v">newMarketplaceFee</span>,
    <span class="pl-c1">address</span> <span class="pl-v">newFeeRecipient</span>
);
</pre></div>
<p dir="auto">å½“<strong>å¸‚åœºæ‰€æœ‰è€…æ›´æ”¹è´¹ç”¨è®¾ç½®</strong>æ—¶è®°å½•æ­¤äº‹ä»¶ã€‚</p>
<p dir="auto">è¿™åŒ…æ‹¬ï¼š</p>
<ul dir="auto">
<li><strong>æ–°è´¹ç”¨</strong>ï¼ˆä»¥åŸºç‚¹ä¸ºå•ä½ï¼Œä¾‹å¦‚250 = 2.5%ï¼‰</li>
<li>è´¹ç”¨ETHå°†è¢«å‘é€åˆ°çš„<strong>æ–°æ¥æ”¶è€…åœ°å€</strong></li>
</ul>
<p dir="auto">å®ƒä¸»è¦å¯¹ç®¡ç†é¢æ¿ã€DAOæ§åˆ¶çš„å¹³å°æˆ–ç”¨æˆ·é€æ˜åº¦æœ‰ç”¨ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">6. ğŸ—ï¸æ„é€ å‡½æ•°â€”â€”å¼•å¯¼å¸‚åœº</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">constructor</span>(<span class="pl-c1">uint256</span> <span class="pl-v">_marketplaceFeePercent</span>, <span class="pl-c1">address</span> <span class="pl-v">_feeRecipient</span>) {
    <span class="pl-k">require</span>(_marketplaceFeePercent <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Marketplace fee too high (max 10%)</span>"</span>);
    <span class="pl-k">require</span>(_feeRecipient <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>), <span class="pl-s">"<span class="pl-s">Fee recipient cannot be zero</span>"</span>);

    owner <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>;
    marketplaceFeePercent <span class="pl-k">=</span> _marketplaceFeePercent;
    feeRecipient <span class="pl-k">=</span> _feeRecipient;
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§  ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3></div>
<p dir="auto">å½“æœ‰äººéƒ¨ç½²è¿™ä¸ªåˆçº¦æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä»–ä»¬ï¼š</p>
<ul dir="auto">
<li>è®¾ç½®å¸‚åœºå°†æ”¶å–å¤šå°‘<strong>è´¹ç”¨</strong>ï¼ˆä¾‹å¦‚ï¼Œ2.5%ï¼‰</li>
<li>å†³å®šè¿™äº›è´¹ç”¨åº”è¯¥<strong>å»å“ªé‡Œ</strong>ï¼ˆä¾‹å¦‚ï¼Œåˆ°DAOé‡‘åº“æˆ–å¼€å‘é’±åŒ…ï¼‰</li>
<li>è‡ªåŠ¨æˆä¸ºåˆçº¦çš„<strong>æ‰€æœ‰è€…/ç®¡ç†å‘˜</strong></li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ” é€è¡Œåˆ†è§£</h3></div>
<p dir="auto">âœ… è´¹ç”¨éªŒè¯</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(_marketplaceFeePercent <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Marketplace fee too high (max 10%)</span>"</span>);
</pre></div>
<ul dir="auto">
<li>é˜²æ­¢åœ¨éƒ¨ç½²æ—¶è®¾ç½®ç–¯ç‹‚çš„è´¹ç”¨è®¾ç½®ã€‚</li>
<li>è´¹ç”¨ä»¥<strong>åŸºç‚¹</strong>ä¸ºå•ä½ï¼Œå…¶ä¸­ï¼š
<ul dir="auto">
<li><code>1000</code> = 10%</li>
<li><code>500</code> = 5%</li>
<li><code>250</code> = 2.5%</li>
</ul>
</li>
<li>è¿™ä¸€è¡Œç¡®ä¿éƒ¨ç½²è€…ä¸èƒ½è®¾ç½®åƒ99%è¿™æ ·è’è°¬çš„ä¸œè¥¿ã€‚</li>
</ul>
<hr>
<p dir="auto"><strong>âœ… è´¹ç”¨æ¥æ”¶è€…æ£€æŸ¥</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(_feeRecipient <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>), <span class="pl-s">"<span class="pl-s">Fee recipient cannot be zero</span>"</span>);
</pre></div>
<p dir="auto">æˆ‘ä»¬ç¡®ä¿éƒ¨ç½²è€…ä¼ å…¥ä¸€ä¸ª<strong>æœ‰æ•ˆçš„ETHåœ°å€</strong>æ¥æ¥æ”¶å¸‚åœºè´¹ç”¨ã€‚</p>
<blockquote>
<p dir="auto">å°†å…¶è®¾ç½®ä¸ºé›¶åœ°å€ï¼ˆ0x000...000ï¼‰ä¼šä½¿è´¹ç”¨æ°¸è¿œæ¶ˆå¤±â€”â€”æ‰€ä»¥æˆ‘ä»¬é˜»æ­¢è¿™ç§æƒ…å†µã€‚</p>
</blockquote>
<hr>
<p dir="auto"><strong>ğŸ‘‘ è®¾ç½®æ‰€æœ‰è€…</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>owner <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>;
</pre></div>
<p dir="auto">éƒ¨ç½²åˆçº¦çš„äººæˆä¸º<strong>ç®¡ç†å‘˜/æ‰€æœ‰è€…</strong>ã€‚</p>
<p dir="auto">ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼š</p>
<ul dir="auto">
<li>åªæœ‰æ‰€æœ‰è€…å¯ä»¥æ›´æ–°è´¹ç”¨æˆ–æ›´æ”¹è´¹ç”¨æ¥æ”¶è€…</li>
<li>è¿™æ˜¯ä½ è¯´"è¿™ä¸ªäººæ§åˆ¶å¸‚åœºè®¾ç½®"çš„æ–¹å¼</li>
</ul>
<hr>
<p dir="auto"><strong>ğŸ’° è®¾ç½®è´¹ç”¨è®¾ç½®</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>marketplaceFeePercent <span class="pl-k">=</span> _marketplaceFeePercent;
feeRecipient <span class="pl-k">=</span> _feeRecipient;
</pre></div>
<ul dir="auto">
<li><code>marketplaceFeePercent</code>ï¼šå¹³å°ä»æ¯æ¬¡é”€å”®ä¸­æ”¶å–å¤šå°‘</li>
<li><code>feeRecipient</code>ï¼šè´¹ç”¨å‘é€åˆ°å“ªé‡Œ</li>
</ul>
<p dir="auto">ä¸€æ—¦è®¾ç½®äº†è¿™äº›ï¼Œå¸‚åœºå°±å‡†å¤‡å¥½å¤„ç†åˆ—è¡¨å’Œé”€å”®äº†ã€‚</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">7. ğŸ›¡ï¸<code>onlyOwner</code>ä¿®é¥°ç¬¦â€”â€”é”å®šç®¡ç†å‡½æ•°</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">modifier<span class="pl-en"> onlyOwner</span></span>() {
    <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span> <span class="pl-k">==</span> owner, <span class="pl-s">"<span class="pl-s">Only owner</span>"</span>);
    <span class="pl-k">_;</span>
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§  ä»€ä¹ˆæ˜¯ä¿®é¥°ç¬¦ï¼Ÿ</strong></h3></div>
<p dir="auto">åœ¨Solidityä¸­ï¼Œ<strong>ä¿®é¥°ç¬¦</strong>å°±åƒå¯é‡ç”¨çš„ä¿æŠ¤å­å¥ã€‚</p>
<p dir="auto">ä½ å¯ä»¥å°†å…¶é™„åŠ åˆ°å‡½æ•°ä¸Šï¼Œä»¥<strong>åœ¨è¯¥å‡½æ•°è¿è¡Œä¹‹å‰è¦æ±‚æŸäº›æ¡ä»¶</strong>ã€‚</p>
<p dir="auto">å®ƒæœ‰åŠ©äºä¿æŒä½ çš„ä»£ç <strong>å¹²å‡€</strong>ã€<strong>å¯é‡ç”¨</strong>å’Œ<strong>æ˜“äºé˜…è¯»</strong>ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ” é€è¡Œåˆ†è§£</h3></div>
<hr>
<p dir="auto"><strong>âœ… æ£€æŸ¥è°åœ¨è°ƒç”¨</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span> <span class="pl-k">==</span> owner, <span class="pl-s">"<span class="pl-s">Only owner</span>"</span>);
</pre></div>
<p dir="auto">è¿™ä¸€è¡Œç¡®ä¿å‡½æ•°<strong>åªèƒ½ç”±æ‰€æœ‰è€…è°ƒç”¨</strong>â€”â€”éƒ¨ç½²åˆçº¦çš„åœ°å€ã€‚</p>
<ul dir="auto">
<li><code>msg.sender</code>æ˜¯è¯•å›¾è°ƒç”¨å‡½æ•°çš„åœ°å€</li>
<li>å¦‚æœå®ƒä¸ç­‰äº<code>owner</code>ï¼Œå‡½æ•°<strong>ç«‹å³åœæ­¢</strong></li>
<li>è¿”å›é”™è¯¯æ¶ˆæ¯<code>"Only owner"</code></li>
</ul>
<p dir="auto">è¿™æ˜¯ä½ çš„<strong>è®¿é—®æ§åˆ¶</strong>æœºåˆ¶ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¦ ç»§ç»­å‡½æ•°</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">_;</span>
</pre></div>
<p dir="auto">è¿™ä¸ªæœ‰è¶£çš„å°ä¸‹åˆ’çº¿æ„å‘³ç€ï¼š</p>
<blockquote>
<p dir="auto">"å¦‚æœrequireæ£€æŸ¥é€šè¿‡ï¼Œç°åœ¨ç»§ç»­è¿è¡Œå‡½æ•°çš„å…¶ä½™éƒ¨åˆ†ã€‚"</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">8. ğŸ’¸ <code>setMarketplaceFeePercent()</code> â€” æ›´æ–°å¸‚åœºè´¹ç”¨</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> setMarketplaceFeePercent</span></span>(<span class="pl-c1">uint256</span> <span class="pl-v">_newFee</span>) <span class="pl-k">external</span> onlyOwner {
    <span class="pl-k">require</span>(_newFee <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Marketplace fee too high</span>"</span>);
    marketplaceFeePercent <span class="pl-k">=</span> _newFee;
    <span class="pl-k">emit</span> <span class="pl-en">FeeUpdated</span>(_newFee, feeRecipient);
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  å®ƒåšä»€ä¹ˆï¼Ÿ</h3></div>
<p dir="auto">è¿™ä¸ªå‡½æ•°å…è®¸<strong>åˆçº¦çš„æ‰€æœ‰è€…</strong>æ›´æ”¹<strong>å¸‚åœºè´¹ç”¨</strong>ï¼ˆå¹³å°åœ¨æ¯æ¬¡é”€å”®ä¸­æ”¶å–çš„ç™¾åˆ†æ¯”ï¼‰ã€‚</p>
<p dir="auto">å®ƒå¯¹ä»¥ä¸‹æœ‰ç”¨ï¼š</p>
<ul dir="auto">
<li>éšç€å¹³å°å¢é•¿è°ƒæ•´è´¹ç”¨</li>
<li>åœ¨ä¿ƒé”€æœŸé—´é™ä½è´¹ç”¨</li>
<li>å¢åŠ è´¹ç”¨ä»¥ç»´æŒè¿è¥</li>
<li>å“åº”ç¤¾åŒºæ²»ç†ï¼Œå¦‚æœç”±DAOè¿è¡Œ</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ” é€è¡Œåˆ†è§£</h3></div>
<p dir="auto"><strong>ğŸ” è®¿é—®é™åˆ¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">external</span> onlyOwner
</pre></div>
<ul dir="auto">
<li><code>external</code>ï¼šæ„å‘³ç€è¿™ä¸ªå‡½æ•°æ˜¯ä¸ºäº†ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼ˆæ¯”å¦‚é€šè¿‡å‰ç«¯æˆ–ç”±æ‰€æœ‰è€…ç›´æ¥è°ƒç”¨ï¼‰ã€‚</li>
<li><code>onlyOwner</code>ï¼šç¡®ä¿<strong>åªæœ‰ç®¡ç†å‘˜</strong>å¯ä»¥è°ƒç”¨å®ƒâ€”â€”æ„Ÿè°¢æˆ‘ä»¬åˆšåˆšä»‹ç»çš„ä¿®é¥°ç¬¦ã€‚</li>
</ul>
<hr>
<p dir="auto"><strong>âœ… è¾“å…¥æ£€æŸ¥</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(_newFee <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Marketplace fee too high</span>"</span>);
</pre></div>
<ul dir="auto">
<li>é˜²æ­¢è®¾ç½®ä¸åˆç†çš„é«˜è´¹ç”¨ã€‚</li>
<li>è´¹ç”¨ä»¥<strong>åŸºç‚¹</strong>ä¸ºå•ä½ï¼Œæ‰€ä»¥ï¼š
<ul dir="auto">
<li><code>1000</code> = 10%</li>
<li><code>100</code> = 1%</li>
</ul>
</li>
<li>å¦‚æœ<code>_newFee</code>å¤§äº1000ï¼Œäº¤æ˜“è¢«å›æ»šã€‚</li>
</ul>
<p dir="auto">è¿™é˜²æ­¢å¸‚åœºå˜å¾—æ»¥ç”¨æˆ–ä¸å¯ç”¨ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“ æ›´æ–°çŠ¶æ€</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>marketplaceFeePercent <span class="pl-k">=</span> _newFee;
</pre></div>
<p dir="auto">è¿™è®¾ç½®æ–°å€¼ï¼Œæ›´æ–°åœ¨æ‰€æœ‰æœªæ¥é”€å”®ä¸­ä½¿ç”¨çš„<strong>å…¨å±€è´¹ç”¨ç™¾åˆ†æ¯”</strong>ã€‚</p>
<p dir="auto">å®ƒ<strong>ä¸</strong>å½±å“ç°æœ‰åˆ—è¡¨â€”â€”åªå½±å“æœªæ¥çš„è´­ä¹°ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¢ å‘å‡ºäº‹ä»¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">FeeUpdated</span>(_newFee, feeRecipient);
</pre></div>
<p dir="auto">è¿™è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œä»¥ä¾¿ï¼š</p>
<ul dir="auto">
<li>å‰ç«¯å¯ä»¥è·å–æ›´æ”¹å¹¶æ›´æ–°UI</li>
<li>å®¡è®¡å‘˜å’Œç”¨æˆ·å¯ä»¥çœ‹åˆ°è´¹ç”¨è¢«æ›´æ”¹äº†</li>
<li>ä½ ä¸ºæ¯æ¬¡è´¹ç”¨è°ƒæ•´è·å¾—é“¾ä¸Šé€æ˜åº¦</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">9. ğŸ¦  <code>setFeeRecipient()</code> â€” æ›´æ–°å¸‚åœºè´¹ç”¨å»å‘</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> setFeeRecipient</span></span>(<span class="pl-c1">address</span> <span class="pl-v">_newRecipient</span>) <span class="pl-k">external</span> onlyOwner {
    <span class="pl-k">require</span>(_newRecipient <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>), <span class="pl-s">"<span class="pl-s">Invalid fee recipient</span>"</span>);
    feeRecipient <span class="pl-k">=</span> _newRecipient;
    <span class="pl-k">emit</span> <span class="pl-en">FeeUpdated</span>(marketplaceFeePercent, _newRecipient);
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§  è¿™æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿ</strong></h3></div>
<p dir="auto">åœ¨ä»»ä½•NFTå¸‚åœºä¸­ï¼Œ<strong>è´¹ç”¨æ¥æ”¶è€…</strong>æ˜¯æ”¶é›†å¸‚åœºæ¯æ¬¡é”€å”®ä»½é¢çš„åœ°å€ã€‚</p>
<p dir="auto">è¿™å¯èƒ½æ˜¯ï¼š</p>
<ul dir="auto">
<li><strong>åˆ›å§‹äººçš„é’±åŒ…</strong></li>
<li><strong>DAOé‡‘åº“</strong></li>
<li>å›¢é˜Ÿç®¡ç†çš„<strong>å¤šé‡ç­¾å</strong></li>
<li>ç”šè‡³æ˜¯è¿›ä¸€æ­¥åˆ†å‰²æ”¶å…¥çš„<strong>æ™ºèƒ½åˆçº¦</strong></li>
</ul>
<p dir="auto">è¿™ä¸ªå‡½æ•°è®©å¸‚åœº<strong>éšæ—¶é—´é€‚åº”</strong>â€”â€”æ— è®ºæ˜¯ä¸ºäº†å®‰å…¨å‡çº§ã€å»ä¸­å¿ƒåŒ–ï¼Œè¿˜æ˜¯å°†æ”¶å…¥è½¬ç§»åˆ°ç¤¾åŒºæ§åˆ¶çš„åˆçº¦ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ” é€è¡Œåˆ†è§£</h3></div>
<p dir="auto"><strong>ğŸ” é™åˆ¶ä¸ºæ‰€æœ‰è€…</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">external</span> onlyOwner
</pre></div>
<p dir="auto">å°±åƒä¹‹å‰ä¸€æ ·ï¼š</p>
<ul dir="auto">
<li><code>external</code> = åªèƒ½ä»åˆçº¦å¤–éƒ¨è°ƒç”¨</li>
<li><code>onlyOwner</code> = <strong>åªæœ‰ç®¡ç†å‘˜</strong>å¯ä»¥æ›´æ–°è´¹ç”¨æ¥æ”¶è€…</li>
</ul>
<hr>
<p dir="auto"><strong>âœ… éªŒè¯æ–°åœ°å€</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(_newRecipient <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>), <span class="pl-s">"<span class="pl-s">Invalid fee recipient</span>"</span>);
</pre></div>
<ul dir="auto">
<li>æ£€æŸ¥æ–°åœ°å€<strong>ä¸æ˜¯</strong>é›¶åœ°å€ï¼ˆ<code>0x000...000</code>ï¼‰ã€‚</li>
<li>å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å›æ»šäº¤æ˜“ä»¥é¿å…æ„å¤–"ç‡ƒçƒ§"æœªæ¥è´¹ç”¨ã€‚</li>
</ul>
<blockquote>
<p dir="auto">è¿™æ˜¯ä¸€ä¸ªç®€å•ä½†é‡è¦çš„ä¿æŠ¤æªæ–½ã€‚</p>
</blockquote>
<hr>
<p dir="auto"><strong>ğŸ“ ä¿å­˜æ–°åœ°å€</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>feeRecipient <span class="pl-k">=</span> _newRecipient;
</pre></div>
<p dir="auto">æˆ‘ä»¬æ›´æ–°åˆçº¦çš„å†…éƒ¨çŠ¶æ€â€”â€”ç°åœ¨æ‰€æœ‰æœªæ¥çš„å¸‚åœºè´¹ç”¨å°†è¢«å‘é€åˆ°è¿™ä¸ªæ–°åœ°å€ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¢ å‘å‡ºæ›´æ–°äº‹ä»¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">FeeUpdated</span>(marketplaceFeePercent, _newRecipient);
</pre></div>
<p dir="auto">è¿™é‡ç”¨äº†<code>FeeUpdated</code>äº‹ä»¶â€”â€”å³ä½¿åªæœ‰æ¥æ”¶è€…æ”¹å˜äº†ã€‚</p>
<p dir="auto">è¿™æœ‰åŠ©äºï¼š</p>
<ul dir="auto">
<li>å‰ç«¯ç«‹å³åæ˜ æ›´æ”¹</li>
<li>ç´¢å¼•å™¨è·Ÿè¸ªç®¡ç†æ“ä½œ</li>
<li>ç”¨æˆ·çŸ¥é“è´¹ç”¨å»å“ªé‡Œ--</li>
<li></li>
</ul>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">10. ğŸ·ï¸ <code>listNFT()</code> â€” åˆ—å‡ºä½ çš„NFTå‡ºå”®</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> listNFT</span></span>(
    <span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
    <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">royaltyPercent</span>
) <span class="pl-k">external</span> {
    <span class="pl-k">require</span>(price <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Price must be above zero</span>"</span>);
    <span class="pl-k">require</span>(royaltyPercent <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Max 10% royalty allowed</span>"</span>);
    <span class="pl-k">require</span>(<span class="pl-k">!</span>listings[nftAddress][tokenId].isListed, <span class="pl-s">"<span class="pl-s">Already listed</span>"</span>);

    <span class="pl-c1">IERC721</span> nft <span class="pl-k">=</span> <span class="pl-c1">IERC721</span>(nftAddress);
    <span class="pl-k">require</span>(nft.<span class="pl-en">ownerOf</span>(tokenId) <span class="pl-k">==</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-s">"<span class="pl-s">Not the owner</span>"</span>);
    <span class="pl-k">require</span>(
        nft.<span class="pl-en">getApproved</span>(tokenId) <span class="pl-k">==</span> <span class="pl-c1">address</span>(<span class="pl-mi">this</span>) <span class="pl-k">||</span> nft.<span class="pl-en">isApprovedForAll</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">address</span>(<span class="pl-mi">this</span>)),
        <span class="pl-s">"<span class="pl-s">Marketplace not approved</span>"</span>
    );

    listings[nftAddress][tokenId] <span class="pl-k">=</span> <span class="pl-en">Listing</span>({
        seller: <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>,
        nftAddress: nftAddress,
        tokenId: tokenId,
        price: price,
        royaltyReceiver: royaltyReceiver,
        royaltyPercent: royaltyPercent,
        isListed: <span class="pl-c1">true</span>
    });

    <span class="pl-k">emit</span> <span class="pl-en">Listed</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, nftAddress, tokenId, price, royaltyReceiver, royaltyPercent);
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto"><strong>ğŸ§  å®ƒåšä»€ä¹ˆï¼Ÿ</strong></h3></div>
<p dir="auto">è¿™ä¸ªå‡½æ•°å…è®¸ä»»ä½•ç”¨æˆ·<strong>åˆ—å‡ºä»–ä»¬æ‹¥æœ‰çš„NFT</strong>åœ¨å¸‚åœºä¸Šå‡ºå”®ã€‚</p>
<p dir="auto">å®ƒæ£€æŸ¥ï¼š</p>
<ul dir="auto">
<li>ç”¨æˆ·æ‹¥æœ‰NFT</li>
<li>NFTè¢«æ‰¹å‡†ç”¨äºå¸‚åœºè½¬ç§»</li>
<li>ä»·æ ¼å’Œç‰ˆç¨è®¾ç½®æœ‰æ•ˆ</li>
</ul>
<p dir="auto">ä¸€æ—¦éªŒè¯ï¼Œå®ƒå°†åˆ—è¡¨å­˜å‚¨åœ¨é“¾ä¸Šå¹¶å‘å‡ºäº‹ä»¶ï¼Œä»¥ä¾¿å‰ç«¯å¯ä»¥åœ¨å¸‚åœºUIä¸­æ˜¾ç¤ºå®ƒã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¥ è¾“å…¥â€”â€”å‡½æ•°æ¥å—ä»€ä¹ˆ</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> listNFT</span></span>(
    <span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">price</span>,
    <span class="pl-c1">address</span> <span class="pl-v">royaltyReceiver</span>,
    <span class="pl-c1">uint256</span> <span class="pl-v">royaltyPercent</span>
)
</pre></div>
<markdown-accessiblity-table data-catalyst=""><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å®ƒä»£è¡¨ä»€ä¹ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nftAddress</code></td>
<td>NFTçš„<strong>ERC-721åˆçº¦</strong>åœ°å€</td>
</tr>
<tr>
<td><code>tokenId</code></td>
<td>ä½ æ­£åœ¨åˆ—å‡ºçš„NFTçš„<strong>å”¯ä¸€ID</strong></td>
</tr>
<tr>
<td><code>price</code></td>
<td>ä½ æƒ³è¦å‡ºå”®çš„<strong>ETHæ•°é‡ï¼ˆä»¥weiä¸ºå•ä½ï¼‰</strong></td>
</tr>
<tr>
<td><code>royaltyReceiver</code></td>
<td>åº”è¯¥åœ¨é”€å”®ä¸­æ¥æ”¶<strong>ç‰ˆç¨</strong>çš„åœ°å€</td>
</tr>
<tr>
<td><code>royaltyPercent</code></td>
<td>ç»™äºˆå¤šå°‘ç‰ˆç¨ï¼ˆä»¥<strong>åŸºç‚¹</strong>ä¸ºå•ä½ï¼Œä¾‹å¦‚ï¼Œ500 = 5%ï¼‰</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ” é€è¡Œåˆ†è§£</h3></div>
<p dir="auto"><strong>âœ… æ­¥éª¤1ï¼šåŸºæœ¬éªŒè¯</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(price <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>, <span class="pl-s">"<span class="pl-s">Price must be above zero</span>"</span>);
<span class="pl-k">require</span>(royaltyPercent <span class="pl-k">&lt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s">"<span class="pl-s">Max 10% royalty allowed</span>"</span>);
<span class="pl-k">require</span>(<span class="pl-k">!</span>listings[nftAddress][tokenId].isListed, <span class="pl-s">"<span class="pl-s">Already listed</span>"</span>);
</pre></div>
<ul dir="auto">
<li>ä½ å¿…é¡»ä»¥<strong>éé›¶ä»·æ ¼</strong>åˆ—å‡º</li>
<li>ç‰ˆç¨å¿…é¡»**â‰¤10%**ä»¥ä¿æŒåˆç†</li>
<li>NFTå¿…é¡»<strong>å°šæœªåˆ—å‡º</strong>ï¼ˆä»¥é¿å…è¦†ç›–æˆ–é‡å¤æ¡ç›®ï¼‰</li>
</ul>
<hr>
<p dir="auto"><strong>ğŸ”— æ­¥éª¤2ï¼šä¸NFTäº¤äº’</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">IERC721</span> nft <span class="pl-k">=</span> <span class="pl-c1">IERC721</span>(nftAddress);
</pre></div>
<p dir="auto">æˆ‘ä»¬å°†åœ°å€è½¬æ¢ä¸º<code>IERC721</code>åˆçº¦æ¥å£ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è°ƒç”¨æ ‡å‡†ERC-721å‡½æ•°ï¼Œå¦‚ï¼š</p>
<ul dir="auto">
<li><code>ownerOf</code></li>
<li><code>getApproved</code></li>
<li><code>isApprovedForAll</code></li>
</ul>
<hr>
<p dir="auto"><strong>ğŸ‘‘ æ­¥éª¤3ï¼šæ£€æŸ¥NFTæ‰€æœ‰æƒå’Œæ‰¹å‡†</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(nft.<span class="pl-en">ownerOf</span>(tokenId) <span class="pl-k">==</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-s">"<span class="pl-s">Not the owner</span>"</span>);
</pre></div>
<p dir="auto">ç¡®ä¿è°ƒç”¨è€…<strong>å®é™…æ‹¥æœ‰</strong>ä»–ä»¬è¯•å›¾åˆ—å‡ºçš„NFTã€‚</p>
<p dir="auto">è¿™é˜²æ­¢æœ‰äººåˆ—å‡ºä»–ä»¬ä¸æ‹¥æœ‰çš„NFTã€‚</p>
<hr>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(
    nft.<span class="pl-en">getApproved</span>(tokenId) <span class="pl-k">==</span> <span class="pl-c1">address</span>(<span class="pl-mi">this</span>) <span class="pl-k">||</span> nft.<span class="pl-en">isApprovedForAll</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-c1">address</span>(<span class="pl-mi">this</span>)),
    <span class="pl-s">"<span class="pl-s">Marketplace not approved</span>"</span>
);
</pre></div>
<p dir="auto">å¸‚åœº<strong>å¿…é¡»è¢«æ‰¹å‡†</strong>ä»£è¡¨ç”¨æˆ·è½¬ç§»NFTã€‚</p>
<p dir="auto">è¿™æ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿åˆçº¦åœ¨å‡ºå”®æ—¶å¯ä»¥å°†NFTå‘é€ç»™ä¹°å®¶ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¦ æ­¥éª¤4ï¼šåœ¨é“¾ä¸Šä¿å­˜åˆ—è¡¨ä¿¡æ¯</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>listings[nftAddress][tokenId] <span class="pl-k">=</span> <span class="pl-en">Listing</span>({
    seller: <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>,
    nftAddress: nftAddress,
    tokenId: tokenId,
    price: price,
    royaltyReceiver: royaltyReceiver,
    royaltyPercent: royaltyPercent,
    isListed: <span class="pl-c1">true</span>
});
</pre></div>
<p dir="auto">æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>Listing</code>ç»“æ„ä½“å¹¶å°†å…¶å­˜å‚¨åœ¨æˆ‘ä»¬çš„åµŒå¥—<code>listings</code>æ˜ å°„ä¸­ã€‚</p>
<p dir="auto">è¿™ç°åœ¨æ˜¯å¸‚åœºä¸Šçš„<strong>å®æ—¶åˆ—è¡¨</strong>â€”â€”ä»»ä½•äººéƒ½å¯ä»¥å‘ç°ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¢ æ­¥éª¤5ï¼šå‘å‡ºäº‹ä»¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">Listed</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, nftAddress, tokenId, price, royaltyReceiver, royaltyPercent);
</pre></div>
<p dir="auto">è¿™åœ¨é“¾ä¸Šè®°å½•åˆ—è¡¨ï¼Œä»¥ä¾¿ï¼š</p>
<ul dir="auto">
<li>UIå¯ä»¥æ˜¾ç¤ºå®ƒ</li>
<li>ç´¢å¼•å™¨ï¼ˆå¦‚The Graphï¼‰å¯ä»¥è·Ÿè¸ªå®ƒ</li>
<li>ç”¨æˆ·å¯ä»¥å®æ—¶çœ‹åˆ°æ´»åŠ¨</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">11. ğŸ›ï¸ <code>buyNFT()</code> â€” ç”¨ETHè´­ä¹°NFT</h2></div>
<p dir="auto">è¿™å°±æ˜¯å¸‚åœºçš„<strong>æ ¸å¿ƒ</strong>ã€‚</p>
<p dir="auto">å½“æœ‰äººæ‰¾åˆ°ä»–ä»¬å–œæ¬¢çš„NFTå¹¶ç‚¹å‡»"è´­ä¹°"æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å®é™…è¿›è¡Œäº¤æ˜“çš„ã€‚</p>
<p dir="auto">è®©æˆ‘ä»¬åƒå‘ç¬¬ä¸€æ¬¡è´­ä¹°NFTçš„äººè§£é‡Šä¸€æ ·èµ°è¿‡å®ƒâ€”â€”åŒæ—¶ä¹Ÿç¼–ç åç«¯ä½¿å…¶å·¥ä½œã€‚</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> buyNFT</span></span>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>) <span class="pl-k">external</span> <span class="pl-k">payable</span> nonReentrant {
    Listing <span class="pl-k">memory</span> item <span class="pl-k">=</span> listings[nftAddress][tokenId];
    <span class="pl-k">require</span>(item.isListed, <span class="pl-s">"<span class="pl-s">Not listed</span>"</span>);
    <span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">==</span> item.price, <span class="pl-s">"<span class="pl-s">Incorrect ETH sent</span>"</span>);
    <span class="pl-k">require</span>(
        item.royaltyPercent <span class="pl-k">+</span> marketplaceFeePercent <span class="pl-k">&lt;=</span> <span class="pl-c1">10000</span>,
        <span class="pl-s">"<span class="pl-s">Combined fees exceed 100%</span>"</span>
    );

    <span class="pl-c1">uint256</span> feeAmount <span class="pl-k">=</span> (<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">*</span> marketplaceFeePercent) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
    <span class="pl-c1">uint256</span> royaltyAmount <span class="pl-k">=</span> (<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">*</span> item.royaltyPercent) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
    <span class="pl-c1">uint256</span> sellerAmount <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">-</span> feeAmount <span class="pl-k">-</span> royaltyAmount;

    <span class="pl-c">// æ”¯ä»˜å¸‚åœº</span>
    <span class="pl-k">if</span> (feeAmount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {
        <span class="pl-c1">payable</span>(feeRecipient).<span class="pl-en">transfer</span>(feeAmount);
    }

    <span class="pl-c">// æ”¯ä»˜åˆ›ä½œè€…ç‰ˆç¨</span>
    <span class="pl-k">if</span> (royaltyAmount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span> <span class="pl-k">&amp;&amp;</span> item.royaltyReceiver <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>)) {
        <span class="pl-c1">payable</span>(item.royaltyReceiver).<span class="pl-en">transfer</span>(royaltyAmount);
    }

    <span class="pl-c">// æ”¯ä»˜å–å®¶</span>
    <span class="pl-c1">payable</span>(item.seller).<span class="pl-en">transfer</span>(sellerAmount);

    <span class="pl-c">// å°†NFTè½¬ç§»ç»™ä¹°å®¶</span>
    <span class="pl-c1">IERC721</span>(item.nftAddress).<span class="pl-en">safeTransferFrom</span>(item.seller, <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, item.tokenId);

    <span class="pl-c">// æ¸…ç†åˆ—è¡¨</span>
    <span class="pl-k">delete</span> listings[nftAddress][tokenId];

    <span class="pl-k">emit</span> <span class="pl-en">Purchase</span>(
        <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>,
        nftAddress,
        tokenId,
        <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>,
        item.seller,
        item.royaltyReceiver,
        royaltyAmount,
        feeAmount
    );
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  å®ƒåšä»€ä¹ˆï¼Ÿ</h3></div>
<p dir="auto">è¿™ä¸ªå‡½æ•°ï¼š</p>
<ul dir="auto">
<li>æ¥å—ä¹°å®¶çš„ETH</li>
<li>åœ¨å–å®¶ã€åˆ›ä½œè€…ï¼ˆç‰ˆç¨ï¼‰å’Œå¹³å°ï¼ˆè´¹ç”¨ï¼‰ä¹‹é—´åˆ†å‰²</li>
<li>å°†NFTè½¬ç§»ç»™ä¹°å®¶</li>
<li>åˆ é™¤åˆ—è¡¨</li>
<li>å‘å‡ºäº‹ä»¶è®©ä¸–ç•ŒçŸ¥é“è´­ä¹°å‘ç”Ÿäº†</li>
</ul>
<p dir="auto">å…¨éƒ¨åœ¨ä¸€ä¸ªäº¤æ˜“ä¸­ã€‚æ²¡æœ‰æ‰‹åŠ¨æ­¥éª¤ã€‚æ²¡æœ‰é“¾ä¸‹ç¡®è®¤ã€‚</p>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§© è®©æˆ‘ä»¬åˆ†è§£å®ƒ</h3></div>
<hr>
<p dir="auto"><strong>ğŸ›¡ï¸ å‡½æ•°å¤´</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> buyNFT</span></span>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>) <span class="pl-k">external</span> <span class="pl-k">payable</span> <span class="pl-v">nonReentrant</span>
</pre></div>
<ul dir="auto">
<li><code>external</code>ï¼šç”±ç”¨æˆ·ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ã€‚</li>
<li><code>payable</code>ï¼šä»¥ä¾¿ä¹°å®¶å¯ä»¥å‘é€ETHã€‚</li>
<li><code>nonReentrant</code>ï¼šä½¿ç”¨<code>ReentrancyGuard</code>é˜²æ­¢é‡å…¥æ”»å‡»â€”â€”å‘é€ETHçš„å‡½æ•°ä¸­çš„å¸¸è§æ¼æ´ã€‚</li>
</ul>
<hr>
<p dir="auto"><strong>ğŸ“„ åŠ è½½åˆ—è¡¨</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>Listing <span class="pl-k">memory</span> item <span class="pl-k">=</span> listings[nftAddress][tokenId];
</pre></div>
<p dir="auto">æˆ‘ä»¬ä»å­˜å‚¨ä¸­è·å–åˆ—è¡¨åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è¯»å–å…¶è¯¦ç»†ä¿¡æ¯ï¼ˆä»·æ ¼ã€å–å®¶ã€ç‰ˆç¨ä¿¡æ¯ç­‰ï¼‰ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ”’ éªŒè¯</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(item.isListed, <span class="pl-s">"<span class="pl-s">Not listed</span>"</span>);
<span class="pl-k">require</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">==</span> item.price, <span class="pl-s">"<span class="pl-s">Incorrect ETH sent</span>"</span>);
<span class="pl-k">require</span>(
    item.royaltyPercent <span class="pl-k">+</span> marketplaceFeePercent <span class="pl-k">&lt;=</span> <span class="pl-c1">10000</span>,
    <span class="pl-s">"<span class="pl-s">Combined fees exceed 100%</span>"</span>
);
</pre></div>
<ul dir="auto">
<li>è¿™ä¸ªNFTç”šè‡³åˆ—å‡ºäº†å—ï¼Ÿ</li>
<li>ä¹°å®¶æ˜¯å¦å‘é€äº†<strong>ç¡®åˆ‡</strong>æ‰€éœ€çš„ETHæ•°é‡ï¼Ÿ</li>
<li>ç»„åˆç‰ˆç¨+å¹³å°è´¹ç”¨æ˜¯å¦ä¿æŒåœ¨100%ä»¥ä¸‹ï¼Ÿ</li>
</ul>
<blockquote>
<p dir="auto">æ²¡æœ‰æœ€åä¸€ä¸ªæ£€æŸ¥ï¼Œæœ‰äººå¯èƒ½å°†ç‰ˆç¨+è´¹ç”¨è®¾ç½®ä¸º110%å¹¶ç ´åæ”¯ä»˜æ•°å­¦ã€‚</p>
</blockquote>
<hr>
<p dir="auto"><strong>ğŸ’° è®¡ç®—æ”¯ä»˜</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">uint256</span> feeAmount <span class="pl-k">=</span> (<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">*</span> marketplaceFeePercent) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
<span class="pl-c1">uint256</span> royaltyAmount <span class="pl-k">=</span> (<span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">*</span> item.royaltyPercent) <span class="pl-k">/</span> <span class="pl-c1">10000</span>;
<span class="pl-c1">uint256</span> sellerAmount <span class="pl-k">=</span> <span class="pl-c1">msg</span>.<span class="pl-c1">value</span> <span class="pl-k">-</span> feeAmount <span class="pl-k">-</span> royaltyAmount;
</pre></div>
<p dir="auto">æˆ‘ä»¬å°†æ€»ETHï¼ˆ<code>msg.value</code>ï¼‰åˆ†æˆä¸‰ä¸ªæ¡¶ï¼š</p>
<ul dir="auto">
<li>å¸‚åœºè´¹ç”¨</li>
<li>åˆ›ä½œè€…ç‰ˆç¨</li>
<li>å–å®¶çš„å®é™…æ”¶å…¥</li>
</ul>
<p dir="auto">å…¨éƒ¨ä»¥<strong>åŸºç‚¹</strong>è®¡ç®—ï¼Œç”¨äºç²¾ç¡®çš„è´¹ç”¨é€»è¾‘ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ¦ åˆ†é…èµ„é‡‘</h3></div>
<p dir="auto"><strong>æ”¯ä»˜å¸‚åœº</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">if</span> (feeAmount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {
    <span class="pl-c1">payable</span>(feeRecipient).<span class="pl-en">transfer</span>(feeAmount);
}
</pre></div>
<p dir="auto">ETHå»<code>feeRecipient</code>â€”â€”è¿™å¯èƒ½æ˜¯å¹³å°ã€DAOï¼Œç”šè‡³å¼€å‘é’±åŒ…ã€‚</p>
<hr>
<p dir="auto"><strong>æ”¯ä»˜åˆ›ä½œè€…ï¼ˆå¯é€‰ï¼‰</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">if</span> (royaltyAmount <span class="pl-k">&gt;</span> <span class="pl-c1">0</span> <span class="pl-k">&amp;&amp;</span> item.royaltyReceiver <span class="pl-k">!=</span> <span class="pl-c1">address</span>(<span class="pl-c1">0</span>)) {
    <span class="pl-c1">payable</span>(item.royaltyReceiver).<span class="pl-en">transfer</span>(royaltyAmount);
}
</pre></div>
<p dir="auto">å¦‚æœåˆ—è¡¨æœ‰ç‰ˆç¨ä¿¡æ¯ï¼ŒæŒ‡å®šåœ°å€è·å¾—ä¸€éƒ¨åˆ†ã€‚</p>
<blockquote>
<p dir="auto">è¿™æ”¯æŒåˆ›ä½œè€…åœ¨äºŒæ¬¡é”€å”®ä¸­çš„æ”¶å…¥â€”â€”NFTé¢†åŸŸçš„ä¸€ä¸ªå·¨å¤§åŠŸèƒ½ã€‚</p>
</blockquote>
<hr>
<p dir="auto"><strong>æ”¯ä»˜å–å®¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">payable</span>(item.seller).<span class="pl-en">transfer</span>(sellerAmount);
</pre></div>
<p dir="auto">è´¹ç”¨å’Œç‰ˆç¨åå‰©ä¸‹çš„ä»»ä½•ä¸œè¥¿éƒ½å½’åˆ—å‡ºNFTçš„äººã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¦ è½¬ç§»NFT</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-c1">IERC721</span>(item.nftAddress).<span class="pl-en">safeTransferFrom</span>(item.seller, <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, item.tokenId);
</pre></div>
<p dir="auto">åˆçº¦ä½¿ç”¨æ ‡å‡†ERC-721è½¬ç§»å‡½æ•°<strong>å°†NFT</strong>ä»å–å®¶ç§»åŠ¨åˆ°ä¹°å®¶ã€‚</p>
<blockquote>
<p dir="auto">è¿™åªæœ‰åœ¨å–å®¶åœ¨åˆ—è¡¨æœŸé—´æ‰¹å‡†å¸‚åœºæ—¶æ‰æœ‰æ•ˆã€‚</p>
</blockquote>
<hr>
<p dir="auto"><strong>ğŸ§¹ æ¸…ç†åˆ—è¡¨</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">delete</span> listings[nftAddress][tokenId];
</pre></div>
<p dir="auto">ä¸€æ—¦NFTè¢«å‡ºå”®ï¼Œæˆ‘ä»¬ä»å­˜å‚¨ä¸­åˆ é™¤åˆ—è¡¨ï¼Œè¿™æ ·å®ƒå°±ä¸å†æ˜¾ç¤ºä¸º"å‡ºå”®"ã€‚</p>
<hr>
<p dir="auto">ğŸ“¢ å‘å‡ºè´­ä¹°äº‹ä»¶</p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">Purchase</span>(
    <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>,
    nftAddress,
    tokenId,
    <span class="pl-c1">msg</span>.<span class="pl-c1">value</span>,
    item.seller,
    item.royaltyReceiver,
    royaltyAmount,
    feeAmount
);
</pre></div>
<p dir="auto">è¿™è®°å½•äº¤æ˜“çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯â€”â€”ä»¥ä¾¿UIå’Œç´¢å¼•å™¨å¯ä»¥è·Ÿè¸ªé”€å”®ã€è´¹ç”¨å’Œç‰ˆç¨ã€‚---</p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">12. âŒ <code>cancelListing()</code> â€” ä»é”€å”®ä¸­ç§»é™¤NFT</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> cancelListing</span></span>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>) <span class="pl-k">external</span> {
    Listing <span class="pl-k">memory</span> item <span class="pl-k">=</span> listings[nftAddress][tokenId];
    <span class="pl-k">require</span>(item.isListed, <span class="pl-s">"<span class="pl-s">Not listed</span>"</span>);
    <span class="pl-k">require</span>(item.seller <span class="pl-k">==</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-s">"<span class="pl-s">Not the seller</span>"</span>);

    <span class="pl-k">delete</span> listings[nftAddress][tokenId];
    <span class="pl-k">emit</span> <span class="pl-en">Unlisted</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, nftAddress, tokenId);
}
</pre></div>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  å®ƒåšä»€ä¹ˆï¼Ÿ</h3></div>
<p dir="auto">è¿™ä¸ªå‡½æ•°è®©NFTçš„<strong>å–å®¶</strong>åœ¨<strong>å‡ºå”®ä¹‹å‰</strong>ä»å¸‚åœºä¸­ç§»é™¤å®ƒã€‚</p>
<p dir="auto">å®ƒåœ¨ä»¥ä¸‹æƒ…å†µä¸‹æœ‰ç”¨ï¼š</p>
<ul dir="auto">
<li>ä½ æ”¹å˜äº†å‡ºå”®çš„æƒ³æ³•</li>
<li>ä½ æƒ³ä»¥æ–°ä»·æ ¼é‡æ–°åˆ—å‡º</li>
<li>ä½ æ„å¤–åˆ—å‡ºäº†é”™è¯¯çš„NFT</li>
</ul>
<p dir="auto">å‡½æ•°ç¡®ä¿<strong>åªæœ‰åŸå§‹å–å®¶</strong>å¯ä»¥å–æ¶ˆåˆ—å‡ºâ€”â€”ä¸€æ—¦å®Œæˆï¼ŒNFTå°†ä¸å†æ˜¾ç¤ºä¸ºå¯è´­ä¹°ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¥ è¾“å…¥</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>)
</pre></div>
<p dir="auto">å°±åƒåˆ—å‡ºæˆ–è´­ä¹°ä¸€æ ·ï¼š</p>
<ul dir="auto">
<li><code>nftAddress</code> = NFTçš„åˆçº¦</li>
<li><code>tokenId</code> = è¢«å–æ¶ˆåˆ—å‡ºçš„ç‰¹å®šNFT</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ” é€è¡Œåˆ†è§£</h3></div>
<hr>
<p dir="auto"><strong>ğŸ“„ æ­¥éª¤1ï¼šåŠ è½½åˆ—è¡¨</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre>Listing <span class="pl-k">memory</span> item <span class="pl-k">=</span> listings[nftAddress][tokenId];
</pre></div>
<p dir="auto">ä»å­˜å‚¨ä¸­è·å–åˆ—è¡¨è¯¦ç»†ä¿¡æ¯åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ›¡ï¸ æ­¥éª¤2ï¼šéªŒè¯</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(item.isListed, <span class="pl-s">"<span class="pl-s">Not listed</span>"</span>);
</pre></div>
<ul dir="auto">
<li>å¦‚æœNFTæ²¡æœ‰åˆ—å‡ºï¼Œä½ ä¸èƒ½å–æ¶ˆå®ƒã€‚</li>
<li>è¿™é˜²æ­¢ä¸å¿…è¦çš„åˆ é™¤æˆ–è¯¯å¯¼æ€§çš„UIæ›´æ–°ã€‚</li>
</ul>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">require</span>(item.seller <span class="pl-k">==</span> <span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, <span class="pl-s">"<span class="pl-s">Not the seller</span>"</span>);
</pre></div>
<ul dir="auto">
<li>åªæœ‰åŸå§‹<strong>å–å®¶</strong>å¯ä»¥å–æ¶ˆä»–ä»¬çš„åˆ—è¡¨ã€‚</li>
<li>è¿™é˜²æ­¢éšæœºç”¨æˆ·ç”šè‡³ä¹°å®¶è¯•å›¾æä¹±åˆ—è¡¨ã€‚</li>
</ul>
<hr>
<p dir="auto"><strong>ğŸ§¹ æ­¥éª¤3ï¼šåˆ é™¤åˆ—è¡¨</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">delete</span> listings[nftAddress][tokenId];
</pre></div>
<p dir="auto">è¿™å®Œå…¨ä»<code>listings</code>æ˜ å°„ä¸­åˆ é™¤åˆ—è¡¨ã€‚</p>
<p dir="auto">åœ¨æ­¤ä¹‹åï¼ŒNFTä¸å†å‡ºå”®ï¼Œä¸ä¼šå‡ºç°åœ¨å‰ç«¯å¸‚åœºæˆ–APIä¸­ã€‚</p>
<hr>
<p dir="auto"><strong>ğŸ“¢ æ­¥éª¤4ï¼šå‘å‡ºäº‹ä»¶</strong></p>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">emit</span> <span class="pl-en">Unlisted</span>(<span class="pl-c1">msg</span>.<span class="pl-c1">sender</span>, nftAddress, tokenId);
</pre></div>
<p dir="auto">æˆ‘ä»¬å…¬å¼€è®°å½•æ“ä½œï¼Œè¿™è®©ï¼š</p>
<ul dir="auto">
<li>UIå®æ—¶æ›´æ–°</li>
<li>ç”¨æˆ·çœ‹åˆ°æ¸…æ™°çš„äº¤æ˜“å†å²</li>
<li>ç´¢å¼•å™¨è·Ÿè¸ªåˆ—è¡¨çŠ¶æ€</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">13. ğŸ“¦ <code>getListing()</code> â€” æŸ¥çœ‹åˆ—è¡¨è¯¦ç»†ä¿¡æ¯</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">function<span class="pl-en"> getListing</span></span>(<span class="pl-c1">address</span> <span class="pl-v">nftAddress</span>, <span class="pl-c1">uint256</span> <span class="pl-v">tokenId</span>) <span class="pl-k">external</span> <span class="pl-k">view</span> <span class="pl-k">returns</span> (Listing <span class="pl-k">memory</span>) {
    <span class="pl-k">return</span> listings[nftAddress][tokenId];
}
</pre></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  å®ƒåšä»€ä¹ˆ</h3></div>
<p dir="auto">è¿™æ˜¯ä¸€ä¸ª<strong>åªè¯»è¾…åŠ©å‡½æ•°</strong>ï¼Œè®©ä»»ä½•äººï¼ˆå¦‚å‰ç«¯æˆ–å¦ä¸€ä¸ªåˆçº¦ï¼‰è·å–ç‰¹å®šåˆ—è¡¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<ul dir="auto">
<li>å¤–éƒ¨è°ƒç”¨æ—¶ä¸æ¶ˆè€—gasï¼ˆå› ä¸ºå®ƒæ˜¯<code>view</code>ï¼‰</li>
<li>å®ƒè¿”å›ç»™å®šNFTçš„å®Œæ•´<code>Listing</code>ç»“æ„ä½“</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ–¼ï¸ ä½ ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å®ƒï¼Ÿ</h3></div>
<ul dir="auto">
<li>å¸‚åœºå‰ç«¯æƒ³è¦æ˜¾ç¤ºåˆ—å‡ºNFTçš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯</li>
<li>ä¹°å®¶æƒ³è¦åœ¨è´­ä¹°å‰é¢„è§ˆä»·æ ¼å’Œç‰ˆç¨</li>
<li>è„šæœ¬æˆ–æœºå™¨äººæƒ³è¦æ£€æŸ¥åˆ—å‡ºçš„å†…å®¹å¹¶è¿‡æ»¤äº¤æ˜“</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">14. ğŸ›‘ <code>receive()</code> â€” æ‹’ç»ç›´æ¥ETHè½¬è´¦</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">receive</span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
    <span class="pl-k">revert</span>(<span class="pl-s">"<span class="pl-s">Direct ETH not accepted</span>"</span>);
}
</pre></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  å®ƒåšä»€ä¹ˆ</h3></div>
<p dir="auto">å½“æœ‰äºº<strong>ç›´æ¥å‘åˆçº¦å‘é€ETH</strong>è€Œä¸è°ƒç”¨å‡½æ•°æ—¶è§¦å‘æ­¤å‡½æ•°ã€‚</p>
<p dir="auto">é»˜è®¤æƒ…å†µä¸‹ï¼ŒSolidityå…è®¸åˆçº¦ä»¥è¿™ç§æ–¹å¼æ¥æ”¶ETHâ€”â€”ä½†åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬<strong>ä¸å¸Œæœ›è¿™æ ·</strong>ã€‚</p>
<p dir="auto">è¿™ä¸ªå‡½æ•°é€šè¿‡è°ƒç”¨<code>revert()</code><strong>æ‹’ç»</strong>æ­¤ç±»è½¬è´¦ã€‚</p>
<blockquote>
<p dir="auto">è¿™é˜²æ­¢ï¼š</p>
<ul dir="auto">
<li>æ„å¤–çš„ETHè½¬è´¦</li>
<li>ç”¨æˆ·è®¤ä¸ºä»–ä»¬åªæ˜¯é€šè¿‡å‘é€ETHå°±åœ¨è´­ä¹°ä¸œè¥¿</li>
<li>ETHæ°¸è¿œå¡åœ¨åˆçº¦ä¸­</li>
</ul>
</blockquote>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">15. ğŸ§Ÿ <code>fallback()</code> â€” æ‹’ç»æœªçŸ¥å‡½æ•°è°ƒç”¨</h2></div>
<div class="highlight highlight-source-solidity notranslate position-relative overflow-auto" dir="auto"><pre><span class="pl-k">fallback</span>() <span class="pl-k">external</span> <span class="pl-k">payable</span> {
    <span class="pl-k">revert</span>(<span class="pl-s">"<span class="pl-s">Unknown function</span>"</span>);
}
</pre></div>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  å®ƒåšä»€ä¹ˆ</h3></div>
<p dir="auto"><code>fallback()</code>å‡½æ•°åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼š</p>
<ul dir="auto">
<li>æœ‰äººè°ƒç”¨åˆçº¦ä¸­ä¸å­˜åœ¨çš„å‡½æ•°</li>
<li>æˆ–åœ¨ä¸è§¦å‘<code>receive()</code>çš„æƒ…å†µä¸‹å‘é€ETH</li>
</ul>
<p dir="auto">åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬<strong>ä¸æƒ³æ¥å—è°ƒç”¨æˆ–ETH</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç«‹å³ç”¨é”™è¯¯å›æ»šã€‚</p>
<blockquote>
<p dir="auto">è¿™é˜²æ­¢æ„å¤–è¯¯ç”¨ï¼Œå¹¶ç¡®ä¿ç”¨æˆ·ä¸ä¼šå› ä¸ºè°ƒç”¨åƒbyuNFT()è€Œä¸æ˜¯buyNFT()è¿™æ ·çš„æ‹¼å†™é”™è¯¯è€Œä¸¢å¤±ETHã€‚</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">16. ğŸ› ï¸ åœ¨Remixä¸Šæµ‹è¯•ä½ çš„NFTå¸‚åœº</h2></div>
<p dir="auto">ä½ å·²ç»ç”¨æ™ºèƒ½åˆçº¦æ„å»ºäº†ä¸€ä¸ªçœŸæ­£çš„æ•°å­—å•†åº—ã€‚ç°åœ¨è®©æˆ‘ä»¬å¯åŠ¨å®ƒï¼Œçœ‹çœ‹å®ƒåœ¨Remixä¸Šçš„å®é™…è¿è¡Œã€‚</p>
<p dir="auto">ä½ å°†èƒ½å¤Ÿï¼š</p>
<ul dir="auto">
<li>é“¸é€ NFT</li>
<li>åˆ—å‡ºå®ƒä»¬å‡ºå”®</li>
<li>ä½¿ç”¨ETHè´­ä¹°å®ƒä»¬</li>
<li>å–æ¶ˆåˆ—è¡¨</li>
<li>å®æ—¶è§‚çœ‹ä¸€åˆ‡æ›´æ–°</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ“¦ æ­¥éª¤1ï¼šåŠ è½½ä½ çš„åˆçº¦</h3></div>
<p dir="auto">ä½ éœ€è¦<strong>ä¸¤ä¸ªåˆçº¦</strong>ï¼š</p>
<p dir="auto"><strong>1. <code>SimpleNFT.sol</code>ï¼ˆä½ ä¹‹å‰æ„å»ºçš„é‚£ä¸ªï¼‰</strong></p>
<blockquote>
<p dir="auto">âœ… è¿™è®©ä½ å‘è‡ªå·±çš„é’±åŒ…é“¸é€ NFTã€‚</p>
</blockquote>
<hr>
<p dir="auto"><strong>2. <code>NFTMarketplace.sol</code>ï¼ˆä½ çš„å¸‚åœºï¼‰</strong></p>
<p dir="auto">ç²˜è´´ä½ ä¹‹å‰æ„å»ºçš„<strong>å®Œæ•´å¸‚åœºåˆçº¦</strong>ã€‚</p>
<p dir="auto">âœ… ç¡®ä¿ä¸¤ä¸ªåˆçº¦éƒ½ä½¿ç”¨Solidityç¼–è¯‘å™¨æ ‡ç­¾ç¼–è¯‘æ— é”™è¯¯ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸš€ æ­¥éª¤2ï¼šéƒ¨ç½²åˆçº¦</h3></div>
<ol dir="auto">
<li>è½¬åˆ°Remixä¸­çš„<strong>Deploy &amp; Run</strong>æ ‡ç­¾ã€‚</li>
<li>å°†<strong>Environment</strong>è®¾ç½®ä¸º<code>Remix VM (London)</code>ï¼ˆç”¨äºæœ¬åœ°æµ‹è¯•ï¼‰ã€‚</li>
<li>éƒ¨ç½²<code>SimpleNFT</code>â€”â€”å¤åˆ¶å…¶åœ°å€ã€‚</li>
<li>ä½¿ç”¨è¿™äº›æ„é€ å‡½æ•°å€¼éƒ¨ç½²<code>NFTMarketplace</code>ï¼š
<ul dir="auto">
<li>è´¹ç”¨ç™¾åˆ†æ¯”ï¼š<code>250</code>ï¼ˆ2.5%ï¼‰</li>
<li>è´¹ç”¨æ¥æ”¶è€…ï¼šä½ è‡ªå·±çš„Remixé’±åŒ…åœ°å€ï¼ˆä½ ä¼šåœ¨å³ä¸Šè§’çœ‹åˆ°å®ƒï¼‰</li>
</ul>
</li>
</ol>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ¨ æ­¥éª¤3ï¼šé“¸é€ ä¸€äº›NFT</h3></div>
<ol dir="auto">
<li>å±•å¼€ä½ éƒ¨ç½²çš„<code>SimpleNFT</code>åˆçº¦ã€‚</li>
<li>è°ƒç”¨<code>mint()</code>å‡½æ•°ä¸¤æ¬¡ä»¥é“¸é€ ä¸¤ä¸ªNFTï¼ˆID 0å’Œ1ï¼‰ã€‚</li>
<li>è°ƒç”¨<code>ownerOf(0)</code>å’Œ<code>ownerOf(1)</code>ä»¥ç¡®è®¤ä½ æ‹¥æœ‰å®ƒä»¬ã€‚</li>
</ol>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">âœ… æ­¥éª¤4ï¼šæ‰¹å‡†å¸‚åœº</h3></div>
<p dir="auto">åœ¨å¸‚åœºå¯ä»¥åˆ—å‡ºæˆ–å‡ºå”®ä½ çš„NFTä¹‹å‰ï¼Œä½ éœ€è¦<strong>æ‰¹å‡†</strong>å®ƒã€‚</p>
<ol dir="auto">
<li>åœ¨<code>SimpleNFT</code>ä¸­ï¼Œè°ƒç”¨ï¼š
<ul dir="auto">
<li><code>setApprovalForAll(marketplaceAddress, true)</code></li>
<li>ï¼ˆç”¨ä½ éƒ¨ç½²çš„å¸‚åœºçš„å®é™…åœ°å€æ›¿æ¢<code>marketplaceAddress</code>ï¼‰</li>
</ul>
</li>
</ol>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ·ï¸ æ­¥éª¤5ï¼šåˆ—å‡ºNFTå‡ºå”®</h3></div>
<p dir="auto">ç°åœ¨è½¬åˆ°ä½ éƒ¨ç½²çš„<code>NFTMarketplace</code>åˆçº¦ã€‚</p>
<ol dir="auto">
<li>ä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨<code>listNFT()</code>ï¼š
<ul dir="auto">
<li><code>nftAddress</code>ï¼šä½ çš„<code>SimpleNFT</code>åˆçº¦åœ°å€</li>
<li><code>tokenId</code>ï¼š<code>0</code></li>
<li><code>price</code>ï¼š<code>1000000000000000000</code>ï¼ˆè¿™æ˜¯1 ETHä»¥weiä¸ºå•ä½ï¼‰</li>
<li><code>royaltyReceiver</code>ï¼šä½ è‡ªå·±çš„åœ°å€</li>
<li><code>royaltyPercent</code>ï¼š<code>500</code>ï¼ˆ5%ï¼‰</li>
</ul>
</li>
</ol>
<p dir="auto"><strong>âœ… è¿™ä¸ªNFTç°åœ¨æ˜¯å®æ—¶åˆ—å‡ºçš„ã€‚</strong></p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ›’ æ­¥éª¤6ï¼šè´­ä¹°NFT</h3></div>
<p dir="auto">åœ¨Remixä¸­åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè´¦æˆ·ï¼ˆå³ä¸Šè§’ä¸‹æ‹‰èœå•ï¼‰ã€‚</p>
<p dir="auto">åœ¨<strong>Marketplaceåˆçº¦</strong>ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨<code>buyNFT()</code>ï¼š</p>
<ul dir="auto">
<li><code>nftAddress</code>ï¼šä½ çš„<code>SimpleNFT</code>åœ°å€</li>
<li><code>tokenId</code>ï¼š<code>0</code></li>
</ul>
<p dir="auto">ğŸ‘‡ åœ¨è°ƒç”¨æŒ‰é’®ä¸Šæ–¹çš„å€¼å­—æ®µä¸­ï¼š</p>
<ul dir="auto">
<li>è¾“å…¥<code>1</code> ETHï¼š<code>1000000000000000000</code></li>
</ul>
<p dir="auto">âœ… ç °â€”â€”ä½ çš„NFTè¢«è´­ä¹°äº†ï¼</p>
<ul dir="auto">
<li>å–å®¶å¾—åˆ°äº†æŠ¥é…¬</li>
<li>ç‰ˆç¨å½’åˆ›ä½œè€…</li>
<li>è´¹ç”¨å½’å¹³å°</li>
<li>NFTè½¬ç§»ç»™ä¹°å®¶</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">âŒ æ­¥éª¤7ï¼šå°è¯•å–æ¶ˆåˆ—è¡¨</h3></div>
<ul dir="auto">
<li>å†æ¬¡é“¸é€ ç¬¬ä¸‰ä¸ªNFTï¼ˆå†æ¬¡<code>mint()</code>ï¼‰ã€‚</li>
<li>å¦‚æœéœ€è¦ï¼Œæ‰¹å‡†å¸‚åœºã€‚</li>
<li>åˆ—å‡º<code>tokenId 2</code>ã€‚</li>
</ul>
<p dir="auto">ç„¶åä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨<code>cancelListing()</code>ï¼š</p>
<ul dir="auto">
<li><code>nftAddress</code></li>
<li><code>tokenId</code>ï¼š<code>2</code></li>
</ul>
<p dir="auto">âœ… ä½ ä¼šçœ‹åˆ°åˆ—è¡¨æ¶ˆå¤±ï¼ˆé€šè¿‡<code>getListing()</code>æ£€æŸ¥ï¼‰ã€‚</p>
<hr>
<div class="markdown-heading" dir="auto"><h3 tabindex="-1" class="heading-element" dir="auto">ğŸ§  å¯é€‰è°ƒè¯•æç¤º</h3></div>
<ul dir="auto">
<li>ä½¿ç”¨<code>getListing(nftAddress, tokenId)</code>æŸ¥çœ‹åˆ—è¡¨ä¿¡æ¯</li>
<li>åœ¨<code>SimpleNFT</code>ä¸­ä½¿ç”¨<code>ownerOf(tokenId)</code>è·Ÿè¸ªNFTè½¬ç§»</li>
<li>æ£€æŸ¥Remix<strong>æ§åˆ¶å°æ—¥å¿—å’Œäº¤æ˜“</strong>ä»¥äº†è§£æ‰€æœ‰ETHç§»åŠ¨</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto">ğŸ‰ ä½ åšåˆ°äº†</h2></div>
<p dir="auto">ä½ åˆšåˆšï¼š</p>
<ul dir="auto">
<li>é“¸é€ äº†NFT</li>
<li>åˆ—å‡ºå®ƒä»¬å‡ºå”®</li>
<li>ç”¨ç‰ˆç¨å’Œè´¹ç”¨è´­ä¹°äº†å®ƒä»¬</li>
<li>å–æ¶ˆäº†åˆ—è¡¨</li>
<li>å®Œå…¨æµ‹è¯•äº†ä½ è‡ªå·±çš„é“¾ä¸ŠNFTå•†åº—</li>
</ul>
<p dir="auto">å…¨éƒ¨æ— éœ€åç«¯ã€æ•°æ®åº“æˆ–å‰ç«¯ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/solidity.min.js"></script>
    <script>
        hljs.highlightAll();
        
        // å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
            
        // Snehaçš„ä¸€å°æ¥ä¿¡æ¨¡å—åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const envelopeContainer = document.getElementById('envelope-container');
            const answerModal = document.getElementById('answer-modal');
            const closeLetter = document.getElementById('close-letter');
            
            if (!envelopeContainer || !answerModal || !closeLetter) {
                return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
            }
            
            // ç‚¹å‡»ä¿¡å°æ‰“å¼€å¼¹çª—
            envelopeContainer.addEventListener('click', function() {
                envelopeContainer.classList.add('open');
                
                // å»¶è¿Ÿæ˜¾ç¤ºå¼¹çª—ï¼Œè®©ä¿¡å°ç¿»è½¬åŠ¨ç”»å®Œæˆ
                setTimeout(function() {
                    answerModal.style.display = 'flex';
                    setTimeout(function() {
                        answerModal.classList.add('open');
                    }, 50);
                }, 400);
            });
            
            // å…³é—­å¼¹çª—
            closeLetter.addEventListener('click', function() {
                answerModal.classList.remove('open');
                
                setTimeout(function() {
                    answerModal.style.display = 'none';
                    envelopeContainer.classList.remove('open');
                }, 600);
            });
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            answerModal.addEventListener('click', function(e) {
                if (e.target === answerModal) {
                    closeLetter.click();
                }
            });
        });
    </script>
</body>
</html>